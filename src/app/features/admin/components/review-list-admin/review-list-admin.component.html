
<section class="review-admin-container" [formGroup]="filterForm">
  <h2 class="section-title">
    Gestisci le Recensioni Utente

    <button mat-icon-button (click)="showFilters = !showFilters"
            [matTooltip]="showFilters ? 'Nascondi filtri' : 'Mostra filtri'">
      <mat-icon>{{ showFilters ? 'expand_less' : 'tune' }}</mat-icon>
    </button>
  </h2>

  <!-- FILTRI -->
  <div class="filters" *ngIf="showFilters">
    <mat-form-field appearance="outline">
      <mat-label>Ricerca</mat-label>
      <input matInput [formControl]="searchControl" placeholder="Nome, commento o titolo tattoo" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Artista</mat-label>
      <mat-select [formControl]="artistControl">
        <mat-option value="">Tutti</mat-option>
        <mat-option *ngFor="let artist of artists" [value]="artist.id">
          {{ artist.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Rating minimo</mat-label>
      <mat-select [formControl]="ratingControl">
        <mat-option value="">Tutti</mat-option>
        <mat-option *ngFor="let r of [1,2,3,4,5]" [value]="r">{{ r }}+</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Stato</mat-label>
      <mat-select [formControl]="statusControl">
        <mat-option value="">Tutti</mat-option>
        <mat-option value="approved">Approvate</mat-option>
        <mat-option value="pending">In attesa</mat-option>
        <mat-option value="rejected">Rifiutate</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Ordina per</mat-label>
      <mat-select [formControl]="orderByControl">
        <mat-option value="date_desc">Data (recenti)</mat-option>
        <mat-option value="date_asc">Data (vecchie)</mat-option>
        <mat-option value="rating_desc">Valutazione (alta)</mat-option>
        <mat-option value="rating_asc">Valutazione (bassa)</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-stroked-button color="warn" class="reset-btn" (click)="resetFilters()">
      <mat-icon>restart_alt</mat-icon>
      Reset
    </button>
  </div>

  <!-- LISTA RECENSIONI -->
  <div class="review-grid">
    <mat-card *ngFor="let r of filteredReviews$ | async" class="review-card">

      <div class="header">
        <img class="avatar"
             *ngIf="getArtistPhotoById(r.artistId || '')"
             [src]="getArtistPhotoById(r.artistId || '')" />
        <div class="info">
          <h3>{{ r.tattooTitle || 'Recensione' }}</h3>
          <p class="date">{{ r.date | date:'mediumDate' }}</p>
        </div>

        <mat-chip class="status-chip"
                  [ngClass]="{
                    'approved': r.status === 'approved',
                    'pending': r.status === 'pending',
                    'rejected': r.status === 'rejected'
                  }">
          {{ r.status.toUpperCase() }}
        </mat-chip>
      </div>

      <p class="comment">“{{ r.comment }}”</p>

      <div class="stars">
        <mat-icon *ngFor="let s of [1,2,3,4,5]">
          {{ s <= r.rating ? 'star' : 'star_border' }}
        </mat-icon>
      </div>

      <div class="actions">
        <button mat-icon-button class="approve-btn"
                (click)="updateStatus(r, 'approved')"
                [class.active]="r.status === 'approved'">
          <mat-icon>check</mat-icon>
        </button>

        <button mat-icon-button class="reject-btn"
                (click)="updateStatus(r, 'rejected')"
                [class.active]="r.status === 'rejected'">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </mat-card>
  </div>
</section>
