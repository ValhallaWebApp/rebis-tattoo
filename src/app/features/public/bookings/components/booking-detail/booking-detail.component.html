<ng-container *ngIf="!loading; else loadingTpl">

  <mat-card *ngIf="booking; else notFoundTpl" class="booking-detail-card">
    <mat-card-title>
      Dettaglio prenotazione
    </mat-card-title>

    <mat-card-content>
      <p><strong>Descrizione:</strong> {{ booking.description }}</p>
      <p><strong>Data:</strong> {{ booking.start | date:'short' }}</p>
      <p><strong>Prezzo:</strong> {{ booking.price | currency:'EUR' }}</p>
      <p><strong>Stato:</strong> {{ booking.status }}</p>

      <div class="payment-section">
        <button mat-raised-button color="primary"
                *ngIf="!clientSecret"
                (click)="startPayment()"
                [disabled]="creatingPayment">
          <mat-progress-spinner *ngIf="creatingPayment"
                                diameter="18"
                                mode="indeterminate">
          </mat-progress-spinner>
          <span *ngIf="!creatingPayment">Procedi al pagamento</span>
        </button>

        <!-- Stripe form: appare solo dopo che abbiamo il clientSecret -->
<app-stripe-payment
  *ngIf="clientSecret"
  [publishableKey]="publishableKey"
  [clientSecret]="clientSecret"
  (paymentSuccess)="onPaymentSuccess()"
  (paymentError)="onPaymentError($event)">
</app-stripe-payment>

      </div>

      <p class="error" *ngIf="error">{{ error }}</p>
    </mat-card-content>
  </mat-card>

</ng-container>

<ng-template #loadingTpl>
  <div class="loading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
</ng-template>

<ng-template #notFoundTpl>
  <p>Prenotazione non trovata.</p>
</ng-template>
