<section class="calendar-shell" [ngClass]="theme">
  <!-- TOOLBAR -->
  <header class="calendar-toolbar">
    <div class="left">
      <button mat-icon-button (click)="prev()">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <button mat-stroked-button (click)="today()">
        Oggi
      </button>

      <button mat-icon-button (click)="next()">
        <mat-icon>chevron_right</mat-icon>
      </button>

      <h2>{{ title$ | async }}</h2>
    </div>

    <div class="toolbar-right">
      <!-- TOGGLE BOOKING / SESSION -->
      <mat-button-toggle-group
        *ngIf="(bookingTypes?.length || 0) > 1"
        [value]="selectedType"
        (change)="onTypeChanged($event.value)"
      >
        <mat-button-toggle *ngFor="let t of (bookingTypes || [])" [value]="t">
          {{ t === 'booking' ? 'Consulenze' : 'Sessioni' }}
        </mat-button-toggle>
      </mat-button-toggle-group>

      <!-- TOGGLE VIEW -->
      <mat-button-toggle-group
        class="view-toggle"
        [value]="(view$ | async) || 'week'"
        (change)="setView($event.value)"
      >
        <mat-button-toggle value="day">Giorno</mat-button-toggle>
        <mat-button-toggle value="week">Settimana</mat-button-toggle>
        <mat-button-toggle value="month">Mese</mat-button-toggle>
      </mat-button-toggle-group>

      <!-- TOGGLE TEMA -->
      <div class="theme-toggle">
        <button
          mat-icon-button
          (click)="setTheme('light')"
          [class.active]="theme === 'light'"
          matTooltip="Tema chiaro"
        >
          <mat-icon>light_mode</mat-icon>
        </button>

        <button
          mat-icon-button
          (click)="setTheme('dark')"
          [class.active]="theme === 'dark'"
          matTooltip="Tema scuro"
        >
          <mat-icon>dark_mode</mat-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- CONTENUTO VIEW -->
  <div class="calendar-content" *ngIf="view$ | async as view">
    <app-day-view
      *ngIf="view === 'day'"
      [date]="date$ | async"
      [events]="events$ | async"
      [artistMap]="artistMap"
      [artistPhotoMap]="artistPhotoMap"
      [role]="role"
      (eventDropped)="handleEventDropped($event)"
      (createFromSlot)="openCreate($event)"
    ></app-day-view>

    <app-week-view
      *ngIf="view === 'week'"
      [date]="date$ | async"
      [events]="events$ | async"
      [artistMap]="artistMap"
      [artistPhotoMap]="artistPhotoMap"
      [role]="role"
      (eventDropped)="handleEventDropped($event)"
      (createFromSlot)="openCreate($event)"
    ></app-week-view>

    <app-month-view
      *ngIf="view === 'month'"
      [date]="date$ | async"
      [events]="events$ | async"
      [artistMap]="artistMap"
      [artistPhotoMap]="artistPhotoMap"
      [role]="role"
      (createFromDay)="openCreate($event)"
    ></app-month-view>
  </div>

  <!-- DRAWER -->
  <mat-drawer-container class="drawer-container" *ngIf="bookingForm">
    <mat-drawer
      position="end"
      mode="over"
      [(opened)]="drawerOpen"
      class="drawer-panel"
    >
      <h3>
        {{ selectedType === 'booking' ? 'Nuova consulenza' : 'Nuova sessione' }}
      </h3>

      <form
        [formGroup]="bookingForm"
        (ngSubmit)="onSubmitDrawer()"
        class="drawer-form"
      >
        <mat-form-field appearance="outline">
          <mat-label>Artista</mat-label>
          <input matInput formControlName="artistId" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data</mat-label>
          <input matInput formControlName="date" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Ora</mat-label>
          <input matInput formControlName="time" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Durata (min)</mat-label>
          <input matInput type="number" formControlName="duration" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Descrizione</mat-label>
          <textarea
            matInput
            rows="3"
            formControlName="description"
          ></textarea>
        </mat-form-field>

        <div class="drawer-actions">
          <button mat-stroked-button type="button" (click)="closeDrawer()">
            Annulla
          </button>
          <button mat-flat-button color="primary" type="submit">
            Salva
          </button>
        </div>
      </form>
    </mat-drawer>
  </mat-drawer-container>
</section>
