import{d as em}from"./chunk-KFLFF4GH.js";import{Aa as Qp,Bc as Jp,C as qc,Cc as Xp,Ia as kt,Ja as Wc,Ma as He,Qc as Zp,Ta as Yp,a as ot,b as An,d as Qt,da as Gp,e as y,ga as Kp,h as Pt,ha as $c,ja as hr,ma as Yt,o as jp,oa as Nt,p as zp,pa as Hp,qa as Se,s as Mc,u as Fc,ub as Ai,v as Uc,wa as Jt,x as Bc}from"./chunk-GNSFZVKV.js";var zc={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var D=function(n,e){if(!n)throw Sn(e)},Sn=function(n){return new Error("Firebase Database ("+zc.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var nm=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},mw=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},no={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=s>>2,m=(s&3)<<4|c>>4,g=(c&15)<<2|h>>6,E=h&63;u||(E=64,o||(g=64)),r.push(t[f],t[m],t[g],t[E])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(nm(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):mw(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||m==null)throw new Gc;let g=s<<2|c>>4;if(r.push(g),h!==64){let E=c<<4&240|h>>2;if(r.push(E),m!==64){let R=h<<6&192|m;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Gc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Hc=function(n){let e=nm(n);return no.encodeByteArray(e,!0)},Si=function(n){return Hc(n).replace(/\./g,"")},bi=function(n){try{return no.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function rm(n){return im(void 0,n)}function im(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!gw(t)||(n[t]=im(n[t],e[t]));return n}function gw(n){return n!=="__proto__"}function _w(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var yw=()=>_w().__FIREBASE_DEFAULTS__,vw=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Iw=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&bi(n[1]);return e&&JSON.parse(e)},ro=()=>{try{return yw()||vw()||Iw()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Qc=n=>{var e,t;return(t=(e=ro())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},io=n=>{let e=Qc(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Yc=()=>{var n;return(n=ro())===null||n===void 0?void 0:n.config},Jc=n=>{var e;return(e=ro())===null||e===void 0?void 0:e[`_${n}`]};var Dt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function so(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Si(JSON.stringify(t)),Si(JSON.stringify(o)),""].join(".")}function Ee(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ci(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ee())}function ww(){var n;let e=(n=ro())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function sm(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function om(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function oo(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function am(){let n=Ee();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function at(){return zc.NODE_CLIENT===!0||zc.NODE_ADMIN===!0}function cm(){return!ww()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xc(){try{return typeof indexedDB=="object"}catch{return!1}}function um(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Ew="FirebaseError",ze=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Ew,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xt.prototype.create)}},xt=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Tw(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new ze(i,c,r)}};function Tw(n,e){return n.replace(Aw,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Aw=/\{\$([^}]+)}/g;function dr(n){return JSON.parse(n)}function _e(n){return JSON.stringify(n)}var lm=function(n){let e={},t={},r={},i="";try{let s=n.split(".");e=dr(bi(s[0])||""),t=dr(bi(s[1])||""),i=s[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:i}};var hm=function(n){let e=lm(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},dm=function(n){let e=lm(n).claims;return typeof e=="object"&&e.admin===!0};function et(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function bn(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ri(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Pi(n,e,t){let r={};for(let i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=e.call(t,n[i],i,n));return r}function Cn(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(tm(s)&&tm(o)){if(!Cn(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function tm(n){return n!==null&&typeof n=="object"}function Rn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function fr(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function pr(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}var to=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);let r=this.W_;if(typeof e=="string")for(let m=0;m<16;m++)r[m]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let m=0;m<16;m++)r[m]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let m=16;m<80;m++){let g=r[m-3]^r[m-8]^r[m-14]^r[m-16];r[m]=(g<<1|g>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],c=this.chain_[3],u=this.chain_[4],h,f;for(let m=0;m<80;m++){m<40?m<20?(h=c^s&(o^c),f=1518500249):(h=s^o^c,f=1859775393):m<60?(h=s&o|c&(s|o),f=2400959708):(h=s^o^c,f=3395469782);let g=(i<<5|i>>>27)+h+u+f+r[m]&4294967295;u=c,c=o,o=(s<<30|s>>>2)&4294967295,s=i,i=g}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let r=t-this.blockSize,i=0,s=this.buf_,o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<t;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[r]=this.chain_[i]>>s&255,++r;return e}};function fm(n,e){let t=new Kc(n,e);return t.subscribe.bind(t)}var Kc=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Sw(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=jc),i.error===void 0&&(i.error=jc),i.complete===void 0&&(i.complete=jc);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Sw(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function jc(){}function mr(n,e){return`${n} failed: ${e} argument `}var pm=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i>=55296&&i<=56319){let s=i-55296;r++,D(r<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(r)-56320;i=65536+(s<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ni=function(n){let e=0;for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};var aP=4*60*60*1e3;function ie(n){return n&&n._delegate?n._delegate:n}var We=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Pn="[DEFAULT]";var ao=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Dt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Cw(e))try{this.getOrInitializeService({instanceIdentifier:Pn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Pn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return y(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Pn){return this.instances.has(e)}getOptions(e=Pn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:bw(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Pn){return this.component?this.component.multipleInstances?e:Pn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function bw(n){return n===Pn?void 0:n}function Cw(n){return n.instantiationMode==="EAGER"}var ki=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ao(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Rw=[],G=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(G||{}),Pw={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},Nw=G.INFO,kw={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},Dw=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=kw[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ct=class{constructor(e){this.name=e,this._logLevel=Nw,this._logHandler=Dw,this._userLogHandler=null,Rw.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in G))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Pw[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...e),this._logHandler(this,G.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...e),this._logHandler(this,G.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,G.INFO,...e),this._logHandler(this,G.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,G.WARN,...e),this._logHandler(this,G.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...e),this._logHandler(this,G.ERROR,...e)}};var xw=(n,e)=>e.some(t=>n instanceof t),mm,gm;function Ow(){return mm||(mm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lw(){return gm||(gm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var _m=new WeakMap,eu=new WeakMap,ym=new WeakMap,Zc=new WeakMap,nu=new WeakMap;function Vw(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(ut(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&_m.set(t,n)}).catch(()=>{}),nu.set(e,n),e}function Mw(n){if(eu.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});eu.set(n,e)}var tu={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return eu.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ym.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ut(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vm(n){tu=n(tu)}function Fw(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(co(this),e,...t);return ym.set(r,e.sort?e.sort():[e]),ut(r)}:Lw().includes(n)?function(...e){return n.apply(co(this),e),ut(_m.get(this))}:function(...e){return ut(n.apply(co(this),e))}}function Uw(n){return typeof n=="function"?Fw(n):(n instanceof IDBTransaction&&Mw(n),xw(n,Ow())?new Proxy(n,tu):n)}function ut(n){if(n instanceof IDBRequest)return Vw(n);if(Zc.has(n))return Zc.get(n);let e=Uw(n);return e!==n&&(Zc.set(n,e),nu.set(e,n)),e}var co=n=>nu.get(n);function wm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=ut(o);return r&&o.addEventListener("upgradeneeded",u=>{r(ut(o.result),u.oldVersion,u.newVersion,ut(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}var Bw=["get","getKey","getAll","getAllKeys","count"],qw=["put","add","delete","clear"],ru=new Map;function Im(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ru.get(e))return ru.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=qw.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Bw.includes(t)))return;let s=function(o,...c){return y(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&u.done]))[0]})};return ru.set(e,s),s}vm(n=>An(ot({},n),{get:(e,t,r)=>Im(e,t)||n.get(e,t,r),has:(e,t)=>!!Im(e,t)||n.has(e,t)}));var su=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($w(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function $w(n){let e=n.getComponent();return e?.type==="VERSION"}var ou="@firebase/app",Em="0.10.13";var Ot=new ct("@firebase/app"),Ww="@firebase/app-compat",jw="@firebase/analytics-compat",zw="@firebase/analytics",Gw="@firebase/app-check-compat",Kw="@firebase/app-check",Hw="@firebase/auth",Qw="@firebase/auth-compat",Yw="@firebase/database",Jw="@firebase/data-connect",Xw="@firebase/database-compat",Zw="@firebase/functions",eE="@firebase/functions-compat",tE="@firebase/installations",nE="@firebase/installations-compat",rE="@firebase/messaging",iE="@firebase/messaging-compat",sE="@firebase/performance",oE="@firebase/performance-compat",aE="@firebase/remote-config",cE="@firebase/remote-config-compat",uE="@firebase/storage",lE="@firebase/storage-compat",hE="@firebase/firestore",dE="@firebase/vertexai-preview",fE="@firebase/firestore-compat",pE="firebase",mE="10.14.1";var au="[DEFAULT]",gE={[ou]:"fire-core",[Ww]:"fire-core-compat",[zw]:"fire-analytics",[jw]:"fire-analytics-compat",[Kw]:"fire-app-check",[Gw]:"fire-app-check-compat",[Hw]:"fire-auth",[Qw]:"fire-auth-compat",[Yw]:"fire-rtdb",[Jw]:"fire-data-connect",[Xw]:"fire-rtdb-compat",[Zw]:"fire-fn",[eE]:"fire-fn-compat",[tE]:"fire-iid",[nE]:"fire-iid-compat",[rE]:"fire-fcm",[iE]:"fire-fcm-compat",[sE]:"fire-perf",[oE]:"fire-perf-compat",[aE]:"fire-rc",[cE]:"fire-rc-compat",[uE]:"fire-gcs",[lE]:"fire-gcs-compat",[hE]:"fire-fst",[fE]:"fire-fst-compat",[dE]:"fire-vertex","fire-js":"fire-js",[pE]:"fire-js-all"};var Di=new Map,_E=new Map,cu=new Map;function Tm(n,e){try{n.container.addComponent(e)}catch(t){Ot.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function lt(n){let e=n.name;if(cu.has(e))return Ot.debug(`There were multiple attempts to register component ${e}.`),!1;cu.set(e,n);for(let t of Di.values())Tm(t,n);for(let t of _E.values())Tm(t,n);return!0}function Nn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function tt(n){return n.settings!==void 0}var yE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Xt=new xt("app","Firebase",yE);var uu=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new We("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xt.create("app-deleted",{appName:this._name})}};var ht=mE;function du(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:au,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Xt.create("bad-app-name",{appName:String(i)});if(t||(t=Yc()),!t)throw Xt.create("no-options");let s=Di.get(i);if(s){if(Cn(t,s.options)&&Cn(r,s.config))return s;throw Xt.create("duplicate-app",{appName:i})}let o=new ki(i);for(let u of cu.values())o.addComponent(u);let c=new uu(t,r,o);return Di.set(i,c),c}function Zt(n=au){let e=Di.get(n);if(!e&&n===au&&Yc())return du();if(!e)throw Xt.create("no-app",{appName:n});return e}function uo(){return Array.from(Di.values())}function le(n,e,t){var r;let i=(r=gE[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ot.warn(c.join(" "));return}lt(new We(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var vE="firebase-heartbeat-database",IE=1,xi="firebase-heartbeat-store",iu=null;function Cm(){return iu||(iu=wm(vE,IE,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(xi)}catch(t){console.warn(t)}}}}).catch(n=>{throw Xt.create("idb-open",{originalErrorMessage:n.message})})),iu}function wE(n){return y(this,null,function*(){try{let t=(yield Cm()).transaction(xi),r=yield t.objectStore(xi).get(Rm(n));return yield t.done,r}catch(e){if(e instanceof ze)Ot.warn(e.message);else{let t=Xt.create("idb-get",{originalErrorMessage:e?.message});Ot.warn(t.message)}}})}function Am(n,e){return y(this,null,function*(){try{let r=(yield Cm()).transaction(xi,"readwrite");yield r.objectStore(xi).put(e,Rm(n)),yield r.done}catch(t){if(t instanceof ze)Ot.warn(t.message);else{let r=Xt.create("idb-set",{originalErrorMessage:t?.message});Ot.warn(r.message)}}})}function Rm(n){return`${n.name}!${n.options.appId}`}var EE=1024,TE=30*24*60*60*1e3,lu=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new hu(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return y(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Sm();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let c=new Date(o.date).valueOf();return Date.now()-c<=TE}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Ot.warn(r)}})}getHeartbeatsHeader(){return y(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Sm(),{heartbeatsToSend:r,unsentEntries:i}=AE(this._heartbeatsCache.heartbeats),s=Si(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Ot.warn(t),""}})}};function Sm(){return new Date().toISOString().substring(0,10)}function AE(n,e=EE){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),bm(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),bm(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var hu=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return y(this,null,function*(){return Xc()?um().then(()=>!0).catch(()=>!1):!1})}read(){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield wE(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Am(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return y(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Am(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function bm(n){return Si(JSON.stringify({version:2,heartbeats:n})).length}function SE(n){lt(new We("platform-logger",e=>new su(e),"PRIVATE")),lt(new We("heartbeat",e=>new lu(e),"PRIVATE")),le(ou,Em,n),le(ou,Em,"esm2017"),le("fire-js","")}SE("");var bE="firebase",CE="10.14.1";le(bE,CE,"app");var Lt=new Jp("ANGULARFIRE2_VERSION");function _r(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Dn=(n,e)=>{let t=e?[e]:uo(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},en=class{constructor(){return Dn(RE)}},RE="app-check";function gr(){}var lo=class{zone;delegate;constructor(e,t=zp){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},fu=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",gr,{},gr,gr)),t.pipe(Kp({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},tn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new lo(Zone.current)),this.insideAngular=t.run(()=>new lo(Zone.current,jp)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Nt(He))};static \u0275prov=hr({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ho(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function PE(n){return ho().ngZone.runOutsideAngular(()=>n())}function kn(n){return ho().ngZone.run(()=>n())}function NE(n){return kE(ho())(n)}function kE(n){return function(t){return t=t.lift(new fu(n.ngZone)),t.pipe(Uc(n.outsideAngular),Fc(n.insideAngular))}}var DE=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),kn(()=>n.apply(void 0,r))},ne=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=kn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",gr,{},gr,gr))),r[s]=DE(r[s],t));let i=PE(()=>n.apply(this,r));if(!e)if(i instanceof Pt){let s=ho();return i.pipe(Uc(s.outsideAngular),Fc(s.insideAngular))}else return kn(()=>i);return i instanceof Pt?i.pipe(NE):i instanceof Promise?kn(()=>new Promise((s,o)=>i.then(c=>kn(()=>s(c)),c=>kn(()=>o(c))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:kn(()=>i)};var nt=class{constructor(e){return e}},Vt=class{constructor(){return uo()}};function xE(n){return n&&n.length===1?n[0]:new nt(Zt())}var pu=new Yt("angularfire2._apps"),OE={provide:nt,useFactory:xE,deps:[[new Se,pu]]},LE={provide:Vt,deps:[[new Se,pu]]};function VE(n){return(e,t)=>{let r=t.get(Yp);le("angularfire",Lt.full,"core"),le("angularfire",Lt.full,"app"),le("angular",Xp.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new nt(i)}}function KP(n,...e){return Jt([OE,LE,{provide:pu,useFactory:VE(n),multi:!0,deps:[He,kt,tn,...e]}])}var HP=ne(du,!0);function Gm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Km=Gm,Hm=new xt("auth","Firebase",Gm());var yo=new ct("@firebase/auth");function ME(n,...e){yo.logLevel<=G.WARN&&yo.warn(`Auth (${ht}): ${n}`,...e)}function po(n,...e){yo.logLevel<=G.ERROR&&yo.error(`Auth (${ht}): ${n}`,...e)}function ft(n,...e){throw Mu(n,...e)}function xn(n,...e){return Mu(n,...e)}function Qm(n,e,t){let r=Object.assign(Object.assign({},Km()),{[e]:t});return new xt("auth","Firebase",r).create(e,{appName:n.name})}function Ut(n){return Qm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mu(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Hm.create(n,...e)}function F(n,e,...t){if(!n)throw Mu(e,...t)}function Mt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw po(e),new Error(e)}function rn(n,e){n||Mt(e)}function yu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function FE(){return Nm()==="http:"||Nm()==="https:"}function Nm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function UE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(FE()||om()||"connection"in navigator)?navigator.onLine:!0}function BE(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var On=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,rn(t>e,"Short delay should be less than long delay!"),this.isMobile=Ci()||oo()}get(){return UE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Fu(n,e){rn(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var vo=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Mt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Mt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Mt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var qE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var $E=new On(3e4,6e4);function sn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function on(s,o,c,u){return y(this,arguments,function*(n,e,t,r,i={}){return Ym(n,i,()=>y(this,null,function*(){let h={},f={};r&&(e==="GET"?f=r:h={body:JSON.stringify(r)});let m=Rn(Object.assign({key:n.config.apiKey},f)).slice(1),g=yield n._getAdditionalHeaders();g["Content-Type"]="application/json",n.languageCode&&(g["X-Firebase-Locale"]=n.languageCode);let E=Object.assign({method:e,headers:g},h);return sm()||(E.referrerPolicy="no-referrer"),vo.fetch()(Jm(n,n.config.apiHost,t,m),E)}))})}function Ym(n,e,t){return y(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},qE),e);try{let i=new vu(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw fo(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw fo(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw fo(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw fo(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Qm(n,f,h);ft(n,f)}}catch(i){if(i instanceof ze)throw i;ft(n,"network-request-failed",{message:String(i)})}})}function qi(s,o,c,u){return y(this,arguments,function*(n,e,t,r,i={}){let h=yield on(n,e,t,r,i);return"mfaPendingCredential"in h&&ft(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function Jm(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Fu(n.config,i):`${n.config.apiScheme}://${i}`}function WE(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var vu=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(xn(this.auth,"network-request-failed")),$E.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function fo(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=xn(n,e,r);return i.customData._tokenResponse=t,i}function km(n){return n!==void 0&&n.enterprise!==void 0}var Iu=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return WE(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function jE(n,e){return y(this,null,function*(){return on(n,"GET","/v2/recaptchaConfig",sn(n,e))})}function zE(n,e){return y(this,null,function*(){return on(n,"POST","/v1/accounts:delete",e)})}function Xm(n,e){return y(this,null,function*(){return on(n,"POST","/v1/accounts:lookup",e)})}function Oi(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Uu(n,e=!1){return y(this,null,function*(){let t=ie(n),r=yield t.getIdToken(e),i=Bu(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Oi(mu(i.auth_time)),issuedAtTime:Oi(mu(i.iat)),expirationTime:Oi(mu(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function mu(n){return Number(n)*1e3}function Bu(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return po("JWT malformed, contained fewer than 3 sections"),null;try{let i=bi(t);return i?JSON.parse(i):(po("Failed to decode base64 JWT payload"),null)}catch(i){return po("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Dm(n){let e=Bu(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Vi(n,e,t=!1){return y(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof ze&&GE(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function GE({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var wu=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>y(this,null,function*(){yield this.iteration()}),t)}iteration(){return y(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Mi=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Oi(this.lastLoginAt),this.creationTime=Oi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Io(n){return y(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Vi(n,Xm(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Zm(s.providerUserInfo):[],c=KE(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!c?.length,f=u?h:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Mi(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,m)})}function qu(n){return y(this,null,function*(){let e=ie(n);yield Io(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function KE(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Zm(n){return n.map(e=>{var{providerId:t}=e,r=Mc(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function HE(n,e){return y(this,null,function*(){let t=yield Ym(n,{},()=>y(this,null,function*(){let r=Rn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=Jm(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",vo.fetch()(o,{method:"POST",headers:c,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function QE(n,e){return y(this,null,function*(){return on(n,"POST","/v2/accounts:revokeToken",sn(n,e))})}var Li=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Dm(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=Dm(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return y(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return y(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield HE(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Mt("not implemented")}};function nn(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var yr=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Mc(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new wu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Mi(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return y(this,null,function*(){let t=yield Vi(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Uu(this,e)}reload(){return qu(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return y(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Io(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return y(this,null,function*(){if(tt(this.auth.app))return Promise.reject(Ut(this.auth));let e=yield this.getIdToken();return yield Vi(this,zE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,c,u,h,f;let m=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(i=t.email)!==null&&i!==void 0?i:void 0,E=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,R=(o=t.photoURL)!==null&&o!==void 0?o:void 0,k=(c=t.tenantId)!==null&&c!==void 0?c:void 0,N=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,B=(h=t.createdAt)!==null&&h!==void 0?h:void 0,j=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:z,emailVerified:oe,isAnonymous:Ve,providerData:re,stsTokenManager:T}=t;F(z&&T,e,"internal-error");let _=Li.fromJSON(this.name,T);F(typeof z=="string",e,"internal-error"),nn(m,e.name),nn(g,e.name),F(typeof oe=="boolean",e,"internal-error"),F(typeof Ve=="boolean",e,"internal-error"),nn(E,e.name),nn(R,e.name),nn(k,e.name),nn(N,e.name),nn(B,e.name),nn(j,e.name);let I=new n({uid:z,auth:e,email:g,emailVerified:oe,displayName:m,isAnonymous:Ve,photoURL:R,phoneNumber:E,tenantId:k,stsTokenManager:_,createdAt:B,lastLoginAt:j});return re&&Array.isArray(re)&&(I.providerData=re.map(w=>Object.assign({},w))),N&&(I._redirectEventId=N),I}static _fromIdTokenResponse(e,t,r=!1){return y(this,null,function*(){let i=new Li;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Io(s),s})}static _fromGetAccountInfoResponse(e,t,r){return y(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Zm(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new Li;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new Mi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u})}};var xm=new Map;function Ft(n){rn(n instanceof Function,"Expected a class definition");let e=xm.get(n);return e?(rn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xm.set(n,e),e)}var YE=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return y(this,null,function*(){return!0})}_set(t,r){return y(this,null,function*(){this.storage[t]=r})}_get(t){return y(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return y(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Eu=YE;function mo(n,e,t){return`firebase:${n}:${e}:${t}`}var wo=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=mo(this.userKey,i.apiKey,s),this.fullPersistenceKey=mo("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return y(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?yr._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return y(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return y(this,null,function*(){if(!t.length)return new n(Ft(Eu),e,r);let i=(yield Promise.all(t.map(h=>y(this,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||Ft(Eu),o=mo(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let m=yr._fromJSON(e,f);h!==s&&(c=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>y(this,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new n(s,e,r))})}};function Om(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sg(e))return"Blackberry";if(og(e))return"Webos";if(tg(e))return"Safari";if((e.includes("chrome/")||ng(e))&&!e.includes("edge/"))return"Chrome";if(ig(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function eg(n=Ee()){return/firefox\//i.test(n)}function tg(n=Ee()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ng(n=Ee()){return/crios\//i.test(n)}function rg(n=Ee()){return/iemobile/i.test(n)}function ig(n=Ee()){return/android/i.test(n)}function sg(n=Ee()){return/blackberry/i.test(n)}function og(n=Ee()){return/webos/i.test(n)}function $u(n=Ee()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function JE(n=Ee()){var e;return $u(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function XE(){return am()&&document.documentMode===10}function ag(n=Ee()){return $u(n)||ig(n)||og(n)||sg(n)||/windows phone/i.test(n)||rg(n)}function cg(n,e=[]){let t;switch(n){case"Browser":t=Om(Ee());break;case"Worker":t=`${Om(Ee())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ht}/${r}`}var Tu=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return y(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function ZE(t){return y(this,arguments,function*(n,e={}){return on(n,"GET","/v2/passwordPolicy",sn(n,e))})}var eT=6,Au=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:eT,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Su=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Eo(this),this.idTokenSubscription=new Eo(this),this.beforeStateQueue=new Tu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Hm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ft(t)),this._initializationPromise=this.queue(()=>y(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield wo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return y(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return y(this,null,function*(){try{let t=yield Xm(this,{idToken:e}),r=yield yr._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return y(this,null,function*(){var t;if(tt(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&u?.user&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return y(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return y(this,null,function*(){try{yield Io(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=BE()}_delete(){return y(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return y(this,null,function*(){if(tt(this.app))return Promise.reject(Ut(this));let t=e?ie(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return y(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>y(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return y(this,null,function*(){return tt(this.app)?Promise.reject(Ut(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return tt(this.app)?Promise.reject(Ut(this)):this.queue(()=>y(this,null,function*(){yield this.assertedPersistence.setPersistence(Ft(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return y(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return y(this,null,function*(){let e=yield ZE(this),t=new Au(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new xt("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return y(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield QE(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return y(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return y(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Ft(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield wo.create(this,[Ft(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return y(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>y(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return y(this,null,function*(){if(e===this.currentUser)return this.queue(()=>y(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return y(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return y(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return y(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&ME(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Vn(n){return ie(n)}var Eo=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=fm(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Po={loadJS(){return y(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tT(n){Po=n}function ug(n){return Po.loadJS(n)}function nT(){return Po.recaptchaEnterpriseScript}function rT(){return Po.gapiScript}function lg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var iT="recaptcha-enterprise",sT="NO_RECAPTCHA",bu=class{constructor(e){this.type=iT,this.auth=Vn(e)}verify(e="verify",t=!1){return y(this,null,function*(){function r(s){return y(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>y(this,null,function*(){jE(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Iu(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;km(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(sT)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&km(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=nT();u.length!==0&&(u+=c),ug(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})})}};function Lm(n,e,t,r=!1){return y(this,null,function*(){let i=new bu(n),s;try{s=yield i.verify(t)}catch{s=yield i.verify(t,!0)}let o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function Cu(n,e,t,r){return y(this,null,function*(){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield Lm(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(s=>y(this,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=yield Lm(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)}))})}function Wu(n,e){let t=Nn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(Cn(s,e??{}))return i;ft(i,"already-initialized")}return t.initialize({options:e})}function oT(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ft);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function ju(n,e,t){let r=Vn(n);F(r._canInitEmulator,r,"emulator-config-failed"),F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=hg(e),{host:o,port:c}=aT(e),u=c===null?"":`:${c}`;r.config.emulator={url:`${s}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||cT()}function hg(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function aT(n){let e=hg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Vm(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:Vm(o)}}}function Vm(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function cT(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Fi=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Mt("not implemented")}_getIdTokenResponse(e){return Mt("not implemented")}_linkToIdToken(e,t){return Mt("not implemented")}_getReauthenticationResolver(e){return Mt("not implemented")}};function uT(n,e){return y(this,null,function*(){return on(n,"POST","/v1/accounts:signUp",e)})}function lT(n,e){return y(this,null,function*(){return qi(n,"POST","/v1/accounts:signInWithPassword",sn(n,e))})}function hT(n,e){return y(this,null,function*(){return qi(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))})}function dT(n,e){return y(this,null,function*(){return qi(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))})}var Ui=class n extends Fi{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return y(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cu(e,t,"signInWithPassword",lT);case"emailLink":return hT(e,{email:this._email,oobCode:this._password});default:ft(e,"internal-error")}})}_linkToIdToken(e,t){return y(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cu(e,r,"signUpPassword",uT);case"emailLink":return dT(e,{idToken:t,email:this._email,oobCode:this._password});default:ft(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function gu(n,e){return y(this,null,function*(){return qi(n,"POST","/v1/accounts:signInWithIdp",sn(n,e))})}function fT(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function pT(n){let e=fr(pr(n)).link,t=e?fr(pr(e)).deep_link_id:null,r=fr(pr(n)).deep_link_id;return(r?fr(pr(r)).link:null)||r||t||e||n}var To=class n{constructor(e){var t,r,i,s,o,c;let u=fr(pr(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,m=fT((i=u.mode)!==null&&i!==void 0?i:null);F(h&&f&&m,"argument-error"),this.apiKey=h,this.operation=m,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=pT(e);try{return new n(t)}catch{return null}}};var dg=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Ui._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=To.parseLink(r);return F(i,"argument-error"),Ui._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),Ao=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Ru=class extends Ao{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function mT(n,e){return y(this,null,function*(){return qi(n,"POST","/v1/accounts:signUp",sn(n,e))})}var vr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return y(this,null,function*(){let s=yield yr._fromIdTokenResponse(e,r,i),o=Mm(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return y(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Mm(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Mm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Pu=class n extends ze{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function fg(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Pu._fromErrorAndOperation(n,s,e,r):s})}function gT(n,e,t=!1){return y(this,null,function*(){let r=yield Vi(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return vr._forOperation(n,"link",r)})}function _T(n,e,t=!1){return y(this,null,function*(){let{auth:r}=n;if(tt(r.app))return Promise.reject(Ut(r));let i="reauthenticate";try{let s=yield Vi(n,fg(r,i,e,n),t);F(s.idToken,r,"internal-error");let o=Bu(s.idToken);F(o,r,"internal-error");let{sub:c}=o;return F(n.uid===c,r,"user-mismatch"),vr._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&ft(r,"user-mismatch"),s}})}function pg(n,e,t=!1){return y(this,null,function*(){if(tt(n.app))return Promise.reject(Ut(n));let r="signIn",i=yield fg(n,r,e),s=yield vr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function zu(n,e){return y(this,null,function*(){return pg(Vn(n),e)})}function mg(n){return y(this,null,function*(){let e=Vn(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Gu(n,e,t){return y(this,null,function*(){if(tt(n.app))return Promise.reject(Ut(n));let r=Vn(n),o=yield Cu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",mT).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&mg(n),u}),c=yield vr._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(c.user),c})}function Ku(n,e,t){return tt(n.app)?Promise.reject(Ut(n)):zu(ie(n),dg.credential(e,t)).catch(r=>y(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&mg(n),r}))}function No(n,e,t,r){return ie(n).onIdTokenChanged(e,t,r)}function Hu(n,e,t){return ie(n).beforeAuthStateChanged(e,t)}function ko(n,e,t,r){return ie(n).onAuthStateChanged(e,t,r)}function Qu(n){return ie(n).signOut()}var So="__sak";var bo=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(So,"1"),this.storage.removeItem(So),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var yT=1e3,vT=10,IT=(()=>{class n extends bo{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ag(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);XE()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,vT):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},yT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return y(this,null,function*(){yield Qt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return y(this,null,function*(){let r=yield Qt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return y(this,null,function*(){yield Qt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),gg=IT;var wT=(()=>{class n extends bo{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Yu=wT;function ET(n){return Promise.all(n.map(e=>y(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var TT=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return y(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>y(this,null,function*(){return f(r.origin,o)})),h=yield ET(u);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function _g(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Nu=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return y(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=_g("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(m){let g=m;if(g.data.eventId===h)switch(g.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(g.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function dt(){return window}function AT(n){dt().location.href=n}function yg(){return typeof dt().WorkerGlobalScope<"u"&&typeof dt().importScripts=="function"}function ST(){return y(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function bT(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function CT(){return yg()?self:null}var vg="firebaseLocalStorageDb",RT=1,Co="firebaseLocalStorage",Ig="fbase_key",Ln=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Do(n,e){return n.transaction([Co],e?"readwrite":"readonly").objectStore(Co)}function PT(){let n=indexedDB.deleteDatabase(vg);return new Ln(n).toPromise()}function ku(){let n=indexedDB.open(vg,RT);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Co,{keyPath:Ig})}catch(i){t(i)}}),n.addEventListener("success",()=>y(this,null,function*(){let r=n.result;r.objectStoreNames.contains(Co)?e(r):(r.close(),yield PT(),e(yield ku()))}))})}function Fm(n,e,t){return y(this,null,function*(){let r=Do(n,!0).put({[Ig]:e,value:t});return new Ln(r).toPromise()})}function NT(n,e){return y(this,null,function*(){let t=Do(n,!1).get(e),r=yield new Ln(t).toPromise();return r===void 0?null:r.value})}function Um(n,e){let t=Do(n,!0).delete(e);return new Ln(t).toPromise()}var kT=800,DT=3,xT=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return y(this,null,function*(){return this.db?this.db:(this.db=yield ku(),this.db)})}_withRetries(t){return y(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>DT)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return y(this,null,function*(){return yg()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return y(this,null,function*(){this.receiver=TT._getInstance(CT()),this.receiver._subscribe("keyChanged",(t,r)=>y(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>y(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return y(this,null,function*(){var t,r;if(this.activeServiceWorker=yield ST(),!this.activeServiceWorker)return;this.sender=new Nu(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return y(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||bT()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return y(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ku();return yield Fm(t,So,"1"),yield Um(t,So),!0}catch{}return!1})}_withPendingWrite(t){return y(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(i=>Fm(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return y(this,null,function*(){let r=yield this._withRetries(i=>NT(i,t));return this.localCache[t]=r,r})}_remove(t){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(r=>Um(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return y(this,null,function*(){let t=yield this._withRetries(s=>{let o=Do(s,!1).getAll();return new Ln(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>y(this,null,function*(){return this._poll()}),kT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),wg=xT;var nN=lg("rcb"),rN=new On(3e4,6e4);function OT(n,e){return e?Ft(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Bi=class extends Fi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return gu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return gu(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function LT(n){return pg(n.auth,new Bi(n),n.bypassAuthState)}function VT(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),_T(t,new Bi(n),n.bypassAuthState)}function MT(n){return y(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),gT(t,new Bi(n),n.bypassAuthState)})}var Du=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>y(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return y(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return LT;case"linkViaPopup":case"linkViaRedirect":return MT;case"reauthViaPopup":case"reauthViaRedirect":return VT;default:ft(this.auth,"internal-error")}}resolve(e){rn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var iN=new On(2e3,1e4);var FT="pendingRedirect",go=new Map,xu=class n extends Du{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return y(this,null,function*(){let e=go.get(this.auth._key());if(!e){try{let r=(yield UT(this.resolver,this.auth))?yield Qt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}go.set(this.auth._key(),e)}return this.bypassAuthState||go.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return y(this,null,function*(){if(e.type==="signInViaRedirect")return Qt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Qt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return y(this,null,function*(){})}cleanUp(){}};function UT(n,e){return y(this,null,function*(){let t=$T(e),r=qT(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function BT(n,e){go.set(n._key(),e)}function qT(n){return Ft(n._redirectPersistence)}function $T(n){return mo(FT,n.config.apiKey,n.name)}function WT(n,e,t=!1){return y(this,null,function*(){if(tt(n.app))return Promise.reject(Ut(n));let r=Vn(n),i=OT(r,e),o=yield new xu(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var jT=10*60*1e3,Ou=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zT(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Eg(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(xn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jT&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bm(e))}saveEventToCache(e){this.cachedEventUids.add(Bm(e)),this.lastProcessedEventTime=Date.now()}};function Bm(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Eg({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function zT(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Eg(n);default:return!1}}function GT(t){return y(this,arguments,function*(n,e={}){return on(n,"GET","/v1/projects",e)})}var KT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HT=/^https?/;function QT(n){return y(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield GT(n);for(let t of e)try{if(YT(t))return}catch{}ft(n,"unauthorized-domain")})}function YT(n){let e=yu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!HT.test(t))return!1;if(KT.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var JT=new On(3e4,6e4);function qm(){let n=dt().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function XT(n){return new Promise((e,t)=>{var r,i,s;function o(){qm(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{qm(),t(xn(n,"network-request-failed"))},timeout:JT.get()})}if(!((i=(r=dt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=dt().gapi)===null||s===void 0)&&s.load)o();else{let c=lg("iframefcb");return dt()[c]=()=>{gapi.load?o():t(xn(n,"network-request-failed"))},ug(`${rT()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw _o=null,e})}var _o=null;function ZT(n){return _o=_o||XT(n),_o}var eA=new On(5e3,15e3),tA="__/auth/iframe",nA="emulator/auth/iframe",rA={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},iA=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function sA(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Fu(e,nA):`https://${n.config.authDomain}/${tA}`,r={apiKey:e.apiKey,appName:n.name,v:ht},i=iA.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Rn(r).slice(1)}`}function oA(n){return y(this,null,function*(){let e=yield ZT(n),t=dt().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:sA(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rA,dontclear:!0},r=>new Promise((i,s)=>y(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=xn(n,"network-request-failed"),c=dt().setTimeout(()=>{s(o)},eA.get());function u(){dt().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})})))})}var aA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cA=500,uA=600,lA="_blank",hA="http://localhost",Ro=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function dA(n,e,t,r=cA,i=uA){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u=Object.assign(Object.assign({},aA),{width:r.toString(),height:i.toString(),top:s,left:o}),h=Ee().toLowerCase();t&&(c=ng(h)?lA:t),eg(h)&&(e=e||hA,u.scrollbars="yes");let f=Object.entries(u).reduce((g,[E,R])=>`${g}${E}=${R},`,"");if(JE(h)&&c!=="_self")return fA(e||"",c),new Ro(null);let m=window.open(e||"",c,f);F(m,n,"popup-blocked");try{m.focus()}catch{}return new Ro(m)}function fA(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var pA="__/auth/handler",mA="emulator/auth/handler",gA=encodeURIComponent("fac");function $m(n,e,t,r,i,s){return y(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ht,eventId:i};if(e instanceof Ao){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ri(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,m]of Object.entries(s||{}))o[f]=m}if(e instanceof Ru){let f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield n._getAppCheckToken(),h=u?`#${gA}=${encodeURIComponent(u)}`:"";return`${_A(n)}?${Rn(c).slice(1)}${h}`})}function _A({config:n}){return n.emulator?Fu(n,mA):`https://${n.authDomain}/${pA}`}var _u="webStorageSupport",Lu=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Yu,this._completeRedirectFn=WT,this._overrideRedirectResult=BT}_openPopup(e,t,r,i){return y(this,null,function*(){var s;rn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield $m(e,t,r,yu(),i);return dA(e,o,_g())})}_openRedirect(e,t,r,i){return y(this,null,function*(){yield this._originValidation(e);let s=yield $m(e,t,r,yu(),i);return AT(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(rn(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return y(this,null,function*(){let t=yield oA(e),r=new Ou(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_u,{type:_u},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[_u];o!==void 0&&t(!!o),ft(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=QT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ag()||tg()||$u()}},Tg=Lu;var Wm="@firebase/auth",jm="1.7.9";var Vu=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return y(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function yA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function vA(n){lt(new We("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;F(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cg(n)},h=new Su(r,i,s,u);return oT(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),lt(new We("auth-internal",e=>{let t=Vn(e.getProvider("auth").getImmediate());return(r=>new Vu(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),le(Wm,jm,yA(n)),le(Wm,jm,"esm2017")}var IA=5*60,wA=Jc("authIdTokenMaxAge")||IA,zm=null,EA=n=>e=>y(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>wA)return;let i=t?.token;zm!==i&&(zm=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Ju(n=Zt()){let e=Nn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Wu(n,{popupRedirectResolver:Tg,persistence:[wg,gg,Yu]}),r=Jc("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=EA(s.toString());Hu(t,o,()=>o(t.currentUser)),No(t,c=>o(c))}}let i=Qc("auth");return i&&ju(t,`http://${i}`),t}function TA(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}tT({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=xn("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",TA().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});vA("Browser");function Sg(n){return new Pt(function(e){var t=ko(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var bg="auth",Mn=class{constructor(e){return e}},Fn=class{constructor(){return Dn(bg)}};var Xu=new Yt("angularfire2.auth-instances");function dS(n,e){let t=_r(bg,n,e);return t&&new Mn(t)}function fS(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Mn(r)}}var pS={provide:Fn,deps:[[new Se,Xu]]},mS={provide:Mn,useFactory:dS,deps:[[new Se,Xu],nt]};function KN(n,...e){return le("angularfire",Lt.full,"auth"),Jt([mS,pS,{provide:Xu,useFactory:fS(n),multi:!0,deps:[He,kt,tn,Vt,[new Se,en],...e]}])}var Cg=ne(Sg,!0);var Rg=ne(Gu,!0);var HN=ne(Ju,!0);var Pg=ne(Ku,!0);var Ng=ne(Qu,!0);var kg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dg={};var an,Zu;(function(){var n;function e(T,_){function I(){}I.prototype=_.prototype,T.D=_.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(w,A,b){for(var v=Array(arguments.length-2),bt=2;bt<arguments.length;bt++)v[bt-2]=arguments[bt];return _.prototype[A].apply(w,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,_,I){I||(I=0);var w=Array(16);if(typeof _=="string")for(var A=0;16>A;++A)w[A]=_.charCodeAt(I++)|_.charCodeAt(I++)<<8|_.charCodeAt(I++)<<16|_.charCodeAt(I++)<<24;else for(A=0;16>A;++A)w[A]=_[I++]|_[I++]<<8|_[I++]<<16|_[I++]<<24;_=T.g[0],I=T.g[1],A=T.g[2];var b=T.g[3],v=_+(b^I&(A^b))+w[0]+3614090360&4294967295;_=I+(v<<7&4294967295|v>>>25),v=b+(A^_&(I^A))+w[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=A+(I^b&(_^I))+w[2]+606105819&4294967295,A=b+(v<<17&4294967295|v>>>15),v=I+(_^A&(b^_))+w[3]+3250441966&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(b^I&(A^b))+w[4]+4118548399&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(A^_&(I^A))+w[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=A+(I^b&(_^I))+w[6]+2821735955&4294967295,A=b+(v<<17&4294967295|v>>>15),v=I+(_^A&(b^_))+w[7]+4249261313&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(b^I&(A^b))+w[8]+1770035416&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(A^_&(I^A))+w[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=A+(I^b&(_^I))+w[10]+4294925233&4294967295,A=b+(v<<17&4294967295|v>>>15),v=I+(_^A&(b^_))+w[11]+2304563134&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(b^I&(A^b))+w[12]+1804603682&4294967295,_=I+(v<<7&4294967295|v>>>25),v=b+(A^_&(I^A))+w[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=A+(I^b&(_^I))+w[14]+2792965006&4294967295,A=b+(v<<17&4294967295|v>>>15),v=I+(_^A&(b^_))+w[15]+1236535329&4294967295,I=A+(v<<22&4294967295|v>>>10),v=_+(A^b&(I^A))+w[1]+4129170786&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^A&(_^I))+w[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(b^_))+w[11]+643717713&4294967295,A=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(A^b))+w[0]+3921069994&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^b&(I^A))+w[5]+3593408605&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^A&(_^I))+w[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(b^_))+w[15]+3634488961&4294967295,A=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(A^b))+w[4]+3889429448&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^b&(I^A))+w[9]+568446438&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^A&(_^I))+w[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(b^_))+w[3]+4107603335&4294967295,A=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(A^b))+w[8]+1163531501&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(A^b&(I^A))+w[13]+2850285829&4294967295,_=I+(v<<5&4294967295|v>>>27),v=b+(I^A&(_^I))+w[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=A+(_^I&(b^_))+w[7]+1735328473&4294967295,A=b+(v<<14&4294967295|v>>>18),v=I+(b^_&(A^b))+w[12]+2368359562&4294967295,I=A+(v<<20&4294967295|v>>>12),v=_+(I^A^b)+w[5]+4294588738&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^A)+w[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=A+(b^_^I)+w[11]+1839030562&4294967295,A=b+(v<<16&4294967295|v>>>16),v=I+(A^b^_)+w[14]+4259657740&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^b)+w[1]+2763975236&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^A)+w[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=A+(b^_^I)+w[7]+4139469664&4294967295,A=b+(v<<16&4294967295|v>>>16),v=I+(A^b^_)+w[10]+3200236656&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^b)+w[13]+681279174&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^A)+w[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=A+(b^_^I)+w[3]+3572445317&4294967295,A=b+(v<<16&4294967295|v>>>16),v=I+(A^b^_)+w[6]+76029189&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(I^A^b)+w[9]+3654602809&4294967295,_=I+(v<<4&4294967295|v>>>28),v=b+(_^I^A)+w[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=A+(b^_^I)+w[15]+530742520&4294967295,A=b+(v<<16&4294967295|v>>>16),v=I+(A^b^_)+w[2]+3299628645&4294967295,I=A+(v<<23&4294967295|v>>>9),v=_+(A^(I|~b))+w[0]+4096336452&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~A))+w[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=A+(_^(b|~I))+w[14]+2878612391&4294967295,A=b+(v<<15&4294967295|v>>>17),v=I+(b^(A|~_))+w[5]+4237533241&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~b))+w[12]+1700485571&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~A))+w[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=A+(_^(b|~I))+w[10]+4293915773&4294967295,A=b+(v<<15&4294967295|v>>>17),v=I+(b^(A|~_))+w[1]+2240044497&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~b))+w[8]+1873313359&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~A))+w[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=A+(_^(b|~I))+w[6]+2734768916&4294967295,A=b+(v<<15&4294967295|v>>>17),v=I+(b^(A|~_))+w[13]+1309151649&4294967295,I=A+(v<<21&4294967295|v>>>11),v=_+(A^(I|~b))+w[4]+4149444226&4294967295,_=I+(v<<6&4294967295|v>>>26),v=b+(I^(_|~A))+w[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=A+(_^(b|~I))+w[2]+718787259&4294967295,A=b+(v<<15&4294967295|v>>>17),v=I+(b^(A|~_))+w[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(A+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+A&4294967295,T.g[3]=T.g[3]+b&4294967295}r.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var I=_-this.blockSize,w=this.B,A=this.h,b=0;b<_;){if(A==0)for(;b<=I;)i(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<_;)if(w[A++]=T.charCodeAt(b++),A==this.blockSize){i(this,w),A=0;break}}else for(;b<_;)if(w[A++]=T[b++],A==this.blockSize){i(this,w),A=0;break}}this.h=A,this.o+=_},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var I=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=I&255,I/=256;for(this.u(T),T=Array(16),_=I=0;4>_;++_)for(var w=0;32>w;w+=8)T[I++]=this.g[_]>>>w&255;return T};function s(T,_){var I=c;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=_(T)}function o(T,_){this.h=_;for(var I=[],w=!0,A=T.length-1;0<=A;A--){var b=T[A]|0;w&&b==_||(I[A]=b,w=!1)}this.g=I}var c={};function u(T){return-128<=T&&128>T?s(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return N(h(-T));for(var _=[],I=1,w=0;T>=I;w++)_[w]=T/I|0,I*=4294967296;return new o(_,0)}function f(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return N(f(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(_,8)),w=m,A=0;A<T.length;A+=8){var b=Math.min(8,T.length-A),v=parseInt(T.substring(A,A+b),_);8>b?(b=h(Math.pow(_,b)),w=w.j(b).add(h(v))):(w=w.j(I),w=w.add(h(v)))}return w}var m=u(0),g=u(1),E=u(16777216);n=o.prototype,n.m=function(){if(k(this))return-N(this).m();for(var T=0,_=1,I=0;I<this.g.length;I++){var w=this.i(I);T+=(0<=w?w:4294967296+w)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(R(this))return"0";if(k(this))return"-"+N(this).toString(T);for(var _=h(Math.pow(T,6)),I=this,w="";;){var A=oe(I,_).g;I=B(I,A.j(_));var b=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=A,R(I))return b+w;for(;6>b.length;)b="0"+b;w=b+w}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function R(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function k(T){return T.h==-1}n.l=function(T){return T=B(this,T),k(T)?-1:R(T)?0:1};function N(T){for(var _=T.g.length,I=[],w=0;w<_;w++)I[w]=~T.g[w];return new o(I,~T.h).add(g)}n.abs=function(){return k(this)?N(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],w=0,A=0;A<=_;A++){var b=w+(this.i(A)&65535)+(T.i(A)&65535),v=(b>>>16)+(this.i(A)>>>16)+(T.i(A)>>>16);w=v>>>16,b&=65535,v&=65535,I[A]=v<<16|b}return new o(I,I[I.length-1]&-2147483648?-1:0)};function B(T,_){return T.add(N(_))}n.j=function(T){if(R(this)||R(T))return m;if(k(this))return k(T)?N(this).j(N(T)):N(N(this).j(T));if(k(T))return N(this.j(N(T)));if(0>this.l(E)&&0>T.l(E))return h(this.m()*T.m());for(var _=this.g.length+T.g.length,I=[],w=0;w<2*_;w++)I[w]=0;for(w=0;w<this.g.length;w++)for(var A=0;A<T.g.length;A++){var b=this.i(w)>>>16,v=this.i(w)&65535,bt=T.i(A)>>>16,si=T.i(A)&65535;I[2*w+2*A]+=v*si,j(I,2*w+2*A),I[2*w+2*A+1]+=b*si,j(I,2*w+2*A+1),I[2*w+2*A+1]+=v*bt,j(I,2*w+2*A+1),I[2*w+2*A+2]+=b*bt,j(I,2*w+2*A+2)}for(w=0;w<_;w++)I[w]=I[2*w+1]<<16|I[2*w];for(w=_;w<2*_;w++)I[w]=0;return new o(I,0)};function j(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function z(T,_){this.g=T,this.h=_}function oe(T,_){if(R(_))throw Error("division by zero");if(R(T))return new z(m,m);if(k(T))return _=oe(N(T),_),new z(N(_.g),N(_.h));if(k(_))return _=oe(T,N(_)),new z(N(_.g),_.h);if(30<T.g.length){if(k(T)||k(_))throw Error("slowDivide_ only works with positive integers.");for(var I=g,w=_;0>=w.l(T);)I=Ve(I),w=Ve(w);var A=re(I,1),b=re(w,1);for(w=re(w,2),I=re(I,2);!R(w);){var v=b.add(w);0>=v.l(T)&&(A=A.add(I),b=v),w=re(w,1),I=re(I,1)}return _=B(T,A.j(_)),new z(A,_)}for(A=m;0<=T.l(_);){for(I=Math.max(1,Math.floor(T.m()/_.m())),w=Math.ceil(Math.log(I)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),b=h(I),v=b.j(_);k(v)||0<v.l(T);)I-=w,b=h(I),v=b.j(_);R(b)&&(b=g),A=A.add(b),T=B(T,v)}return new z(A,T)}n.A=function(T){return oe(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],w=0;w<_;w++)I[w]=this.i(w)&T.i(w);return new o(I,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],w=0;w<_;w++)I[w]=this.i(w)|T.i(w);return new o(I,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),I=[],w=0;w<_;w++)I[w]=this.i(w)^T.i(w);return new o(I,this.h^T.h)};function Ve(T){for(var _=T.g.length+1,I=[],w=0;w<_;w++)I[w]=T.i(w)<<1|T.i(w-1)>>>31;return new o(I,T.h)}function re(T,_){var I=_>>5;_%=32;for(var w=T.g.length-I,A=[],b=0;b<w;b++)A[b]=0<_?T.i(b+I)>>>_|T.i(b+I+1)<<32-_:T.i(b+I);return new o(A,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Zu=Dg.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,an=Dg.Integer=o}).apply(typeof kg<"u"?kg:typeof self<"u"?self:typeof window<"u"?window:{});var xo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bt={};var el,_S,Ir,tl,$i,Oo,nl,rl,il;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof xo=="object"&&xo];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,l){if(l)e:{var d=r;a=a.split(".");for(var p=0;p<a.length-1;p++){var S=a[p];if(!(S in d))break e;d=d[S]}a=a[a.length-1],p=d[a],l=l(p),l!=p&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,p=!1,S={next:function(){if(!p&&d<a.length){var C=d++;return{value:l(C,a[C]),done:!1}}return p=!0,{done:!0,value:void 0}}};return S[Symbol.iterator]=function(){return S},S}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function m(a,l,d){if(!a)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var S=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(S,p),a.apply(l,S)}}return function(){return a.apply(l,arguments)}}function g(a,l,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,g.apply(null,arguments)}function E(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function R(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(p,S,C){for(var O=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)O[ae-2]=arguments[ae];return l.prototype[S].apply(p,O)}}function k(a){let l=a.length;if(0<l){let d=Array(l);for(let p=0;p<l;p++)d[p]=a[p];return d}return[]}function N(a,l){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(u(p)){let S=a.length||0,C=p.length||0;a.length=S+C;for(let O=0;O<C;O++)a[S+O]=p[O]}else a.push(p)}}class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function j(a){return/^[\s\xa0]*$/.test(a)}function z(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function oe(a){return oe[" "](a),a}oe[" "]=function(){};var Ve=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function re(a,l,d){for(let p in a)l.call(d,a[p],p,a)}function T(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function _(a){let l={};for(let d in a)l[d]=a[d];return l}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(a,l){let d,p;for(let S=1;S<arguments.length;S++){p=arguments[S];for(d in p)a[d]=p[d];for(let C=0;C<I.length;C++)d=I[C],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function A(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function b(a){c.setTimeout(()=>{throw a},0)}function v(){var a=dc;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class bt{constructor(){this.h=this.g=null}add(l,d){let p=si.get();p.set(l,d),this.h?this.h.next=p:this.g=p,this.h=p}}var si=new B(()=>new LI,a=>a.reset());class LI{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let oi,ai=!1,dc=new bt,Wf=()=>{let a=c.Promise.resolve(void 0);oi=()=>{a.then(VI)}};var VI=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){b(d)}var l=si;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}ai=!1};function zt(){this.s=this.s,this.C=this.C}zt.prototype.s=!1,zt.prototype.ma=function(){this.s||(this.s=!0,this.N())},zt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var MI=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a}();function ci(a,l){if(Pe.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(Ve){e:{try{oe(l.nodeName);var S=!0;break e}catch{}S=!1}S||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:FI[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&ci.aa.h.call(this)}}R(ci,Pe);var FI={2:"touch",3:"pen",4:"mouse"};ci.prototype.h=function(){ci.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ui="closure_listenable_"+(1e6*Math.random()|0),UI=0;function BI(a,l,d,p,S){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!p,this.ha=S,this.key=++UI,this.da=this.fa=!1}function Fs(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Us(a){this.src=a,this.g={},this.h=0}Us.prototype.add=function(a,l,d,p,S){var C=a.toString();a=this.g[C],a||(a=this.g[C]=[],this.h++);var O=pc(a,l,p,S);return-1<O?(l=a[O],d||(l.fa=!1)):(l=new BI(l,this.src,C,!!p,S),l.fa=d,a.push(l)),l};function fc(a,l){var d=l.type;if(d in a.g){var p=a.g[d],S=Array.prototype.indexOf.call(p,l,void 0),C;(C=0<=S)&&Array.prototype.splice.call(p,S,1),C&&(Fs(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function pc(a,l,d,p){for(var S=0;S<a.length;++S){var C=a[S];if(!C.da&&C.listener==l&&C.capture==!!d&&C.ha==p)return S}return-1}var mc="closure_lm_"+(1e6*Math.random()|0),gc={};function jf(a,l,d,p,S){if(p&&p.once)return Gf(a,l,d,p,S);if(Array.isArray(l)){for(var C=0;C<l.length;C++)jf(a,l[C],d,p,S);return null}return d=Ic(d),a&&a[ui]?a.K(l,d,h(p)?!!p.capture:!!p,S):zf(a,l,d,!1,p,S)}function zf(a,l,d,p,S,C){if(!l)throw Error("Invalid event type");var O=h(S)?!!S.capture:!!S,ae=yc(a);if(ae||(a[mc]=ae=new Us(a)),d=ae.add(l,d,p,O,C),d.proxy)return d;if(p=qI(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)MI||(S=O),S===void 0&&(S=!1),a.addEventListener(l.toString(),p,S);else if(a.attachEvent)a.attachEvent(Hf(l.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function qI(){function a(d){return l.call(a.src,a.listener,d)}let l=$I;return a}function Gf(a,l,d,p,S){if(Array.isArray(l)){for(var C=0;C<l.length;C++)Gf(a,l[C],d,p,S);return null}return d=Ic(d),a&&a[ui]?a.L(l,d,h(p)?!!p.capture:!!p,S):zf(a,l,d,!0,p,S)}function Kf(a,l,d,p,S){if(Array.isArray(l))for(var C=0;C<l.length;C++)Kf(a,l[C],d,p,S);else p=h(p)?!!p.capture:!!p,d=Ic(d),a&&a[ui]?(a=a.i,l=String(l).toString(),l in a.g&&(C=a.g[l],d=pc(C,d,p,S),-1<d&&(Fs(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete a.g[l],a.h--)))):a&&(a=yc(a))&&(l=a.g[l.toString()],a=-1,l&&(a=pc(l,d,p,S)),(d=-1<a?l[a]:null)&&_c(d))}function _c(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[ui])fc(l.i,a);else{var d=a.type,p=a.proxy;l.removeEventListener?l.removeEventListener(d,p,a.capture):l.detachEvent?l.detachEvent(Hf(d),p):l.addListener&&l.removeListener&&l.removeListener(p),(d=yc(l))?(fc(d,a),d.h==0&&(d.src=null,l[mc]=null)):Fs(a)}}}function Hf(a){return a in gc?gc[a]:gc[a]="on"+a}function $I(a,l){if(a.da)a=!0;else{l=new ci(l,this);var d=a.listener,p=a.ha||a.src;a.fa&&_c(a),a=d.call(p,l)}return a}function yc(a){return a=a[mc],a instanceof Us?a:null}var vc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ic(a){return typeof a=="function"?a:(a[vc]||(a[vc]=function(l){return a.handleEvent(l)}),a[vc])}function Ne(){zt.call(this),this.i=new Us(this),this.M=this,this.F=null}R(Ne,zt),Ne.prototype[ui]=!0,Ne.prototype.removeEventListener=function(a,l,d,p){Kf(this,a,l,d,p)};function Me(a,l){var d,p=a.F;if(p)for(d=[];p;p=p.F)d.push(p);if(a=a.M,p=l.type||l,typeof l=="string")l=new Pe(l,a);else if(l instanceof Pe)l.target=l.target||a;else{var S=l;l=new Pe(p,a),w(l,S)}if(S=!0,d)for(var C=d.length-1;0<=C;C--){var O=l.g=d[C];S=Bs(O,p,!0,l)&&S}if(O=l.g=a,S=Bs(O,p,!0,l)&&S,S=Bs(O,p,!1,l)&&S,d)for(C=0;C<d.length;C++)O=l.g=d[C],S=Bs(O,p,!1,l)&&S}Ne.prototype.N=function(){if(Ne.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],p=0;p<d.length;p++)Fs(d[p]);delete a.g[l],a.h--}}this.F=null},Ne.prototype.K=function(a,l,d,p){return this.i.add(String(a),l,!1,d,p)},Ne.prototype.L=function(a,l,d,p){return this.i.add(String(a),l,!0,d,p)};function Bs(a,l,d,p){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var S=!0,C=0;C<l.length;++C){var O=l[C];if(O&&!O.da&&O.capture==d){var ae=O.listener,Ae=O.ha||O.src;O.fa&&fc(a.i,O),S=ae.call(Ae,p)!==!1&&S}}return S&&!p.defaultPrevented}function Qf(a,l,d){if(typeof a=="function")d&&(a=g(a,d));else if(a&&typeof a.handleEvent=="function")a=g(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function Yf(a){a.g=Qf(()=>{a.g=null,a.i&&(a.i=!1,Yf(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class WI extends zt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Yf(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function li(a){zt.call(this),this.h=a,this.g={}}R(li,zt);var Jf=[];function Xf(a){re(a.g,function(l,d){this.g.hasOwnProperty(d)&&_c(l)},a),a.g={}}li.prototype.N=function(){li.aa.N.call(this),Xf(this)},li.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wc=c.JSON.stringify,jI=c.JSON.parse,zI=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Ec(){}Ec.prototype.h=null;function Zf(a){return a.h||(a.h=a.i())}function ep(){}var hi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Tc(){Pe.call(this,"d")}R(Tc,Pe);function Ac(){Pe.call(this,"c")}R(Ac,Pe);var In={},tp=null;function qs(){return tp=tp||new Ne}In.La="serverreachability";function np(a){Pe.call(this,In.La,a)}R(np,Pe);function di(a){let l=qs();Me(l,new np(l))}In.STAT_EVENT="statevent";function rp(a,l){Pe.call(this,In.STAT_EVENT,a),this.stat=l}R(rp,Pe);function Fe(a){let l=qs();Me(l,new rp(l,a))}In.Ma="timingevent";function ip(a,l){Pe.call(this,In.Ma,a),this.size=l}R(ip,Pe);function fi(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function pi(){this.g=!0}pi.prototype.xa=function(){this.g=!1};function GI(a,l,d,p,S,C){a.info(function(){if(a.g)if(C)for(var O="",ae=C.split("&"),Ae=0;Ae<ae.length;Ae++){var X=ae[Ae].split("=");if(1<X.length){var ke=X[0];X=X[1];var De=ke.split("_");O=2<=De.length&&De[1]=="type"?O+(ke+"="+X+"&"):O+(ke+"=redacted&")}}else O=null;else O=C;return"XMLHTTP REQ ("+p+") [attempt "+S+"]: "+l+`
`+d+`
`+O})}function KI(a,l,d,p,S,C,O){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+S+"]: "+l+`
`+d+`
`+C+" "+O})}function ar(a,l,d,p){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+QI(a,d)+(p?" "+p:"")})}function HI(a,l){a.info(function(){return"TIMEOUT: "+l})}pi.prototype.info=function(){};function QI(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var p=d[a];if(!(2>p.length)){var S=p[1];if(Array.isArray(S)&&!(1>S.length)){var C=S[0];if(C!="noop"&&C!="stop"&&C!="close")for(var O=1;O<S.length;O++)S[O]=""}}}}return wc(d)}catch{return l}}var $s={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Sc;function Ws(){}R(Ws,Ec),Ws.prototype.g=function(){return new XMLHttpRequest},Ws.prototype.i=function(){return{}},Sc=new Ws;function Gt(a,l,d,p){this.j=a,this.i=l,this.l=d,this.R=p||1,this.U=new li(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new op}function op(){this.i=null,this.g="",this.h=!1}var ap={},bc={};function Cc(a,l,d){a.L=1,a.v=Ks(Ct(l)),a.m=d,a.P=!0,cp(a,null)}function cp(a,l){a.F=Date.now(),js(a),a.A=Ct(a.v);var d=a.A,p=a.R;Array.isArray(p)||(p=[String(p)]),Ep(d.i,"t",p),a.C=0,d=a.j.J,a.h=new op,a.g=Bp(a.j,d?l:null,!a.m),0<a.O&&(a.M=new WI(g(a.Y,a,a.g),a.O)),l=a.U,d=a.g,p=a.ca;var S="readystatechange";Array.isArray(S)||(S&&(Jf[0]=S.toString()),S=Jf);for(var C=0;C<S.length;C++){var O=jf(d,S[C],p||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),di(),GI(a.i,a.u,a.A,a.l,a.R,a.m)}Gt.prototype.ca=function(a){a=a.target;let l=this.M;l&&Rt(a)==3?l.j():this.Y(a)},Gt.prototype.Y=function(a){try{if(a==this.g)e:{let De=Rt(this.g);var l=this.g.Ba();let lr=this.g.Z();if(!(3>De)&&(De!=3||this.g&&(this.h.h||this.g.oa()||Pp(this.g)))){this.J||De!=4||l==7||(l==8||0>=lr?di(3):di(2)),Rc(this);var d=this.g.Z();this.X=d;t:if(up(this)){var p=Pp(this.g);a="";var S=p.length,C=Rt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wn(this),mi(this);var O="";break t}this.h.i=new c.TextDecoder}for(l=0;l<S;l++)this.h.h=!0,a+=this.h.i.decode(p[l],{stream:!(C&&l==S-1)});p.length=0,this.h.g+=a,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=d==200,KI(this.i,this.u,this.A,this.l,this.R,De,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ae,Ae=this.g;if((ae=Ae.g?Ae.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(ae)){var X=ae;break t}}X=null}if(d=X)ar(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Pc(this,d);else{this.o=!1,this.s=3,Fe(12),wn(this),mi(this);break e}}if(this.P){d=!0;let Ze;for(;!this.J&&this.C<O.length;)if(Ze=YI(this,O),Ze==bc){De==4&&(this.s=4,Fe(14),d=!1),ar(this.i,this.l,null,"[Incomplete Response]");break}else if(Ze==ap){this.s=4,Fe(15),ar(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}else ar(this.i,this.l,Ze,null),Pc(this,Ze);if(up(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),De!=4||O.length!=0||this.h.h||(this.s=1,Fe(16),d=!1),this.o=this.o&&d,!d)ar(this.i,this.l,O,"[Invalid Chunked Response]"),wn(this),mi(this);else if(0<O.length&&!this.W){this.W=!0;var ke=this.j;ke.g==this&&ke.ba&&!ke.M&&(ke.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Lc(ke),ke.M=!0,Fe(11))}}else ar(this.i,this.l,O,null),Pc(this,O);De==4&&wn(this),this.o&&!this.J&&(De==4?Vp(this.j,this):(this.o=!1,js(this)))}else fw(this.g),d==400&&0<O.indexOf("Unknown SID")?(this.s=3,Fe(12)):(this.s=0,Fe(13)),wn(this),mi(this)}}}catch{}finally{}};function up(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function YI(a,l){var d=a.C,p=l.indexOf(`
`,d);return p==-1?bc:(d=Number(l.substring(d,p)),isNaN(d)?ap:(p+=1,p+d>l.length?bc:(l=l.slice(p,p+d),a.C=p+d,l)))}Gt.prototype.cancel=function(){this.J=!0,wn(this)};function js(a){a.S=Date.now()+a.I,lp(a,a.I)}function lp(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=fi(g(a.ba,a),l)}function Rc(a){a.B&&(c.clearTimeout(a.B),a.B=null)}Gt.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(HI(this.i,this.A),this.L!=2&&(di(),Fe(17)),wn(this),this.s=2,mi(this)):lp(this,this.S-a)};function mi(a){a.j.G==0||a.J||Vp(a.j,a)}function wn(a){Rc(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,Xf(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function Pc(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||Nc(d.h,a))){if(!a.K&&Nc(d.h,a)&&d.G==3){try{var p=d.Da.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var S=p;if(S[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)Xs(d),Ys(d);else break e;Oc(d),Fe(18)}}else d.za=S[1],0<d.za-d.T&&37500>S[2]&&d.F&&d.v==0&&!d.C&&(d.C=fi(g(d.Za,d),6e3));if(1>=fp(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Tn(d,11)}else if((a.K||d.g==a)&&Xs(d),!j(l))for(S=d.Da.g.parse(l),l=0;l<S.length;l++){let X=S[l];if(d.T=X[0],X=X[1],d.G==2)if(X[0]=="c"){d.K=X[1],d.ia=X[2];let ke=X[3];ke!=null&&(d.la=ke,d.j.info("VER="+d.la));let De=X[4];De!=null&&(d.Aa=De,d.j.info("SVER="+d.Aa));let lr=X[5];lr!=null&&typeof lr=="number"&&0<lr&&(p=1.5*lr,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let Ze=a.g;if(Ze){let eo=Ze.g?Ze.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(eo){var C=p.h;C.g||eo.indexOf("spdy")==-1&&eo.indexOf("quic")==-1&&eo.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(kc(C,C.h),C.h=null))}if(p.D){let Vc=Ze.g?Ze.g.getResponseHeader("X-HTTP-Session-Id"):null;Vc&&(p.ya=Vc,ue(p.I,p.D,Vc))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var O=a;if(p.qa=Up(p,p.J?p.ia:null,p.W),O.K){pp(p.h,O);var ae=O,Ae=p.L;Ae&&(ae.I=Ae),ae.B&&(Rc(ae),js(ae)),p.g=O}else Op(p);0<d.i.length&&Js(d)}else X[0]!="stop"&&X[0]!="close"||Tn(d,7);else d.G==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?Tn(d,7):xc(d):X[0]!="noop"&&d.l&&d.l.ta(X),d.v=0)}}di(4)}catch{}}var JI=class{constructor(a,l){this.g=a,this.map=l}};function hp(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dp(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function fp(a){return a.h?1:a.g?a.g.size:0}function Nc(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function kc(a,l){a.g?a.g.add(l):a.h=l}function pp(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}hp.prototype.cancel=function(){if(this.i=mp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function mp(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return k(a.i)}function XI(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,p=0;p<d;p++)l.push(a[p]);return l}l=[],d=0;for(p in a)l[d++]=a[p];return l}function ZI(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let p in a)l[d++]=p;return l}}}function gp(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=ZI(a),p=XI(a),S=p.length,C=0;C<S;C++)l.call(void 0,p[C],d&&d[C],a)}var _p=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ew(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var p=a[d].indexOf("="),S=null;if(0<=p){var C=a[d].substring(0,p);S=a[d].substring(p+1)}else C=a[d];l(C,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function En(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof En){this.h=a.h,zs(this,a.j),this.o=a.o,this.g=a.g,Gs(this,a.s),this.l=a.l;var l=a.i,d=new yi;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),yp(this,d),this.m=a.m}else a&&(l=String(a).match(_p))?(this.h=!1,zs(this,l[1]||"",!0),this.o=gi(l[2]||""),this.g=gi(l[3]||"",!0),Gs(this,l[4]),this.l=gi(l[5]||"",!0),yp(this,l[6]||"",!0),this.m=gi(l[7]||"")):(this.h=!1,this.i=new yi(null,this.h))}En.prototype.toString=function(){var a=[],l=this.j;l&&a.push(_i(l,vp,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(_i(l,vp,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(_i(d,d.charAt(0)=="/"?rw:nw,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",_i(d,sw)),a.join("")};function Ct(a){return new En(a)}function zs(a,l,d){a.j=d?gi(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Gs(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function yp(a,l,d){l instanceof yi?(a.i=l,ow(a.i,a.h)):(d||(l=_i(l,iw)),a.i=new yi(l,a.h))}function ue(a,l,d){a.i.set(l,d)}function Ks(a){return ue(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function gi(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function _i(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,tw),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function tw(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var vp=/[#\/\?@]/g,nw=/[#\?:]/g,rw=/[#\?]/g,iw=/[#\?@]/g,sw=/#/g;function yi(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Kt(a){a.g||(a.g=new Map,a.h=0,a.i&&ew(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=yi.prototype,n.add=function(a,l){Kt(this),this.i=null,a=cr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Ip(a,l){Kt(a),l=cr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function wp(a,l){return Kt(a),l=cr(a,l),a.g.has(l)}n.forEach=function(a,l){Kt(this),this.g.forEach(function(d,p){d.forEach(function(S){a.call(l,S,p,this)},this)},this)},n.na=function(){Kt(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let p=0;p<l.length;p++){let S=a[p];for(let C=0;C<S.length;C++)d.push(l[p])}return d},n.V=function(a){Kt(this);let l=[];if(typeof a=="string")wp(this,a)&&(l=l.concat(this.g.get(cr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return Kt(this),this.i=null,a=cr(this,a),wp(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function Ep(a,l,d){Ip(a,l),0<d.length&&(a.i=null,a.g.set(cr(a,l),k(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var p=l[d];let C=encodeURIComponent(String(p)),O=this.V(p);for(p=0;p<O.length;p++){var S=C;O[p]!==""&&(S+="="+encodeURIComponent(String(O[p]))),a.push(S)}}return this.i=a.join("&")};function cr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function ow(a,l){l&&!a.j&&(Kt(a),a.i=null,a.g.forEach(function(d,p){var S=p.toLowerCase();p!=S&&(Ip(this,p),Ep(this,S,d))},a)),a.j=l}function aw(a,l){let d=new pi;if(c.Image){let p=new Image;p.onload=E(Ht,d,"TestLoadImage: loaded",!0,l,p),p.onerror=E(Ht,d,"TestLoadImage: error",!1,l,p),p.onabort=E(Ht,d,"TestLoadImage: abort",!1,l,p),p.ontimeout=E(Ht,d,"TestLoadImage: timeout",!1,l,p),c.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else l(!1)}function cw(a,l){let d=new pi,p=new AbortController,S=setTimeout(()=>{p.abort(),Ht(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:p.signal}).then(C=>{clearTimeout(S),C.ok?Ht(d,"TestPingServer: ok",!0,l):Ht(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(S),Ht(d,"TestPingServer: error",!1,l)})}function Ht(a,l,d,p,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),p(d)}catch{}}function uw(){this.g=new zI}function lw(a,l,d){let p=d||"";try{gp(a,function(S,C){let O=S;h(S)&&(O=wc(S)),l.push(p+C+"="+encodeURIComponent(O))})}catch(S){throw l.push(p+"type="+encodeURIComponent("_badmap")),S}}function vi(a){this.l=a.Ub||null,this.j=a.eb||!1}R(vi,Ec),vi.prototype.g=function(){return new Hs(this.l,this.j)},vi.prototype.i=function(a){return function(){return a}}({});function Hs(a,l){Ne.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}R(Hs,Ne),n=Hs.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,wi(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ii(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,wi(this)),this.g&&(this.readyState=3,wi(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Tp(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Tp(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?Ii(this):wi(this),this.readyState==3&&Tp(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,Ii(this))},n.Qa=function(a){this.g&&(this.response=a,Ii(this))},n.ga=function(){this.g&&Ii(this)};function Ii(a){a.readyState=4,a.l=null,a.j=null,a.v=null,wi(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function wi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Hs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Ap(a){let l="";return re(a,function(d,p){l+=p,l+=":",l+=d,l+=`\r
`}),l}function Dc(a,l,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=Ap(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):ue(a,l,d))}function fe(a){Ne.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}R(fe,Ne);var hw=/^https?$/i,dw=["POST","PUT"];n=fe.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Sc.g(),this.v=this.o?Zf(this.o):Zf(Sc),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(C){Sp(this,C);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var S in p)d.set(S,p[S]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let C of p.keys())d.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),S=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(dw,l,void 0))||p||S||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,O]of d)this.g.setRequestHeader(C,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Rp(this),this.u=!0,this.g.send(a),this.u=!1}catch(C){Sp(this,C)}};function Sp(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,bp(a),Qs(a)}function bp(a){a.A||(a.A=!0,Me(a,"complete"),Me(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Me(this,"complete"),Me(this,"abort"),Qs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qs(this,!0)),fe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Cp(this):this.bb())},n.bb=function(){Cp(this)};function Cp(a){if(a.h&&typeof o<"u"&&(!a.v[1]||Rt(a)!=4||a.Z()!=2)){if(a.u&&Rt(a)==4)Qf(a.Ea,0,a);else if(Me(a,"readystatechange"),Rt(a)==4){a.h=!1;try{let O=a.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var p;if(p=O===0){var S=String(a.D).match(_p)[1]||null;!S&&c.self&&c.self.location&&(S=c.self.location.protocol.slice(0,-1)),p=!hw.test(S?S.toLowerCase():"")}d=p}if(d)Me(a,"complete"),Me(a,"success");else{a.m=6;try{var C=2<Rt(a)?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.Z()+"]",bp(a)}}finally{Qs(a)}}}}function Qs(a,l){if(a.g){Rp(a);let d=a.g,p=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Me(a,"ready");try{d.onreadystatechange=p}catch{}}}function Rp(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function Rt(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<Rt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),jI(l)}};function Pp(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function fw(a){let l={};a=(a.g&&2<=Rt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(j(a[p]))continue;var d=A(a[p]);let S=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=l[S]||[];l[S]=C,C.push(d)}T(l,function(p){return p.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ei(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Np(a){this.Aa=0,this.i=[],this.j=new pi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ei("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ei("baseRetryDelayMs",5e3,a),this.cb=Ei("retryDelaySeedMs",1e4,a),this.Wa=Ei("forwardChannelMaxRetries",2,a),this.wa=Ei("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new hp(a&&a.concurrentRequestLimit),this.Da=new uw,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Np.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,p){Fe(0),this.W=a,this.H=l||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=Up(this,null,this.W),Js(this)};function xc(a){if(kp(a),a.G==3){var l=a.U++,d=Ct(a.I);if(ue(d,"SID",a.K),ue(d,"RID",l),ue(d,"TYPE","terminate"),Ti(a,d),l=new Gt(a,a.j,l),l.L=2,l.v=Ks(Ct(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=Bp(l.j,null),l.g.ea(l.v)),l.F=Date.now(),js(l)}Fp(a)}function Ys(a){a.g&&(Lc(a),a.g.cancel(),a.g=null)}function kp(a){Ys(a),a.u&&(c.clearTimeout(a.u),a.u=null),Xs(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Js(a){if(!dp(a.h)&&!a.s){a.s=!0;var l=a.Ga;oi||Wf(),ai||(oi(),ai=!0),dc.add(l,a),a.B=0}}function pw(a,l){return fp(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=fi(g(a.Ga,a,l),Mp(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let S=new Gt(this,this.j,a),C=this.o;if(this.S&&(C?(C=_(C),w(C,this.S)):C=this.S),this.m!==null||this.O||(S.H=C,C=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=xp(this,S,l),d=Ct(this.I),ue(d,"RID",a),ue(d,"CVER",22),this.D&&ue(d,"X-HTTP-Session-Id",this.D),Ti(this,d),C&&(this.O?l="headers="+encodeURIComponent(String(Ap(C)))+"&"+l:this.m&&Dc(d,this.m,C)),kc(this.h,S),this.Ua&&ue(d,"TYPE","init"),this.P?(ue(d,"$req",l),ue(d,"SID","null"),S.T=!0,Cc(S,d,null)):Cc(S,d,l),this.G=2}}else this.G==3&&(a?Dp(this,a):this.i.length==0||dp(this.h)||Dp(this))};function Dp(a,l){var d;l?d=l.l:d=a.U++;let p=Ct(a.I);ue(p,"SID",a.K),ue(p,"RID",d),ue(p,"AID",a.T),Ti(a,p),a.m&&a.o&&Dc(p,a.m,a.o),d=new Gt(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=xp(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),kc(a.h,d),Cc(d,p,l)}function Ti(a,l){a.H&&re(a.H,function(d,p){ue(l,p,d)}),a.l&&gp({},function(d,p){ue(l,p,d)})}function xp(a,l,d){d=Math.min(a.i.length,d);var p=a.l?g(a.l.Na,a.l,a):null;e:{var S=a.i;let C=-1;for(;;){let O=["count="+d];C==-1?0<d?(C=S[0].g,O.push("ofs="+C)):C=0:O.push("ofs="+C);let ae=!0;for(let Ae=0;Ae<d;Ae++){let X=S[Ae].g,ke=S[Ae].map;if(X-=C,0>X)C=Math.max(0,S[Ae].g-100),ae=!1;else try{lw(ke,O,"req"+X+"_")}catch{p&&p(ke)}}if(ae){p=O.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,p}function Op(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;oi||Wf(),ai||(oi(),ai=!0),dc.add(l,a),a.v=0}}function Oc(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=fi(g(a.Fa,a),Mp(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,Lp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=fi(g(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Fe(10),Ys(this),Lp(this))};function Lc(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function Lp(a){a.g=new Gt(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=Ct(a.qa);ue(l,"RID","rpc"),ue(l,"SID",a.K),ue(l,"AID",a.T),ue(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&ue(l,"TO",a.ja),ue(l,"TYPE","xmlhttp"),Ti(a,l),a.m&&a.o&&Dc(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=Ks(Ct(l)),d.m=null,d.P=!0,cp(d,a)}n.Za=function(){this.C!=null&&(this.C=null,Ys(this),Oc(this),Fe(19))};function Xs(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function Vp(a,l){var d=null;if(a.g==l){Xs(a),Lc(a),a.g=null;var p=2}else if(Nc(a.h,l))d=l.D,pp(a.h,l),p=1;else return;if(a.G!=0){if(l.o)if(p==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var S=a.B;p=qs(),Me(p,new ip(p,d)),Js(a)}else Op(a);else if(S=l.s,S==3||S==0&&0<l.X||!(p==1&&pw(a,l)||p==2&&Oc(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),S){case 1:Tn(a,5);break;case 4:Tn(a,10);break;case 3:Tn(a,6);break;default:Tn(a,2)}}}function Mp(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function Tn(a,l){if(a.j.info("Error code "+l),l==2){var d=g(a.fb,a),p=a.Xa;let S=!p;p=new En(p||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||zs(p,"https"),Ks(p),S?aw(p.toString(),d):cw(p.toString(),d)}else Fe(2);a.G=0,a.l&&a.l.sa(l),Fp(a),kp(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Fe(2)):(this.j.info("Failed to ping google.com"),Fe(1))};function Fp(a){if(a.G=0,a.ka=[],a.l){let l=mp(a.h);(l.length!=0||a.i.length!=0)&&(N(a.ka,l),N(a.ka,a.i),a.h.i.length=0,k(a.i),a.i.length=0),a.l.ra()}}function Up(a,l,d){var p=d instanceof En?Ct(d):new En(d);if(p.g!="")l&&(p.g=l+"."+p.g),Gs(p,p.s);else{var S=c.location;p=S.protocol,l=l?l+"."+S.hostname:S.hostname,S=+S.port;var C=new En(null);p&&zs(C,p),l&&(C.g=l),S&&Gs(C,S),d&&(C.l=d),p=C}return d=a.D,l=a.ya,d&&l&&ue(p,d,l),ue(p,"VER",a.la),Ti(a,p),p}function Bp(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new fe(new vi({eb:d})):new fe(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function qp(){}n=qp.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Zs(){}Zs.prototype.g=function(a,l){return new je(a,l)};function je(a,l){Ne.call(this),this.g=new Np(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!j(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!j(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new ur(this)}R(je,Ne),je.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},je.prototype.close=function(){xc(this.g)},je.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=wc(a),a=d);l.i.push(new JI(l.Ya++,a)),l.G==3&&Js(l)},je.prototype.N=function(){this.g.l=null,delete this.j,xc(this.g),delete this.g,je.aa.N.call(this)};function $p(a){Tc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}R($p,Tc);function Wp(){Ac.call(this),this.status=1}R(Wp,Ac);function ur(a){this.g=a}R(ur,qp),ur.prototype.ua=function(){Me(this.g,"a")},ur.prototype.ta=function(a){Me(this.g,new $p(a))},ur.prototype.sa=function(a){Me(this.g,new Wp)},ur.prototype.ra=function(){Me(this.g,"b")},Zs.prototype.createWebChannel=Zs.prototype.g,je.prototype.send=je.prototype.o,je.prototype.open=je.prototype.m,je.prototype.close=je.prototype.close,il=Bt.createWebChannelTransport=function(){return new Zs},rl=Bt.getStatEventTarget=function(){return qs()},nl=Bt.Event=In,Oo=Bt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},$s.NO_ERROR=0,$s.TIMEOUT=8,$s.HTTP_ERROR=6,$i=Bt.ErrorCode=$s,sp.COMPLETE="complete",tl=Bt.EventType=sp,ep.EventType=hi,hi.OPEN="a",hi.CLOSE="b",hi.ERROR="c",hi.MESSAGE="d",Ne.prototype.listen=Ne.prototype.K,Ir=Bt.WebChannel=ep,_S=Bt.FetchXmlHttpFactory=vi,fe.prototype.listenOnce=fe.prototype.L,fe.prototype.getLastError=fe.prototype.Ka,fe.prototype.getLastErrorCode=fe.prototype.Ba,fe.prototype.getStatus=fe.prototype.Z,fe.prototype.getResponseJson=fe.prototype.Oa,fe.prototype.getResponseText=fe.prototype.oa,fe.prototype.send=fe.prototype.ea,fe.prototype.setWithCredentials=fe.prototype.Ha,el=Bt.XhrIo=fe}).apply(typeof xo<"u"?xo:typeof self<"u"?self:typeof window<"u"?window:{});var xg="@firebase/firestore";var Te=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");var qr="10.14.0";var $n=new ct("@firebase/firestore");function Wi(){return $n.logLevel}function L(n,...e){if($n.logLevel<=G.DEBUG){let t=e.map(Uh);$n.debug(`Firestore (${qr}): ${n}`,...t)}}function qt(n,...e){if($n.logLevel<=G.ERROR){let t=e.map(Uh);$n.error(`Firestore (${qr}): ${n}`,...t)}}function Cr(n,...e){if($n.logLevel<=G.WARN){let t=e.map(Uh);$n.warn(`Firestore (${qr}): ${n}`,...t)}}function Uh(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${qr}) INTERNAL ASSERTION FAILED: `+n;throw qt(e),new Error(e)}function se(n,e){n||U()}function q(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends ze{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var mt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Uo=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},ul=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Te.UNAUTHENTICATED))}shutdown(){}},ll=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},hl=class{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){se(this.o===void 0);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new mt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new mt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>y(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new mt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(se(typeof r.accessToken=="string"),new Uo(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return se(e===null||typeof e=="string"),new Te(e)}},dl=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},fl=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new dl(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Te.FIRST_PARTY))}shutdown(){}invalidateToken(){}},pl=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ml=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){se(this.o===void 0);let r=s=>{s.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,L("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(se(typeof t.token=="string"),this.R=t.token,new pl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function yS(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Bo=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=yS(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function Z(n,e){return n<e?-1:n>e?1:0}function Rr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var be=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var $=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new be(0,0))}static max(){return new n(new be(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var qo=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(),r===void 0?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},pe=class n extends qo{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},vS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ke=class n extends qo{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return vS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new V(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(pe.fromString(e))}static fromName(e){return new n(pe.fromString(e).popFirst(5))}static empty(){return new n(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new pe(e.slice()))}};var gl=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};gl.UNKNOWN_ID=-1;function IS(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(r===1e9?new be(t+1,0):new be(t,r));return new Wn(i,M.empty(),e)}function wS(n){return new Wn(n.readTime,n.key,-1)}var Wn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n($.min(),M.empty(),-1)}static max(){return new n($.max(),M.empty(),-1)}};function ES(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:Z(n.largestBatchId,e.largestBatchId))}var TS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",_l=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function os(n){return y(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==TS)throw n;L("LocalStore","Unexpectedly lost primary lease")})}var x=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function AS(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function as(n){return n.name==="IndexedDbTransactionError"}var h_=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function va(n){return n==null}function Qi(n){return n===0&&1/n==-1/0}function SS(n){return typeof n=="number"&&Number.isInteger(n)&&!Qi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var bS=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ak=[...bS,"documentOverlays"],CS=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],RS=CS,PS=[...RS,"indexConfiguration","indexState","indexEntries"];var ck=[...PS,"globals"];function Og(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function d_(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var me=class n{constructor(e,t){this.comparator=e,this.root=t||gt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,gt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ar(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ar(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ar(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ar(this.root,e,this.comparator,!0)}},Ar=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},gt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1;gt.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,s){return this}insert(e,t,r){return new gt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Oe=class n{constructor(e){this.comparator=e,this.data=new me(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $o(this.data.getIterator())}getIteratorFrom(e){return new $o(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},$o=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Qe=class n{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new n([])}unionWith(e){let t=new Oe(Ke.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Rr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Wo=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Le=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Wo("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Le.EMPTY_BYTE_STRING=new Le("");var NS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $t(n){if(se(!!n),typeof n=="string"){let e=0,t=NS.exec(n);if(se(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:he(n.seconds),nanos:he(n.nanos)}}function he(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ln(n){return typeof n=="string"?Le.fromBase64String(n):Le.fromUint8Array(n)}function Bh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function qh(n){let e=n.mapValue.fields.__previous_value__;return Bh(e)?qh(e):e}function Yi(n){let e=$t(n.mapValue.fields.__local_write_time__.timestampValue);return new be(e.seconds,e.nanos)}var yl=class{constructor(e,t,r,i,s,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}},jo=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Lo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function jn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Bh(n)?4:p_(n)?9007199254740991:f_(n)?10:11:U()}function It(n,e){if(n===e)return!0;let t=jn(n);if(t!==jn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Yi(n).isEqual(Yi(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=$t(i.timestampValue),c=$t(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return ln(i.bytesValue).isEqual(ln(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return he(i.geoPointValue.latitude)===he(s.geoPointValue.latitude)&&he(i.geoPointValue.longitude)===he(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return he(i.integerValue)===he(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=he(i.doubleValue),c=he(s.doubleValue);return o===c?Qi(o)===Qi(c):isNaN(o)&&isNaN(c)}return!1}(n,e);case 9:return Rr(n.arrayValue.values||[],e.arrayValue.values||[],It);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(Og(o)!==Og(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!It(o[u],c[u])))return!1;return!0}(n,e);default:return U()}}function Ji(n,e){return(n.values||[]).find(t=>It(t,e))!==void 0}function Pr(n,e){if(n===e)return 0;let t=jn(n),r=jn(e);if(t!==r)return Z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Z(n.booleanValue,e.booleanValue);case 2:return function(s,o){let c=he(s.integerValue||s.doubleValue),u=he(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(n,e);case 3:return Lg(n.timestampValue,e.timestampValue);case 4:return Lg(Yi(n),Yi(e));case 5:return Z(n.stringValue,e.stringValue);case 6:return function(s,o){let c=ln(s),u=ln(o);return c.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=Z(c[h],u[h]);if(f!==0)return f}return Z(c.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let c=Z(he(s.latitude),he(o.latitude));return c!==0?c:Z(he(s.longitude),he(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Vg(n.arrayValue,e.arrayValue);case 10:return function(s,o){var c,u,h,f;let m=s.fields||{},g=o.fields||{},E=(c=m.value)===null||c===void 0?void 0:c.arrayValue,R=(u=g.value)===null||u===void 0?void 0:u.arrayValue,k=Z(((h=E?.values)===null||h===void 0?void 0:h.length)||0,((f=R?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:Vg(E,R)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===Lo.mapValue&&o===Lo.mapValue)return 0;if(s===Lo.mapValue)return 1;if(o===Lo.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){let g=Z(u[m],f[m]);if(g!==0)return g;let E=Pr(c[u[m]],h[f[m]]);if(E!==0)return E}return Z(u.length,f.length)}(n.mapValue,e.mapValue);default:throw U()}}function Lg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Z(n,e);let t=$t(n),r=$t(e),i=Z(t.seconds,r.seconds);return i!==0?i:Z(t.nanos,r.nanos)}function Vg(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Pr(t[i],r[i]);if(s)return s}return Z(t.length,r.length)}function Nr(n){return vl(n)}function vl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=$t(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ln(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return M.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=vl(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${vl(t.fields[o])}`;return i+"}"}(n.mapValue):U()}function Il(n){return!!n&&"integerValue"in n}function $h(n){return!!n&&"arrayValue"in n}function Mg(n){return!!n&&"nullValue"in n}function Fg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Mo(n){return!!n&&"mapValue"in n}function f_(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function zi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Hn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=zi(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zi(n.arrayValue.values[t]);return e}return Object.assign({},n)}function p_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Ge=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Mo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zi(t)}setAll(e){let t=Ke.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=zi(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Mo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return It(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Mo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Hn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(zi(this.value))}};function m_(n){let e=[];return Hn(n.fields,(t,r)=>{let i=new Ke([t]);if(Mo(r)){let s=m_(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Qe(e)}var rt=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,$.min(),$.min(),$.min(),Ge.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,$.min(),$.min(),Ge.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,$.min(),$.min(),Ge.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ge.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ge.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var kr=class{constructor(e,t){this.position=e,this.inclusive=t}};function Ug(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=M.comparator(M.fromName(o.referenceValue),t.key):r=Pr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Bg(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!It(n.position[t],e.position[t]))return!1;return!0}var Dr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function kS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var zo=class{},Ie=class n extends zo{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new El(e,t,r):t==="array-contains"?new Sl(e,r):t==="in"?new bl(e,r):t==="not-in"?new Cl(e,r):t==="array-contains-any"?new Rl(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Tl(e,r):new Al(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Pr(t,this.value)):t!==null&&jn(this.value)===jn(t)&&this.matchesComparison(Pr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},wt=class n extends zo{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return g_(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function g_(n){return n.op==="and"}function __(n){return DS(n)&&g_(n)}function DS(n){for(let e of n.filters)if(e instanceof wt)return!1;return!0}function wl(n){if(n instanceof Ie)return n.field.canonicalString()+n.op.toString()+Nr(n.value);if(__(n))return n.filters.map(e=>wl(e)).join(",");{let e=n.filters.map(t=>wl(t)).join(",");return`${n.op}(${e})`}}function y_(n,e){return n instanceof Ie?function(r,i){return i instanceof Ie&&r.op===i.op&&r.field.isEqual(i.field)&&It(r.value,i.value)}(n,e):n instanceof wt?function(r,i){return i instanceof wt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&y_(o,i.filters[c]),!0):!1}(n,e):void U()}function v_(n){return n instanceof Ie?function(t){return`${t.field.canonicalString()} ${t.op} ${Nr(t.value)}`}(n):n instanceof wt?function(t){return t.op.toString()+" {"+t.getFilters().map(v_).join(" ,")+"}"}(n):"Filter"}var El=class extends Ie{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},Tl=class extends Ie{constructor(e,t){super(e,"in",t),this.keys=I_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Al=class extends Ie{constructor(e,t){super(e,"not-in",t),this.keys=I_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function I_(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var Sl=class extends Ie{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return $h(t)&&Ji(t.arrayValue,this.value)}},bl=class extends Ie{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ji(this.value.arrayValue,t)}},Cl=class extends Ie{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ji(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ji(this.value.arrayValue,t)}},Rl=class extends Ie{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!$h(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ji(this.value.arrayValue,r))}};var Pl=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.ue=null}};function qg(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Pl(n,e,t,r,i,s,o)}function Wh(n){let e=q(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>wl(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),va(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Nr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Nr(r)).join(",")),e.ue=t}return e.ue}function jh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!kS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!y_(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Bg(n.startAt,e.startAt)&&Bg(n.endAt,e.endAt)}function Nl(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var xr=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function xS(n,e,t,r,i,s,o,c){return new xr(n,e,t,r,i,s,o,c)}function Ia(n){return new xr(n)}function $g(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function OS(n){return n.collectionGroup!==null}function Gi(n){let e=q(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new Oe(Ke.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Dr(s,r))}),t.has(Ke.keyField().canonicalString())||e.ce.push(new Dr(Ke.keyField(),r))}return e.ce}function _t(n){let e=q(n);return e.le||(e.le=LS(e,Gi(n))),e.le}function LS(n,e){if(n.limitType==="F")return qg(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Dr(i.field,s)});let t=n.endAt?new kr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new kr(n.startAt.position,n.startAt.inclusive):null;return qg(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function kl(n,e,t){return new xr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function wa(n,e){return jh(_t(n),_t(e))&&n.limitType===e.limitType}function w_(n){return`${Wh(_t(n))}|lt:${n.limitType}`}function wr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>v_(i)).join(", ")}]`),va(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Nr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Nr(i)).join(",")),`Target(${r})`}(_t(n))}; limitType=${n.limitType})`}function Ea(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Gi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,c,u){let h=Ug(o,c,u);return o.inclusive?h<=0:h<0}(r.startAt,Gi(r),i)||r.endAt&&!function(o,c,u){let h=Ug(o,c,u);return o.inclusive?h>=0:h>0}(r.endAt,Gi(r),i))}(n,e)}function VS(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function E_(n){return(e,t)=>{let r=!1;for(let i of Gi(n)){let s=MS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function MS(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Pr(u,h):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var hn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Hn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return d_(this.inner)}size(){return this.innerSize}};var FS=new me(M.comparator);function Wt(){return FS}var T_=new me(M.comparator);function ji(...n){let e=T_;for(let t of n)e=e.insert(t.key,t);return e}function A_(n){let e=T_;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Un(){return Ki()}function S_(){return Ki()}function Ki(){return new hn(n=>n.toString(),(n,e)=>n.isEqual(e))}var US=new me(M.comparator),BS=new Oe(M.comparator);function Y(...n){let e=BS;for(let t of n)e=e.add(t);return e}var qS=new Oe(Z);function $S(){return qS}function zh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qi(e)?"-0":e}}function b_(n){return{integerValue:""+n}}function WS(n,e){return SS(e)?b_(e):zh(n,e)}var Or=class{constructor(){this._=void 0}};function jS(n,e,t){return n instanceof Lr?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Bh(s)&&(s=qh(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof zn?R_(n,e):n instanceof Gn?P_(n,e):function(i,s){let o=C_(i,s),c=Wg(o)+Wg(i.Pe);return Il(o)&&Il(i.Pe)?b_(c):zh(i.serializer,c)}(n,e)}function zS(n,e,t){return n instanceof zn?R_(n,e):n instanceof Gn?P_(n,e):t}function C_(n,e){return n instanceof Vr?function(r){return Il(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Lr=class extends Or{},zn=class extends Or{constructor(e){super(),this.elements=e}};function R_(n,e){let t=N_(e);for(let r of n.elements)t.some(i=>It(i,r))||t.push(r);return{arrayValue:{values:t}}}var Gn=class extends Or{constructor(e){super(),this.elements=e}};function P_(n,e){let t=N_(e);for(let r of n.elements)t=t.filter(i=>!It(i,r));return{arrayValue:{values:t}}}var Vr=class extends Or{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Wg(n){return he(n.integerValue||n.doubleValue)}function N_(n){return $h(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function GS(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof zn&&i instanceof zn||r instanceof Gn&&i instanceof Gn?Rr(r.elements,i.elements,It):r instanceof Vr&&i instanceof Vr?It(r.Pe,i.Pe):r instanceof Lr&&i instanceof Lr}(n.transform,e.transform)}var Dl=class{constructor(e,t){this.version=e,this.transformResults=t}},cn=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Fo(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Mr=class{};function k_(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Go(n.key,cn.none()):new Kn(n.key,n.data,cn.none());{let t=n.data,r=Ge.empty(),i=new Oe(Ke.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Et(n.key,r,new Qe(i.toArray()),cn.none())}}function KS(n,e,t){n instanceof Kn?function(i,s,o){let c=i.value.clone(),u=zg(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):n instanceof Et?function(i,s,o){if(!Fo(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=zg(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(D_(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Hi(n,e,t,r){return n instanceof Kn?function(s,o,c,u){if(!Fo(s.precondition,o))return c;let h=s.value.clone(),f=Gg(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof Et?function(s,o,c,u){if(!Fo(s.precondition,o))return c;let h=Gg(s.fieldTransforms,u,o),f=o.data;return f.setAll(D_(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,o,c){return Fo(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(n,e,t)}function HS(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=C_(r.transform,i||null);s!=null&&(t===null&&(t=Ge.empty()),t.set(r.field,s))}return t||null}function jg(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Rr(r,i,(s,o)=>GS(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Kn=class extends Mr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Et=class extends Mr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function D_(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function zg(n,e,t){let r=new Map;se(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,zS(o,c,t[i]))}return r}function Gg(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,jS(s,o,e))}return r}var Go=class extends Mr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},xl=class extends Mr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ol=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&KS(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Hi(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Hi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=S_();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=k_(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&Rr(this.mutations,e.mutations,(t,r)=>jg(t,r))&&Rr(this.baseMutations,e.baseMutations,(t,r)=>jg(t,r))}},Ll=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){se(e.mutations.length===r.length);let i=function(){return US}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Vl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ml=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ye,J;function QS(n){switch(n){default:return U();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function x_(n){if(n===void 0)return qt("GRPC error has no .code"),P.UNKNOWN;switch(n){case ye.OK:return P.OK;case ye.CANCELLED:return P.CANCELLED;case ye.UNKNOWN:return P.UNKNOWN;case ye.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ye.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ye.INTERNAL:return P.INTERNAL;case ye.UNAVAILABLE:return P.UNAVAILABLE;case ye.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ye.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ye.NOT_FOUND:return P.NOT_FOUND;case ye.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ye.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ye.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ye.ABORTED:return P.ABORTED;case ye.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ye.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ye.DATA_LOSS:return P.DATA_LOSS;default:return U()}}(J=ye||(ye={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var Kg=null;function YS(){return new TextEncoder}var JS=new an([4294967295,4294967295],0);function Hg(n){let e=YS().encode(n),t=new Zu;return t.update(e),new Uint8Array(t.digest())}function Qg(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new an([t,r],0),new an([i,s],0)]}var Fl=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Bn(`Invalid padding: ${t}`);if(r<0)throw new Bn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Bn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Bn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=an.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(an.fromNumber(r)));return i.compare(JS)===1&&(i=new an([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Hg(e),[r,i]=Qg(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;let t=Hg(e),[r,i]=Qg(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Bn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ko=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Xi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n($.min(),i,new me(Z),Wt(),Y())}},Xi=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Y(),Y(),Y())}};var Sr=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Ho=class{constructor(e,t){this.targetId=e,this.me=t}},Qo=class{constructor(e,t,r=Le.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Yo=class{constructor(){this.fe=0,this.ge=Jg(),this.pe=Le.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Y(),t=Y(),r=Y();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Xi(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Jg()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,se(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ul=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Wt(),this.qe=Yg(),this.Qe=new me(Z)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Nl(s))if(r===0){let o=new M(s.path);this.Ue(t,o,rt.newNoDocument(o,$.min()))}else se(r===1);else{let o=this.Ye(t);if(o!==r){let c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}Kg?.et(function(f,m,g,E,R){var k,N,B,j,z,oe;let Ve={localCacheCount:f,existenceFilterCount:m.count,databaseId:g.database,projectId:g.projectId},re=m.unchangedNames;return re&&(Ve.bloomFilter={applied:R===0,hashCount:(k=re?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=(B=(N=re?.bits)===null||N===void 0?void 0:N.bitmap)===null||B===void 0?void 0:B.length)!==null&&j!==void 0?j:0,padding:(oe=(z=re?.bits)===null||z===void 0?void 0:z.padding)!==null&&oe!==void 0?oe:0,mightContain:T=>{var _;return(_=E?.mightContain(T))!==null&&_!==void 0&&_}}),Ve}(o,e.me,this.Le.tt(),c,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=ln(r).toUint8Array()}catch(u){if(u instanceof Wo)return Cr("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Fl(o,i,s)}catch(u){return Cr(u instanceof Bn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let c=this.Je(o);if(c){if(s.current&&Nl(c.target)){let u=new M(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,rt.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=Y();this.qe.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this.Je(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Ko(e,t,this.Qe,this.ke,r);return this.ke=Wt(),this.qe=Yg(),this.Qe=new me(Z),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Yo,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Oe(Z),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Yo),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Yg(){return new me(M.comparator)}function Jg(){return new me(M.comparator)}var XS={asc:"ASCENDING",desc:"DESCENDING"},ZS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eb={and:"AND",or:"OR"},Bl=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function ql(n,e){return n.useProto3Json||va(e)?e:{value:e}}function Jo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function O_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function tb(n,e){return Jo(n,e.toTimestamp())}function yt(n){return se(!!n),$.fromTimestamp(function(t){let r=$t(t);return new be(r.seconds,r.nanos)}(n))}function Gh(n,e){return $l(n,e).canonicalString()}function $l(n,e){let t=function(i){return new pe(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function L_(n){let e=pe.fromString(n);return se(B_(e)),e}function Wl(n,e){return Gh(n.databaseId,e.path)}function sl(n,e){let t=L_(e);if(t.get(1)!==n.databaseId.projectId)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(M_(t))}function V_(n,e){return Gh(n.databaseId,e)}function nb(n){let e=L_(n);return e.length===4?pe.emptyPath():M_(e)}function jl(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function M_(n){return se(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Xg(n,e,t){return{name:Wl(n,e),fields:t.value.mapValue.fields}}function rb(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(se(f===void 0||typeof f=="string"),Le.fromBase64String(f||"")):(se(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Le.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(h){let f=h.code===void 0?P.UNKNOWN:x_(h.code);return new V(f,h.message||"")}(o);t=new Qo(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=sl(n,r.document.name),s=yt(r.document.updateTime),o=r.document.createTime?yt(r.document.createTime):$.min(),c=new Ge({mapValue:{fields:r.document.fields}}),u=rt.newFoundDocument(i,s,o,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Sr(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=sl(n,r.document),s=r.readTime?yt(r.readTime):$.min(),o=rt.newNoDocument(i,s),c=r.removedTargetIds||[];t=new Sr([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=sl(n,r.document),s=r.removedTargetIds||[];t=new Sr([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Ml(i,s),c=r.targetId;t=new Ho(c,o)}}return t}function ib(n,e){let t;if(e instanceof Kn)t={update:Xg(n,e.key,e.value)};else if(e instanceof Go)t={delete:Wl(n,e.key)};else if(e instanceof Et)t={update:Xg(n,e.key,e.data),updateMask:fb(e.fieldMask)};else{if(!(e instanceof xl))return U();t={verify:Wl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let c=o.transform;if(c instanceof Lr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof zn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Gn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Vr)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:tb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(n,e.precondition)),t}function sb(n,e){return n&&n.length>0?(se(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?yt(i.updateTime):yt(s);return o.isEqual($.min())&&(o=yt(s)),new Dl(o,i.transformResults||[])}(t,e))):[]}function ob(n,e){return{documents:[V_(n,e.path)]}}function ab(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=V_(n,i);let s=function(h){if(h.length!==0)return U_(wt.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(h){if(h.length!==0)return h.map(f=>function(g){return{field:Er(g.field),direction:lb(g.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=ql(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i}}function cb(n){let e=nb(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){se(r===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){let g=F_(m);return g instanceof wt&&__(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(g=>function(R){return new Dr(Tr(R.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(g))}(t.orderBy));let c=null;t.limit&&(c=function(m){let g;return g=typeof m=="object"?m.value:m,va(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(m){let g=!!m.before,E=m.values||[];return new kr(E,g)}(t.startAt));let h=null;return t.endAt&&(h=function(m){let g=!m.before,E=m.values||[];return new kr(E,g)}(t.endAt)),xS(e,i,o,s,c,"F",u,h)}function ub(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function F_(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Tr(t.unaryFilter.field);return Ie.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Tr(t.unaryFilter.field);return Ie.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Tr(t.unaryFilter.field);return Ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Tr(t.unaryFilter.field);return Ie.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(t){return Ie.create(Tr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return wt.create(t.compositeFilter.filters.map(r=>F_(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U()}function lb(n){return XS[n]}function hb(n){return ZS[n]}function db(n){return eb[n]}function Er(n){return{fieldPath:n.canonicalString()}}function Tr(n){return Ke.fromServerFormat(n.fieldPath)}function U_(n){return n instanceof Ie?function(t){if(t.op==="=="){if(Fg(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NAN"}};if(Mg(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fg(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NOT_NAN"}};if(Mg(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Er(t.field),op:hb(t.op),value:t.value}}}(n):n instanceof wt?function(t){let r=t.getFilters().map(i=>U_(i));return r.length===1?r[0]:{compositeFilter:{op:db(t.op),filters:r}}}(n):U()}function fb(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function B_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Zi=class n{constructor(e,t,r,i,s=$.min(),o=$.min(),c=Le.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var zl=class{constructor(e){this.ct=e}};function pb(n){let e=cb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kl(e,e.limit,"L"):e}var Xo=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(he(e.integerValue));else if("doubleValue"in e){let r=he(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Qi(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=$t(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ln(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?p_(e)?this.dt(t,Number.MAX_SAFE_INTEGER):f_(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",c=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(he(c)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),M.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Xo.vt=new Xo;var Gl=class{constructor(){this.un=new Kl}addToCollectionParentIndex(e,t){return this.un.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}deleteAllFieldIndexes(e){return x.resolve()}createTargetIndexes(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(Wn.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(Wn.min())}updateCollectionGroup(e,t,r){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}},Kl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Oe(pe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Oe(pe.comparator)).toArray()}};var lk=new Uint8Array(0);var pt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};pt.DEFAULT_COLLECTION_PERCENTILE=10,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pt.DEFAULT=new pt(41943040,pt.DEFAULT_COLLECTION_PERCENTILE,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pt.DISABLED=new pt(-1,0,0);var es=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Hl=class{constructor(){this.changes=new hn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?x.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ql=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Yl=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Hi(r.mutation,i,Qe.empty(),be.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Y()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Y()){let i=Un();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ji();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Un();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Y()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=Wt(),o=Ki(),c=function(){return Ki()}();return t.forEach((u,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Et)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Hi(f.mutation,h,f.mutation.getFieldMask(),be.now())):o.set(h.key,Qe.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var m;return c.set(h,new Ql(f,(m=o.get(h))!==null&&m!==void 0?m:null))}),c))}recalculateAndSaveOverlays(e,t){let r=Ki(),i=new me((o,c)=>o-c),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=r.get(u)||Qe.empty();f=c.applyToLocalView(h,f),r.set(u,f);let m=(i.get(c.batchId)||Y()).add(u);i=i.insert(c.batchId,m)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,m=S_();f.forEach(g=>{if(!s.has(g)){let E=k_(t.get(g),r.get(g));E!==null&&m.set(g,E),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return x.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return M.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):OS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):x.resolve(Un()),c=-1,u=s;return o.next(h=>x.forEach(h,(f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(f)?x.resolve():this.remoteDocumentCache.getEntry(e,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,Y())).next(f=>({batchId:c,changes:A_(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=ji();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=ji();return this.indexManager.getCollectionParents(e,s).next(c=>x.forEach(c,u=>{let h=function(m,g){return new xr(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(f=>{f.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,rt.newInvalidDocument(f)))});let c=ji();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&Hi(f.mutation,h,Qe.empty(),be.now()),Ea(t,h)&&(c=c.insert(u,h))}),c})}};var Jl=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return x.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:yt(i.createTime)}}(t)),x.resolve()}getNamedQuery(e,t){return x.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:pb(i.bundledQuery),readTime:yt(i.readTime)}}(t)),x.resolve()}};var Xl=class{constructor(){this.overlays=new me(M.comparator),this.Ir=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Un();return x.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),x.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),x.resolve()}getOverlaysForCollection(e,t,r){let i=Un(),s=t.length+1,o=new M(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return x.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new me((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=Un(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=Un(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return x.resolve(c)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Vl(t,r));let s=this.Ir.get(t);s===void 0&&(s=Y(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Zl=class{constructor(){this.sessionToken=Le.EMPTY_BYTE_STRING}getSessionToken(e){return x.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,x.resolve()}};var ts=class{constructor(){this.Tr=new Oe(ve.Er),this.dr=new Oe(ve.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new ve(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new ve(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new M(new pe([])),r=new ve(t,e),i=new ve(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new M(new pe([])),r=new ve(t,e),i=new ve(t,e+1),s=Y();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ve(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ve=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return M.comparator(e.key,t.key)||Z(e.wr,t.wr)}static Ar(e,t){return Z(e.wr,t.wr)||M.comparator(e.key,t.key)}};var eh=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Oe(ve.Er)}checkEmpty(e){return x.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ol(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.br=this.br.add(new ve(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return x.resolve(o)}lookupMutationBatch(e,t){return x.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return x.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ve(t,0),i=new ve(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let c=this.Dr(o.wr);s.push(c)}),x.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Oe(Z);return t.forEach(i=>{let s=new ve(i,0),o=new ve(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],c=>{r=r.add(c.wr)})}),x.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new ve(new M(s),0),c=new Oe(Z);return this.br.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.wr)),!0)},o),x.resolve(this.Cr(c))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){se(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return x.forEach(t.mutations,i=>{let s=new ve(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new ve(t,0),i=this.br.firstAfterOrEqual(r);return x.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,x.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var th=class{constructor(e){this.Mr=e,this.docs=function(){return new me(M.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return x.resolve(r?r.document.mutableCopy():rt.newInvalidDocument(t))}getEntries(e,t){let r=Wt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():rt.newInvalidDocument(i))}),x.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Wt(),o=t.path,c=new M(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||ES(wS(f),r)<=0||(i.has(f.key)||Ea(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return x.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U()}Or(e,t){return x.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new nh(this)}getSize(e){return x.resolve(this.size)}},nh=class extends Hl{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),x.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var rh=class{constructor(e){this.persistence=e,this.Nr=new hn(t=>Wh(t),jh),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ts,this.targetCount=0,this.kr=es.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),x.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new es(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Kn(t),x.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),x.waitFor(s).next(()=>i)}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return x.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),x.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),x.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),x.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return x.resolve(r)}containsKey(e,t){return x.resolve(this.Br.containsKey(t))}};var ih=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new h_(0),this.Kr=!1,this.Kr=!0,this.$r=new Zl,this.referenceDelegate=e(this),this.Ur=new rh(this),this.indexManager=new Gl,this.remoteDocumentCache=function(i){return new th(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new zl(t),this.Gr=new Jl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Xl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new eh(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);let i=new sh(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return x.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},sh=class extends _l{constructor(e){super(),this.currentSequenceNumber=e}},oh=class n{constructor(e){this.persistence=e,this.Jr=new ts,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),x.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),x.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.Xr,r=>{let i=M.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return x.or([()=>x.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var ah=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var ch=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var uh=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return cm()?8:AS(Ee())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new ch;return this.Xi(e,t,o).next(c=>{if(s.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Wi()<=G.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",wr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),x.resolve()):(Wi()<=G.DEBUG&&L("QueryEngine","Query:",wr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Wi()<=G.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",wr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_t(t))):x.resolve())}Yi(e,t){if($g(t))return x.resolve(null);let r=_t(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=kl(t,null,"F"),r=_t(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Y(...s);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.ts(t,c);return this.ns(t,h,o,u.readTime)?this.Yi(e,kl(t,null,"F")):this.rs(e,h,t,u)}))})))}Zi(e,t,r,i){return $g(t)||i.isEqual($.min())?x.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?x.resolve(null):(Wi()<=G.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),wr(t)),this.rs(e,o,t,IS(i,-1)).next(c=>c))})}ts(e,t){let r=new Oe(E_(e));return t.forEach((i,s)=>{Ea(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Wi()<=G.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",wr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Wn.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var lh=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new me(Z),this._s=new hn(s=>Wh(s),jh),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function mb(n,e,t,r){return new lh(n,e,t,r)}function q_(n,e){return y(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=Y();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})})}function gb(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,h,f){let m=h.batch,g=m.keys(),E=x.resolve();return g.forEach(R=>{E=E.next(()=>f.getEntry(u,R)).next(k=>{let N=h.docVersions.get(R);se(N!==null),k.version.compareTo(N)<0&&(m.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),E.next(()=>c.mutationQueue.removeMutationBatch(u,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=Y();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function $_(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function _b(n,e){let t=q(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let c=[];e.targetChanges.forEach((f,m)=>{let g=i.get(m);if(!g)return;c.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,m)));let E=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?E=E.withResumeToken(Le.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(E=E.withResumeToken(f.resumeToken,r)),i=i.insert(m,E),function(k,N,B){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(g,E,f)&&c.push(t.Ur.updateTargetData(s,E))});let u=Wt(),h=Y();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(yb(s,o,e.documentUpdates).next(f=>{u=f.Ps,h=f.Is})),!r.isEqual($.min())){let f=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return x.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.os=i,s))}function yb(n,e,t){let r=Y(),i=Y();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Wt();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual($.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):L("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function vb(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ib(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,x.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new Zi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function hh(n,e,t){return y(this,null,function*(){let r=q(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!as(o))throw o;L("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function Zg(n,e,t){let r=q(n),i=$.min(),s=Y();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,f){let m=q(u),g=m._s.get(f);return g!==void 0?x.resolve(m.os.get(g)):m.Ur.getTargetData(h,f)}(r,o,_t(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:$.min(),t?s:Y())).next(c=>(wb(r,VS(e),c),{documents:c,Ts:s})))}function wb(n,e,t){let r=n.us.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}var Zo=class{constructor(){this.activeTargetIds=$S()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var dh=class{constructor(){this.so=new Zo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Zo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var fh=class{_o(e){}shutdown(){}};var ea=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){L("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){L("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Vo=null;function ol(){return Vo===null?Vo=function(){return 268435456+Math.round(2147483648*Math.random())}():Vo++,"0x"+Vo.toString(16)}var Eb={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var ph=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var xe="WebChannelConnection",mh=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let c=ol(),u=this.xo(t,r.toUriEncodedString());L("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(t,u,h,i).then(f=>(L("RestConnection",`Received RPC '${t}' ${c}: `,f),f),f=>{throw Cr("RestConnection",`RPC '${t}' ${c} failed with error: `,f,"url: ",u,"request:",i),f})}Lo(t,r,i,s,o,c){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+qr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=Eb[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=ol();return new Promise((o,c)=>{let u=new el;u.setWithCredentials(!0),u.listenOnce(tl.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case $i.NO_ERROR:let f=u.getResponseJson();L(xe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case $i.TIMEOUT:L(xe,`RPC '${e}' ${s} timed out`),c(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case $i.HTTP_ERROR:let m=u.getStatus();if(L(xe,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);let E=g?.error;if(E&&E.status&&E.message){let R=function(N){let B=N.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(B)>=0?B:P.UNKNOWN}(E.status);c(new V(R,E.message))}else c(new V(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new V(P.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{L(xe,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);L(xe,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,r,15)})}Bo(e,t,r){let i=ol(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=il(),c=rl(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");L(xe,`Creating RPC '${e}' stream ${i}: ${f}`,u);let m=o.createWebChannel(f,u),g=!1,E=!1,R=new ph({Io:N=>{E?L(xe,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(g||(L(xe,`Opening RPC '${e}' stream ${i} transport.`),m.open(),g=!0),L(xe,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},To:()=>m.close()}),k=(N,B,j)=>{N.listen(B,z=>{try{j(z)}catch(oe){setTimeout(()=>{throw oe},0)}})};return k(m,Ir.EventType.OPEN,()=>{E||(L(xe,`RPC '${e}' stream ${i} transport opened.`),R.yo())}),k(m,Ir.EventType.CLOSE,()=>{E||(E=!0,L(xe,`RPC '${e}' stream ${i} transport closed`),R.So())}),k(m,Ir.EventType.ERROR,N=>{E||(E=!0,Cr(xe,`RPC '${e}' stream ${i} transport errored:`,N),R.So(new V(P.UNAVAILABLE,"The operation could not be completed")))}),k(m,Ir.EventType.MESSAGE,N=>{var B;if(!E){let j=N.data[0];se(!!j);let z=j,oe=z.error||((B=z[0])===null||B===void 0?void 0:B.error);if(oe){L(xe,`RPC '${e}' stream ${i} received error:`,oe);let Ve=oe.status,re=function(I){let w=ye[I];if(w!==void 0)return x_(w)}(Ve),T=oe.message;re===void 0&&(re=P.INTERNAL,T="Unknown error status: "+Ve+" with message "+oe.message),E=!0,R.So(new V(re,T)),m.close()}else L(xe,`RPC '${e}' stream ${i} received:`,j),R.bo(j)}}),k(c,nl.STAT_EVENT,N=>{N.stat===Oo.PROXY?L(xe,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===Oo.NOPROXY&&L(xe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{R.wo()},0),R}};function al(){return typeof document<"u"?document:null}function Ta(n){return new Bl(n,!0)}var ta=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&L("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var na=class{constructor(e,t,r,i,s,o,c,u){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ta(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return y(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return y(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return y(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(qt(t.toString()),qt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new V(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>y(this,null,function*(){this.state=0,this.start()}))}I_(e){return L("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(L("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},gh=class extends na{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=rb(this.serializer,e),r=function(s){if(!("targetChange"in s))return $.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?$.min():o.readTime?yt(o.readTime):$.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=jl(this.serializer),t.addTarget=function(s,o){let c,u=o.target;if(c=Nl(u)?{documents:ob(s,u)}:{query:ab(s,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=O_(s,o.resumeToken);let h=ql(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo($.min())>0){c.readTime=Jo(s,o.snapshotVersion.toTimestamp());let h=ql(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c}(this.serializer,e);let r=ub(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=jl(this.serializer),t.removeTarget=e,this.a_(t)}},_h=class extends na{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return se(!!e.streamToken),this.lastStreamToken=e.streamToken,se(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){se(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=sb(e.writeResults,e.commitTime),r=yt(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=jl(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>ib(this.serializer,r))};this.a_(t)}};var yh=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,$l(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(P.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,$l(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(P.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},vh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(qt(t),this.D_=!1):L("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Ih=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>y(this,null,function*(){Qn(this)&&(L("RemoteStore","Restarting streams for network reachability change."),yield function(u){return y(this,null,function*(){let h=q(u);h.L_.add(4),yield cs(h),h.q_.set("Unknown"),h.L_.delete(4),yield Aa(h)})}(this))}))}),this.q_=new vh(r,i)}};function Aa(n){return y(this,null,function*(){if(Qn(n))for(let e of n.B_)yield e(!0)})}function cs(n){return y(this,null,function*(){for(let e of n.B_)yield e(!1)})}function W_(n,e){let t=q(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Yh(t)?Qh(t):$r(t).r_()&&Hh(t,e))}function Kh(n,e){let t=q(n),r=$r(t);t.N_.delete(e),r.r_()&&j_(t,e),t.N_.size===0&&(r.r_()?r.o_():Qn(t)&&t.q_.set("Unknown"))}function Hh(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}$r(n).A_(e)}function j_(n,e){n.Q_.xe(e),$r(n).R_(e)}function Qh(n){n.Q_=new Ul({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),$r(n).start(),n.q_.v_()}function Yh(n){return Qn(n)&&!$r(n).n_()&&n.N_.size>0}function Qn(n){return q(n).L_.size===0}function z_(n){n.Q_=void 0}function Tb(n){return y(this,null,function*(){n.q_.set("Online")})}function Ab(n){return y(this,null,function*(){n.N_.forEach((e,t)=>{Hh(n,e)})})}function Sb(n,e){return y(this,null,function*(){z_(n),Yh(n)?(n.q_.M_(e),Qh(n)):n.q_.set("Unknown")})}function bb(n,e,t){return y(this,null,function*(){if(n.q_.set("Online"),e instanceof Qo&&e.state===2&&e.cause)try{yield function(i,s){return y(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.N_.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.N_.delete(c),i.Q_.removeTarget(c))})}(n,e)}catch(r){L("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ra(n,r)}else if(e instanceof Sr?n.Q_.Ke(e):e instanceof Ho?n.Q_.He(e):n.Q_.We(e),!t.isEqual($.min()))try{let r=yield $_(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let c=s.Q_.rt(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s.N_.get(u);if(!f)return;s.N_.set(u,f.withResumeToken(Le.EMPTY_BYTE_STRING,f.snapshotVersion)),j_(s,u);let m=new Zi(f.target,u,h,f.sequenceNumber);Hh(s,m)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){L("RemoteStore","Failed to raise snapshot:",r),yield ra(n,r)}})}function ra(n,e,t){return y(this,null,function*(){if(!as(e))throw e;n.L_.add(1),yield cs(n),n.q_.set("Offline"),t||(t=()=>$_(n.localStore)),n.asyncQueue.enqueueRetryable(()=>y(this,null,function*(){L("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield Aa(n)}))})}function G_(n,e){return e().catch(t=>ra(n,t,e))}function Sa(n){return y(this,null,function*(){let e=q(n),t=dn(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Cb(e);)try{let i=yield vb(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,Rb(e,i)}catch(i){yield ra(e,i)}K_(e)&&H_(e)})}function Cb(n){return Qn(n)&&n.O_.length<10}function Rb(n,e){n.O_.push(e);let t=dn(n);t.r_()&&t.V_&&t.m_(e.mutations)}function K_(n){return Qn(n)&&!dn(n).n_()&&n.O_.length>0}function H_(n){dn(n).start()}function Pb(n){return y(this,null,function*(){dn(n).p_()})}function Nb(n){return y(this,null,function*(){let e=dn(n);for(let t of n.O_)e.m_(t.mutations)})}function kb(n,e,t){return y(this,null,function*(){let r=n.O_.shift(),i=Ll.from(r,e,t);yield G_(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Sa(n)})}function Db(n,e){return y(this,null,function*(){e&&dn(n).V_&&(yield function(r,i){return y(this,null,function*(){if(function(o){return QS(o)&&o!==P.ABORTED}(i.code)){let s=r.O_.shift();dn(r).s_(),yield G_(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Sa(r)}})}(n,e)),K_(n)&&H_(n)})}function e_(n,e){return y(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),L("RemoteStore","RemoteStore received new credentials");let r=Qn(t);t.L_.add(3),yield cs(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Aa(t)})}function xb(n,e){return y(this,null,function*(){let t=q(n);e?(t.L_.delete(2),yield Aa(t)):e||(t.L_.add(2),yield cs(t),t.q_.set("Unknown"))})}function $r(n){return n.K_||(n.K_=function(t,r,i){let s=q(t);return s.w_(),new gh(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:Tb.bind(null,n),Ro:Ab.bind(null,n),mo:Sb.bind(null,n),d_:bb.bind(null,n)}),n.B_.push(e=>y(this,null,function*(){e?(n.K_.s_(),Yh(n)?Qh(n):n.q_.set("Unknown")):(yield n.K_.stop(),z_(n))}))),n.K_}function dn(n){return n.U_||(n.U_=function(t,r,i){let s=q(t);return s.w_(),new _h(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Pb.bind(null,n),mo:Db.bind(null,n),f_:Nb.bind(null,n),g_:kb.bind(null,n)}),n.B_.push(e=>y(this,null,function*(){e?(n.U_.s_(),yield Sa(n)):(yield n.U_.stop(),n.O_.length>0&&(L("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var wh=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new mt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Jh(n,e){if(qt("AsyncQueue",`${e}: ${n}`),as(n))return new V(P.UNAVAILABLE,`${e}: ${n}`);throw n}var ia=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=ji(),this.sortedSet=new me(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var sa=class{constructor(){this.W_=new me(M.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},Fr=class n{constructor(e,t,r,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,ia.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Eh=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Th=class{constructor(){this.queries=t_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=q(t),s=i.queries;i.queries=t_(),s.forEach((o,c)=>{for(let u of c.j_)u.onError(r)})})(this,new V(P.ABORTED,"Firestore shutting down"))}};function t_(){return new hn(n=>w_(n),wa)}function Q_(n,e){return y(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Eh,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Jh(o,`Initialization of query '${wr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Xh(t)})}function Y_(n,e){return y(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Ob(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.j_)c.X_(i)&&(r=!0);o.z_=i}}r&&Xh(t)}function Lb(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function Xh(n){n.Y_.forEach(e=>{e.next()})}var Ah,n_;(n_=Ah||(Ah={})).ea="default",n_.Cache="cache";var oa=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Fr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Fr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Ah.Cache}};var aa=class{constructor(e){this.key=e}},ca=class{constructor(e){this.key=e}},Sh=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Y(),this.mutatedKeys=Y(),this.Aa=E_(e),this.Ra=new ia(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new sa,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let g=i.get(f),E=Ea(this.query,m)?m:null,R=!!g&&this.mutatedKeys.has(g.key),k=!!E&&(E.hasLocalMutations||this.mutatedKeys.has(E.key)&&E.hasCommittedMutations),N=!1;g&&E?g.data.isEqual(E.data)?R!==k&&(r.track({type:3,doc:E}),N=!0):this.ga(g,E)||(r.track({type:2,doc:E}),N=!0,(u&&this.Aa(E,u)>0||h&&this.Aa(E,h)<0)&&(c=!0)):!g&&E?(r.track({type:0,doc:E}),N=!0):g&&!E&&(r.track({type:1,doc:g}),N=!0,(u||h)&&(c=!0)),N&&(E?(o=o.add(E),s=k?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:c,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((f,m)=>function(E,R){let k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return k(E)-k(R)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),i=i!=null&&i;let c=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,h=u!==this.Ea;return this.Ea=u,o.length!==0||h?{snapshot:new Fr(this.query,e.Ra,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new sa,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=Y(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new ca(r))}),this.da.forEach(r=>{e.has(r)||t.push(new aa(r))}),t}ba(e){this.Ta=e.Ts,this.da=Y();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Fr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},bh=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Ch=class{constructor(e){this.key=e,this.va=!1}},Rh=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new hn(c=>w_(c),wa),this.Ma=new Map,this.xa=new Set,this.Oa=new me(M.comparator),this.Na=new Map,this.La=new ts,this.Ba={},this.ka=new Map,this.qa=es.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function Vb(n,e,t=!0){return y(this,null,function*(){let r=ny(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield J_(r,e,t,!0),i})}function Mb(n,e){return y(this,null,function*(){let t=ny(n);yield J_(t,e,!0,!1)})}function J_(n,e,t,r){return y(this,null,function*(){let i=yield Ib(n.localStore,_t(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield Fb(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&W_(n.remoteStore,i),c})}function Fb(n,e,t,r,i){return y(this,null,function*(){n.Ka=(m,g,E)=>function(k,N,B,j){return y(this,null,function*(){let z=N.view.ma(B);z.ns&&(z=yield Zg(k.localStore,N.query,!1).then(({documents:T})=>N.view.ma(T,z)));let oe=j&&j.targetChanges.get(N.targetId),Ve=j&&j.targetMismatches.get(N.targetId)!=null,re=N.view.applyChanges(z,k.isPrimaryClient,oe,Ve);return i_(k,N.targetId,re.wa),re.snapshot})}(n,m,g,E);let s=yield Zg(n.localStore,e,!0),o=new Sh(e,s.Ts),c=o.ma(s.documents),u=Xi.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(c,n.isPrimaryClient,u);i_(n,t,h.wa);let f=new bh(e,t,o);return n.Fa.set(e,f),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),h.snapshot})}function Ub(n,e,t){return y(this,null,function*(){let r=q(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!wa(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield hh(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Kh(r.remoteStore,i.targetId),Ph(r,i.targetId)}).catch(os))):(Ph(r,i.targetId),yield hh(r.localStore,i.targetId,!0))})}function Bb(n,e){return y(this,null,function*(){let t=q(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Kh(t.remoteStore,r.targetId))})}function qb(n,e,t){return y(this,null,function*(){let r=Hb(n);try{let i=yield function(o,c){let u=q(o),h=be.now(),f=c.reduce((E,R)=>E.add(R.key),Y()),m,g;return u.persistence.runTransaction("Locally write mutations","readwrite",E=>{let R=Wt(),k=Y();return u.cs.getEntries(E,f).next(N=>{R=N,R.forEach((B,j)=>{j.isValidDocument()||(k=k.add(B))})}).next(()=>u.localDocuments.getOverlayedDocuments(E,R)).next(N=>{m=N;let B=[];for(let j of c){let z=HS(j,m.get(j.key).overlayedDocument);z!=null&&B.push(new Et(j.key,z,m_(z.value.mapValue),cn.exists(!0)))}return u.mutationQueue.addMutationBatch(E,h,B,c)}).next(N=>{g=N;let B=N.applyToLocalDocumentSet(m,k);return u.documentOverlayCache.saveOverlays(E,N.batchId,B)})}).then(()=>({batchId:g.batchId,changes:A_(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,c,u){let h=o.Ba[o.currentUser.toKey()];h||(h=new me(Z)),h=h.insert(c,u),o.Ba[o.currentUser.toKey()]=h}(r,i.batchId,t),yield us(r,i.changes),yield Sa(r.remoteStore)}catch(i){let s=Jh(i,"Failed to persist write");t.reject(s)}})}function X_(n,e){return y(this,null,function*(){let t=q(n);try{let r=yield _b(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(se(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?se(o.va):i.removedDocuments.size>0&&(se(o.va),o.va=!1))}),yield us(t,r,e)}catch(r){yield os(r)}})}function r_(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let c=o.view.Z_(e);c.snapshot&&i.push(c.snapshot)}),function(o,c){let u=q(o);u.onlineState=c;let h=!1;u.queries.forEach((f,m)=>{for(let g of m.j_)g.Z_(c)&&(h=!0)}),h&&Xh(u)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $b(n,e,t){return y(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new me(M.comparator);o=o.insert(s,rt.newNoDocument(s,$.min()));let c=Y().add(s),u=new Ko($.min(),new Map,new me(Z),o,c);yield X_(r,u),r.Oa=r.Oa.remove(s),r.Na.delete(e),Zh(r)}else yield hh(r.localStore,e,!1).then(()=>Ph(r,e,t)).catch(os)})}function Wb(n,e){return y(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield gb(t.localStore,e);ey(t,r,null),Z_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield us(t,i)}catch(i){yield os(i)}})}function jb(n,e,t){return y(this,null,function*(){let r=q(n);try{let i=yield function(o,c){let u=q(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(m=>(se(m!==null),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(r.localStore,e);ey(r,e,t),Z_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield us(r,i)}catch(i){yield os(i)}})}function Z_(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ey(n,e,t){let r=q(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Ph(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||ty(n,r)})}function ty(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(Kh(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Zh(n))}function i_(n,e,t){for(let r of t)r instanceof aa?(n.La.addReference(r.key,e),zb(n,r)):r instanceof ca?(L("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||ty(n,r.key)):U()}function zb(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(L("SyncEngine","New document in limbo: "+t),n.xa.add(r),Zh(n))}function Zh(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new M(pe.fromString(e)),r=n.qa.next();n.Na.set(r,new Ch(t)),n.Oa=n.Oa.insert(t,r),W_(n.remoteStore,new Zi(_t(Ia(t.path)),r,"TargetPurposeLimboResolution",h_.oe))}}function us(n,e,t){return y(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((c,u)=>{o.push(r.Ka(u,e,t).then(h=>{var f;if((h||t)&&r.isPrimaryClient){let m=h?!h.fromCache:(f=t?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(h){i.push(h);let m=ah.Wi(u.targetId,h);s.push(m)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(u,h){return y(this,null,function*(){let f=q(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>x.forEach(h,g=>x.forEach(g.$i,E=>f.persistence.referenceDelegate.addReference(m,g.targetId,E)).next(()=>x.forEach(g.Ui,E=>f.persistence.referenceDelegate.removeReference(m,g.targetId,E)))))}catch(m){if(!as(m))throw m;L("LocalStore","Failed to update sequence numbers: "+m)}for(let m of h){let g=m.targetId;if(!m.fromCache){let E=f.os.get(g),R=E.snapshotVersion,k=E.withLastLimboFreeSnapshotVersion(R);f.os=f.os.insert(g,k)}}})}(r.localStore,s))})}function Gb(n,e){return y(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){L("SyncEngine","User change. New user:",e.toKey());let r=yield q_(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(c=>{c.forEach(u=>{u.reject(new V(P.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield us(t,r.hs)}})}function Kb(n,e){let t=q(n),r=t.Na.get(e);if(r&&r.va)return Y().add(r.key);{let i=Y(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let c=t.Fa.get(o);i=i.unionWith(c.view.Va)}return i}}function ny(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=X_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kb.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$b.bind(null,e),e.Ca.d_=Ob.bind(null,e.eventManager),e.Ca.$a=Lb.bind(null,e.eventManager),e}function Hb(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Wb.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jb.bind(null,e),e}var s_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return y(this,null,function*(){this.serializer=Ta(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return mb(this.persistence,new uh,t.initialUser,this.serializer)}Ga(t){return new ih(oh.Zr,this.serializer)}Wa(t){return new dh}terminate(){return y(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Qb=(()=>{class n{initialize(t,r){return y(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>r_(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Gb.bind(null,this.syncEngine),yield xb(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Th}()}createDatastore(t){let r=Ta(t.databaseInfo.databaseId),i=function(o){return new mh(o)}(t.databaseInfo);return function(o,c,u,h){return new yh(o,c,u,h)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,o,c,u){return new Ih(i,s,o,c,u)}(this.localStore,this.datastore,t.asyncQueue,r=>r_(this.syncEngine,r,0),function(){return ea.D()?new ea:new fh}())}createSyncEngine(t,r){return function(s,o,c,u,h,f,m){let g=new Rh(s,o,c,u,h,f);return m&&(g.Qa=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return y(this,null,function*(){var t,r;yield function(s){return y(this,null,function*(){let o=q(s);L("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield cs(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var ua=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):qt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Nh=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Te.UNAUTHENTICATED,this.clientId=Bo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>y(this,null,function*(){L("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(L("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new mt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>y(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Jh(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function cl(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),L("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>y(this,null,function*(){r.isEqual(i)||(yield q_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function o_(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Yb(n);L("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>e_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>e_(e.remoteStore,i)),n._onlineComponents=e})}function Yb(n){return y(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L("FirestoreClient","Using user provided OfflineComponentProvider");try{yield cl(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Cr("Error using user provided cache. Falling back to memory cache: "+t),yield cl(n,new s_)}}else L("FirestoreClient","Using default OfflineComponentProvider"),yield cl(n,new s_);return n._offlineComponents})}function ry(n){return y(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(L("FirestoreClient","Using user provided OnlineComponentProvider"),yield o_(n,n._uninitializedComponentsProvider._online)):(L("FirestoreClient","Using default OnlineComponentProvider"),yield o_(n,new Qb))),n._onlineComponents})}function Jb(n){return ry(n).then(e=>e.syncEngine)}function kh(n){return y(this,null,function*(){let e=yield ry(n),t=e.eventManager;return t.onListen=Vb.bind(null,e.syncEngine),t.onUnlisten=Ub.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Mb.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Bb.bind(null,e.syncEngine),t})}function Xb(n,e,t={}){let r=new mt;return n.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return function(s,o,c,u,h){let f=new ua({next:g=>{f.Za(),o.enqueueAndForget(()=>Y_(s,m));let E=g.docs.has(c);!E&&g.fromCache?h.reject(new V(P.UNAVAILABLE,"Failed to get document because the client is offline.")):E&&g.fromCache&&u&&u.source==="server"?h.reject(new V(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new oa(Ia(c.path),f,{includeMetadataChanges:!0,_a:!0});return Q_(s,m)}(yield kh(n),n.asyncQueue,e,t,r)})),r.promise}function iy(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var a_=new Map;function sy(n,e,t){if(!t)throw new V(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zb(n,e,t,r){if(e===!0&&r===!0)throw new V(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function c_(n){if(!M.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function u_(n){if(M.isDocumentKey(n))throw new V(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ed(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function vt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ed(n);throw new V(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var la=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Zb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iy((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Ur=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new la({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new la(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new ul;switch(r.type){case"firstParty":return new fl(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return y(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=a_.get(t);r&&(L("ComponentProvider","Removing Datastore"),a_.delete(t),r.terminate())}(this),Promise.resolve()}};function oy(n,e,t,r={}){var i;let s=(n=vt(n,Ur))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Cr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=Te.MOCK_USER;else{c=so(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Te(h)}n._authCredentials=new ll(new Uo(c,u))}}var ha=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ue=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new un(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},un=class n extends ha{constructor(e,t,r){super(e,t,Ia(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ay(n,e,...t){if(n=ie(n),sy("collection","path",e),n instanceof Ur){let r=pe.fromString(e,...t);return u_(r),new un(n,null,r)}{if(!(n instanceof Ue||n instanceof un))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return u_(r),new un(n.firestore,null,r)}}function cy(n,e,...t){if(n=ie(n),arguments.length===1&&(e=Bo.newId()),sy("doc","path",e),n instanceof Ur){let r=pe.fromString(e,...t);return c_(r),new Ue(n,null,new M(r))}{if(!(n instanceof Ue||n instanceof un))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(pe.fromString(e,...t));return c_(r),new Ue(n.firestore,n instanceof un?n.converter:null,new M(r))}}var da=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ta(this,"async_queue_retry"),this.Vu=()=>{let r=al();r&&L("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=al();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=al();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new mt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return y(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!as(e))throw e;L("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(r);throw qt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=wh.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&U()}verifyOperationInProgress(){}wu(){return y(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function l_(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var fn=class extends Ur{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new da,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return y(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new da(e),this._firestoreClient=void 0,yield e}})}};function uy(n,e){let t=typeof n=="object"?n:Zt(),r=typeof n=="string"?n:e||"(default)",i=Nn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=io("firestore");s&&oy(i,...s)}return i}function td(n){if(n._terminated)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||eC(n),n._firestoreClient}function eC(n){var e,t,r;let i=n._freezeSettings(),s=function(c,u,h,f){return new yl(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,iy(f.experimentalLongPollingOptions),f.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Nh(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(c){let u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}}(n._componentsProvider))}var ns=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Le.fromBase64String(e))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Le.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Br=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var rs=class{constructor(e){this._methodName=e}};var is=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}};var ss=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var tC=/^__.*__$/,Dh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Et(e,this.data,this.fieldMask,t,this.fieldTransforms):new Kn(e,this.data,t,this.fieldTransforms)}},fa=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Et(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ly(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var xh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return ma(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(ly(this.Cu)&&tC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Oh=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ta(e)}Qu(e,t,r,i=!1){return new xh({Cu:e,methodName:t,qu:r,path:Ke.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function hy(n){let e=n._freezeSettings(),t=Ta(n._databaseId);return new Oh(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nC(n,e,t,r,i,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);nd("Data must be an object, but it was:",o,r);let c=dy(r,o),u,h;if(s.merge)u=new Qe(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let g=Lh(e,m,t);if(!o.contains(g))throw new V(P.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);py(f,g)||f.push(g)}u=new Qe(f),h=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,h=o.fieldTransforms;return new Dh(new Ge(c),u,h)}var pa=class n extends rs{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function rC(n,e,t,r){let i=n.Qu(1,e,t);nd("Data must be an object, but it was:",i,r);let s=[],o=Ge.empty();Hn(r,(u,h)=>{let f=rd(e,u,t);h=ie(h);let m=i.Nu(f);if(h instanceof pa)s.push(f);else{let g=ba(h,m);g!=null&&(s.push(f),o.set(f,g))}});let c=new Qe(s);return new fa(o,c,i.fieldTransforms)}function iC(n,e,t,r,i,s){let o=n.Qu(1,e,t),c=[Lh(e,r,t)],u=[i];if(s.length%2!=0)throw new V(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)c.push(Lh(e,s[g])),u.push(s[g+1]);let h=[],f=Ge.empty();for(let g=c.length-1;g>=0;--g)if(!py(h,c[g])){let E=c[g],R=u[g];R=ie(R);let k=o.Nu(E);if(R instanceof pa)h.push(E);else{let N=ba(R,k);N!=null&&(h.push(E),f.set(E,N))}}let m=new Qe(h);return new fa(f,m,o.fieldTransforms)}function ba(n,e){if(fy(n=ie(n)))return nd("Unsupported field value:",e,n),dy(n,e);if(n instanceof rs)return function(r,i){if(!ly(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let c of r){let u=ba(c,i.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ie(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return WS(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=be.fromDate(r);return{timestampValue:Jo(i.serializer,s)}}if(r instanceof be){let s=new be(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Jo(i.serializer,s)}}if(r instanceof is)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ns)return{bytesValue:O_(i.serializer,r._byteString)};if(r instanceof Ue){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Gh(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof ss)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return zh(c.serializer,u)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${ed(r)}`)}(n,e)}function dy(n,e){let t={};return d_(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hn(n,(r,i)=>{let s=ba(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function fy(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof be||n instanceof is||n instanceof ns||n instanceof Ue||n instanceof rs||n instanceof ss)}function nd(n,e,t){if(!fy(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=ed(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Lh(n,e,t){if((e=ie(e))instanceof Br)return e._internalPath;if(typeof e=="string")return rd(n,e);throw ma("Field path arguments must be of type string or ",n,!1,void 0,t)}var sC=new RegExp("[~\\*/\\[\\]]");function rd(n,e,t){if(e.search(sC)>=0)throw ma(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Br(...e.split("."))._internalPath}catch{throw ma(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ma(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new V(P.INVALID_ARGUMENT,c+n+u)}function py(n,e){return n.some(t=>t.isEqual(e))}var ga=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Vh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(my("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Vh=class extends ga{data(){return super.data()}};function my(n,e){return typeof e=="string"?rd(n,e):e instanceof Br?e._internalPath:e._delegate._internalPath}function oC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Mh=class{convertValue(e,t="none"){switch(jn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ln(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Hn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>he(o.doubleValue));return new ss(s)}convertGeoPoint(e){return new is(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=qh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Yi(e));default:return null}}convertTimestamp(e){let t=$t(e);return new be(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=pe.fromString(e);se(B_(r));let i=new jo(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||qt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function aC(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var qn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},_a=class extends ga{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new br(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(my("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},br=class extends _a{data(e={}){return super.data(e)}},Fh=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new qn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new br(this._firestore,this._userDataWriter,r.key,r,new qn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new br(i._firestore,i._userDataWriter,c.doc.key,c.doc,new qn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new br(i._firestore,i._userDataWriter,c.doc.key,c.doc,new qn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:cC(c.type),doc:u,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function cC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function gy(n){n=vt(n,Ue);let e=vt(n.firestore,fn);return Xb(td(e),n._key).then(t=>Iy(e,n,t))}var ya=class extends Mh{constructor(e){super(),this.firestore=e}convertBytes(e){return new ns(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}};function _y(n,e,t){n=vt(n,Ue);let r=vt(n.firestore,fn),i=aC(n.converter,e,t);return vy(r,[nC(hy(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,cn.none())])}function yy(n,e,t,...r){n=vt(n,Ue);let i=vt(n.firestore,fn),s=hy(i),o;return o=typeof(e=ie(e))=="string"||e instanceof Br?iC(s,"updateDoc",n._key,e,t,r):rC(s,"updateDoc",n._key,e),vy(i,[o.toMutation(n._key,cn.exists(!0))])}function id(n,...e){var t,r,i;n=ie(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||l_(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(l_(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,h,f;if(n instanceof Ue)h=vt(n.firestore,fn),f=Ia(n._key.path),u={next:m=>{e[o]&&e[o](Iy(h,n,m))},error:e[o+1],complete:e[o+2]};else{let m=vt(n,ha);h=vt(m.firestore,fn),f=m._query;let g=new ya(h);u={next:E=>{e[o]&&e[o](new Fh(h,g,m,E))},error:e[o+1],complete:e[o+2]},oC(n._query)}return function(g,E,R,k){let N=new ua(k),B=new oa(E,N,R);return g.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return Q_(yield kh(g),B)})),()=>{N.Za(),g.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return Y_(yield kh(g),B)}))}}(td(h),f,c,u)}function vy(n,e){return function(r,i){let s=new mt;return r.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return qb(yield Jb(r),i,s)})),s.promise}(td(n),e)}function Iy(n,e,t){let r=t.docs.get(e._key),i=new ya(n);return new _a(n,i,e._key,r,new qn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){qr=i})(ht),lt(new We("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new fn(new hl(r.getProvider("auth-internal")),new ml(r.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jo(h.options.projectId,f)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),le(xg,"4.7.3",e),le(xg,"4.7.3","esm2017")})();var Ca=function(){return Ca=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ca.apply(this,arguments)};var hC={includeMetadataChanges:!1};function wy(n,e){return e===void 0&&(e=hC),new Pt(function(t){var r=id(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Ey(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Ca(Ca({},r),(t={},t[e.idField]=n.id,t))}function Ty(n){return wy(n,{includeMetadataChanges:!0}).pipe(qc(function(e){return e.docs}))}function Ay(n,e){return e===void 0&&(e={}),Ty(n).pipe(qc(function(t){return t.map(function(r){return Ey(r,e)})}))}var Yn=class{constructor(e){return e}},Sy="firestore",sd=class{constructor(){return Dn(Sy)}};var od=new Yt("angularfire2.firestore-instances");function dC(n,e){let t=_r(Sy,n,e);return t&&new Yn(t)}function fC(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Yn(r)}}var pC={provide:sd,deps:[[new Se,od]]},mC={provide:Yn,useFactory:dC,deps:[[new Se,od],nt]};function GD(n,...e){return le("angularfire",Lt.full,"fst"),Jt([mC,pC,{provide:od,useFactory:fC(n),multi:!0,deps:[He,kt,tn,Vt,[new Se,Fn],[new Se,en],...e]}])}var KD=ne(Ay,!0);var HD=ne(ay,!0);var ls=ne(cy,!0);var ad=ne(gy,!0);var QD=ne(uy,!0);var by=ne(_y,!0);var Cy=ne(yy,!0);function cd(n,e){let t=!e?.manualCleanup;t&&!e?.injector&&Qp(cd);let r=t?e?.injector?.get(Wc)??Hp(Wc):null,i=_C(e?.equal),s;e?.requireSync?s=Ai({kind:0},{equal:i}):s=Ai({kind:1,value:e?.initialValue},{equal:i});let o=n.subscribe({next:c=>s.set({kind:1,value:c}),error:c=>{if(e?.rejectErrors)throw c;s.set({kind:2,error:c})}});if(e?.requireSync&&s().kind===0)throw new $c(601,!1);return r?.onDestroy(o.unsubscribe.bind(o)),Zp(()=>{let c=s();switch(c.kind){case 1:return c.value;case 2:throw c.error;case 0:throw new $c(601,!1)}},{equal:e?.equal})}function _C(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}var Ry=class n{constructor(e,t,r){this.auth=e;this.firestore=t;this.router=r;let i=Cg(this.auth);this.user$=cd(i.pipe(Gp(s=>s?this.fetchUser(s.uid):Bc(null))),{initialValue:null})}userSignal=Ai(null);user$;getUser(){return this.userSignal()}getUserRole(){return this.userSignal()?.role??"public"}fetchUser(e){return y(this,null,function*(){let t=ls(this.firestore,`users/${e}`),r=yield ad(t);if(!r.exists())return null;let i=r.data();return i.uid=e,this.userSignal.set(i),i})}login(e,t){return y(this,null,function*(){let i=(yield Pg(this.auth,e,t)).user.uid,s=ls(this.firestore,`users/${i}`),o=yield ad(s);if(!o.exists())throw new Error("Profilo utente non trovato in Firestore");let c=o.data();c.uid=i,this.userSignal.set(c)})}register(e,t){return y(this,null,function*(){let r=yield Rg(this.auth,e,t);yield this.createUserProfile(r.user.uid,e)})}logout(){return y(this,null,function*(){yield Ng(this.auth),this.userSignal.set(null),this.router.navigate(["/login"])})}createUserProfile(e,t){return y(this,null,function*(){let r={uid:e,email:t,name:"",role:"user",createdAt:new Date,updatedAt:new Date,isActive:!0,notificationPreferences:{email:!0},themePreference:"system",totalSpent:0,totalBookings:0,tags:[]},i=ls(this.firestore,`users/${e}`);yield by(i,r),this.userSignal.set(r)})}updateUser(e){return y(this,null,function*(){let t=this.userSignal();if(!t)throw new Error("Nessun utente autenticato");let r=ls(this.firestore,`users/${t.uid}`);yield Cy(r,An(ot({},e),{updatedAt:new Date})),this.userSignal.set(An(ot(ot({},t),e),{updatedAt:new Date}))})}updateCurrentUserProfile(e){return y(this,null,function*(){return this.updateUser(e)})}waitForUser(e=5e3){return new Promise(t=>{let r=Date.now(),i=()=>{let s=this.getUser();if(s)return t(s);if(Date.now()-r>e)return t(null);setTimeout(i,100)};i()})}static \u0275fac=function(t){return new(t||n)(Nt(Mn),Nt(Yn),Nt(em))};static \u0275prov=hr({token:n,factory:n.\u0275fac,providedIn:"root"})};var Py="@firebase/database",Ny="1.0.8";var ff="";function yC(n){ff=n}var gd=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),_e(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:dr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var _d=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return et(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var cv=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gd(e)}}catch{}return new _d},Xn=cv("localStorage"),yd=cv("sessionStorage");var zr=new ct("@firebase/database"),vC=function(){let n=1;return function(){return n++}}(),uv=function(n){let e=pm(n),t=new to;t.update(e);let r=t.digest();return no.encodeByteArray(r)},ks=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=ks.apply(null,r):typeof r=="object"?e+=_e(r):e+=r,e+=" "}return e},Zn=null,ky=!0,IC=function(n,e){D(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(zr.logLevel=G.VERBOSE,Zn=zr.log.bind(zr),e&&yd.set("logging_enabled",!0)):typeof n=="function"?Zn=n:(Zn=null,yd.remove("logging_enabled"))},Ce=function(...n){if(ky===!0&&(ky=!1,Zn===null&&yd.get("logging_enabled")===!0&&IC(!0)),Zn){let e=ks.apply(null,n);Zn(e)}},Ds=function(n){return function(...e){Ce(n,...e)}},vd=function(...n){let e="FIREBASE INTERNAL ERROR: "+ks(...n);zr.error(e)},jt=function(...n){let e=`FIREBASE FATAL ERROR: ${ks(...n)}`;throw zr.error(e),new Error(e)},qe=function(...n){let e="FIREBASE WARNING: "+ks(...n);zr.warn(e)},wC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&qe("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},pf=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},EC=function(n){if(at()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},tr="[MIN_NAME]",_n="[MAX_NAME]",ir=function(n,e){if(n===e)return 0;if(n===tr||e===_n)return-1;if(e===tr||n===_n)return 1;{let t=Dy(n),r=Dy(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},TC=function(n,e){return n===e?0:n<e?-1:1},hs=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+_e(e))},mf=function(n){if(typeof n!="object"||n===null)return _e(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=_e(e[r]),t+=":",t+=mf(n[e[r]]);return t+="}",t},lv=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Re(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var hv=function(n){D(!pf(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,c,u;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=c+r,o=Math.round(n*Math.pow(2,t-c)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let h=[];for(u=t;u;u-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)h.push(s%2?1:0),s=Math.floor(s/2);h.push(i?1:0),h.reverse();let f=h.join(""),m="";for(u=0;u<64;u+=8){let g=parseInt(f.substr(u,8),2).toString(16);g.length===1&&(g="0"+g),m=m+g}return m.toLowerCase()},AC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},SC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function bC(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var CC=new RegExp("^-?(0*)\\d{1,10}$"),RC=-2147483648,PC=2147483647,Dy=function(n){if(CC.test(n)){let e=Number(n);if(e>=RC&&e<=PC)return e}return null},ti=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw qe("Exception was thrown by user callback.",t),e},Math.floor(0))}},NC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gs=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Id=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){qe(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var wd=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ce("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',qe(e)}},_s=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Pa="5",dv="v",fv="s",pv="r",mv="f",gv=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,_v="ls",yv="p",Ed="ac",vv="websocket",Iv="long_polling";var Na=class{constructor(e,t,r,i,s=!1,o="",c=!1,u=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=c,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Xn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Xn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function kC(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function wv(n,e,t){D(typeof e=="string","typeof type must == string"),D(typeof t=="object","typeof params must == object");let r;if(e===vv)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Iv)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);kC(n)&&(t.ns=n.namespace);let i=[];return Re(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Td=class{constructor(){this.counters_={}}incrementCounter(e,t=1){et(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return rm(this.counters_)}};var ud={},ld={};function gf(n){let e=n.toString();return ud[e]||(ud[e]=new Td),ud[e]}function DC(n,e){let t=n.toString();return ld[t]||(ld[t]=e()),ld[t]}var Ad=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&ti(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var xy="start",xC="close",OC="pLPCommand",LC="pRTLPCB",Ev="id",Tv="pw",Av="ser",VC="cb",MC="seg",FC="ts",UC="d",BC="dframe",Sv=1870,bv=30,qC=Sv-bv,$C=25e3,WC=3e4,Sd=class n{constructor(e,t,r,i,s,o,c){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=c,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ds(e),this.stats_=gf(t),this.urlFn=u=>(this.appCheckToken&&(u[Ed]=this.appCheckToken),wv(t,Iv,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ad(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(WC)),EC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new bd((...s)=>{let[o,c,u,h,f]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===xy)this.id=c,this.password=u;else if(o===xC)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,c]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,c)},()=>{this.onClosed_()},this.urlFn);let r={};r[xy]="t",r[Av]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[VC]=this.scriptTagHolder.uniqueCallbackIdentifier),r[dv]=Pa,this.transportSessionId&&(r[fv]=this.transportSessionId),this.lastSessionId&&(r[_v]=this.lastSessionId),this.applicationId&&(r[yv]=this.applicationId),this.appCheckToken&&(r[Ed]=this.appCheckToken),typeof location<"u"&&location.hostname&&gv.test(location.hostname)&&(r[pv]=mv);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return at()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!AC()&&!SC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=_e(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=Hc(t),i=lv(r,qC);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(at())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[BC]="t",r[Ev]=e,r[Tv]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=_e(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},bd=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,at())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=vC(),window[OC+this.uniqueCallbackIdentifier]=e,window[LC+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(c){Ce("frame writing exception"),c.stack&&Ce(c.stack),Ce(c)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ce("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Ev]=this.myID,e[Tv]=this.myPW,e[Av]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+bv+r.length<=Sv;){let o=this.pendingSegs.shift();r=r+"&"+MC+i+"="+o.seg+"&"+FC+i+"="+o.ts+"&"+UC+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor($C)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){at()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ce("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var jC=16384,zC=45e3,ka=null;typeof MozWebSocket<"u"?ka=MozWebSocket:typeof WebSocket<"u"&&(ka=WebSocket);var ds=(()=>{class n{constructor(t,r,i,s,o,c,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ds(this.connId),this.stats_=gf(r),this.connURL=n.connectionURL_(r,c,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let c={};return c[dv]=Pa,!at()&&typeof location<"u"&&location.hostname&&gv.test(location.hostname)&&(c[pv]=mv),r&&(c[fv]=r),i&&(c[_v]=i),s&&(c[Ed]=s),o&&(c[yv]=o),wv(t,vv,c)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Xn.set("previous_websocket_failure",!0);try{let i;if(at()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Pa}/${ff}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,c=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;c&&(i.proxy={origin:c})}this.mySock=new ka(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&ka!==null&&!n.forceDisallow_}static previouslyFailed(){return Xn.isInMemoryStorage||Xn.get("previous_websocket_failure")===!0}markConnectionHealthy(){Xn.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=dr(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(D(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=_e(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=lv(r,jC);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(zC))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),GC=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Sd,ds]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=ds&&ds.isAvailable(),i=r&&!ds.previouslyFailed();if(t.webSocketOnly&&(r||qe("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ds];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),KC=6e4,HC=5e3,QC=10*1024,YC=100*1024,hd="t",Oy="d",JC="s",Ly="r",XC="e",Vy="o",My="a",Fy="n",Uy="p",ZC="h",Cd=class{constructor(e,t,r,i,s,o,c,u,h,f){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=c,this.onDisconnect_=u,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ds("c:"+this.id+":"),this.transportManager_=new GC(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=gs(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>YC?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>QC?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(hd in e){let t=e[hd];t===My?this.upgradeIfSecondaryHealthy_():t===Ly?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Vy&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=hs("t",e),r=hs("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Uy,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:My,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Fy,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=hs("t",e),r=hs("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=hs(hd,e);if(Oy in e){let r=e[Oy];if(t===ZC){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Fy){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===JC?this.onConnectionShutdown_(r):t===Ly?this.onReset_(r):t===XC?vd("Server Error: "+r):t===Vy?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):vd("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Pa!==r&&qe("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),gs(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(KC))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gs(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(HC))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Uy,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Xn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Da=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var xa=class{constructor(e){this.allowedEvents_=e,this.listeners_={},D(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){D(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Oa=class n extends xa{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ci()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return D(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var By=32,qy=768,te=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ee(){return new te("")}function K(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function yn(n){return n.pieces_.length-n.pieceNum_}function ce(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new te(n.pieces_,e)}function _f(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function eR(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function ws(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Cv(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new te(e,0)}function ge(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof te)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new te(t,0)}function H(n){return n.pieceNum_>=n.pieces_.length}function Be(n,e){let t=K(n),r=K(e);if(t===null)return e;if(t===r)return Be(ce(n),ce(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function tR(n,e){let t=ws(n,0),r=ws(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=ir(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function yf(n,e){if(yn(n)!==yn(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Ye(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(yn(n)>yn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Rd=class{constructor(e,t){this.errorPrefix_=t,this.parts_=ws(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ni(this.parts_[r]);Rv(this)}};function nR(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ni(e),Rv(n)}function rR(n){let e=n.parts_.pop();n.byteLength_-=Ni(e),n.parts_.length>0&&(n.byteLength_-=1)}function Rv(n){if(n.byteLength_>qy)throw new Error(n.errorPrefix_+"has a key path longer than "+qy+" bytes ("+n.byteLength_+").");if(n.parts_.length>By)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+By+") or object contains a cycle "+Jn(n))}function Jn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Pd=class n extends xa{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return D(e==="visible","Unknown event type: "+e),[this.visible_]}};var fs=1e3,iR=60*5*1e3,$y=30*1e3,sR=1.3,oR=3e4,aR="server_kill",Wy=3,vf=(()=>{class n extends Da{constructor(t,r,i,s,o,c,u,h){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=c,this.appCheckTokenProvider_=u,this.authOverride_=h,this.id=n.nextPersistentConnectionId_++,this.log_=Ds("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fs,this.maxReconnectDelay_=iR,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!at())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pd.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Oa.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(_e(o)),D(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new Dt,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:c=>{let u=c.d;c.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,c=t._path.toString();this.log_("Listen called for "+c+" "+o),this.listens.has(c)||this.listens.set(c,new Map),D(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),D(!this.listens.get(c).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(c).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},c="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(c,o,u=>{let h=u.d,f=u.s;n.warnOnListenWarnings_(h,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),f!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(f,h))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&et(t,"w")){let i=bn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();qe(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||dm(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=$y)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=hm(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,c=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),D(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},c="n";s&&(o.q=i,o.t=s),this.sendRequest(c,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,c=>{s&&setTimeout(()=>{s(c.s,c.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let c={p:r,d:i};o!==void 0&&(c.h=o),this.outstandingPuts_.push({action:t,request:c,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+_e(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):vd("Unrecognized action received from server: "+_e(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){D(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fs,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=fs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>oR&&(this.reconnectDelay_=fs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*sR)}this.onConnectStatus_(!1)}establishConnection_(){return y(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,c=!1,u=null,h=function(){u?u.close():(c=!0,i())},f=function(g){D(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(g)};this.realtime_={close:h,sendRequest:f};let m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,E]=yield Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);c?Ce("getToken() completed but was canceled"):(Ce("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=E&&E.token,u=new Cd(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,R=>{qe(R+" ("+this.repoInfo_.toString()+")"),this.interrupt(aR)},o))}catch(g){this.log_("Failed to get token: "+g),c||(this.repoInfo_.nodeAdmin&&qe(g),h())}}})}interrupt(t){Ce("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Ce("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ri(this.interruptReasons_)&&(this.reconnectDelay_=fs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>mf(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new te(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){Ce("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Wy&&(this.reconnectDelay_=$y,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Ce("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Wy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";at()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+ff.replace(/\./g,"-")]=1,Ci()?t["framework.cordova"]=1:oo()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Oa.getInstance().currentlyOnline();return Ri(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),Q=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Gr=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new Q(tr,e),i=new Q(tr,t);return this.compare(r,i)!==0}minPost(){return Q.MIN}};var Ra,La=class extends Gr{static get __EMPTY_NODE(){return Ra}static set __EMPTY_NODE(e){Ra=e}compare(e,t){return ir(e.name,t.name)}isDefinedOn(e){throw Sn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Q.MIN}maxPost(){return new Q(_n,Ra)}makePost(e,t){return D(typeof e=="string","KeyIndex indexValue must always be a string."),new Q(e,Ra)}toString(){return".key"}},er=new La;var jr=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},it=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??Je.EMPTY_NODE,this.right=o??Je.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Je.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return Je.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Nd=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new it(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Je=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,it.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,it.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new jr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new jr(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new jr(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new jr(this.root_,null,this.comparator_,!0,e)}};Je.EMPTY_NODE=new Nd;function cR(n,e){return ir(n.name,e.name)}function If(n,e){return ir(n,e)}var kd;function uR(n){kd=n}var Pv=function(n){return typeof n=="number"?"number:"+hv(n):"string:"+n},Nv=function(n){if(n.isLeafNode()){let e=n.val();D(typeof e=="string"||typeof e=="number"||typeof e=="object"&&et(e,".sv"),"Priority must be a string or number.")}else D(n===kd||n.isEmpty(),"priority of unexpected type.");D(n===kd||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var jy,Kr=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,D(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Nv(this.priorityNode_)}static set __childrenNodeConstructor(t){jy=t}static get __childrenNodeConstructor(){return jy}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return H(t)?this:K(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=K(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(D(i!==".priority"||yn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ce(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Pv(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=hv(this.value_):t+=this.value_,this.lazyHash_=uv(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(D(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return D(s>=0,"Unknown leaf type: "+r),D(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),kv,Dv;function lR(n){kv=n}function hR(n){Dv=n}var Dd=class extends Gr{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?ir(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Q.MIN}maxPost(){return new Q(_n,new Kr("[PRIORITY-POST]",Dv))}makePost(e,t){let r=kv(e);return new Q(t,new Kr("[PRIORITY-POST]",r))}toString(){return".priority"}},de=new Dd;var dR=Math.log(2),xd=class{constructor(e){let t=s=>parseInt(Math.log(s)/dR,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Va=function(n,e,t,r){n.sort(e);let i=function(u,h){let f=h-u,m,g;if(f===0)return null;if(f===1)return m=n[u],g=t?t(m):m,new it(g,m.node,it.BLACK,null,null);{let E=parseInt(f/2,10)+u,R=i(u,E),k=i(E+1,h);return m=n[E],g=t?t(m):m,new it(g,m.node,it.BLACK,R,k)}},s=function(u){let h=null,f=null,m=n.length,g=function(R,k){let N=m-R,B=m;m-=R;let j=i(N+1,B),z=n[N],oe=t?t(z):z;E(new it(oe,z.node,k,null,j))},E=function(R){h?(h.left=R,h=R):(f=R,h=R)};for(let R=0;R<u.count;++R){let k=u.nextBitIsOne(),N=Math.pow(2,u.count-(R+1));k?g(N,it.BLACK):(g(N,it.BLACK),g(N,it.RED))}return f},o=new xd(n.length),c=s(o);return new Je(r||e,c)};var dd,Wr={},Hr=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return D(Wr&&de,"ChildrenNode.ts has not been loaded"),dd=dd||new n({".priority":Wr},{".priority":de}),dd}get(e){let t=bn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Je?t:null}hasIndex(e){return et(this.indexSet_,e.toString())}addIndex(e,t){D(e!==er,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(Q.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let c;i?c=Va(r,e.getCompare()):c=Wr;let u=e.toString(),h=Object.assign({},this.indexSet_);h[u]=e;let f=Object.assign({},this.indexes_);return f[u]=c,new n(f,h)}addToIndexes(e,t){let r=Pi(this.indexes_,(i,s)=>{let o=bn(this.indexSet_,s);if(D(o,"Missing index implementation for "+s),i===Wr)if(o.isDefinedOn(e.node)){let c=[],u=t.getIterator(Q.Wrap),h=u.getNext();for(;h;)h.name!==e.name&&c.push(h),h=u.getNext();return c.push(e),Va(c,o.getCompare())}else return Wr;else{let c=t.get(e.name),u=i;return c&&(u=u.remove(new Q(e.name,c))),u.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Pi(this.indexes_,i=>{if(i===Wr)return i;{let s=t.get(e.name);return s?i.remove(new Q(e.name,s)):i}});return new n(r,this.indexSet_)}};var ps,W=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Nv(this.priorityNode_),this.children_.isEmpty()&&D(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ps||(ps=new n(new Je(If),null,Hr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ps}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?ps:r}}getChild(t){let r=K(t);return r===null?this:this.getImmediateChild(r).getChild(ce(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(D(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new Q(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let c=s.isEmpty()?ps:this.priorityNode_;return new n(s,c,o)}}updateChild(t,r){let i=K(t);if(i===null)return r;{D(K(t)!==".priority"||yn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(ce(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(de,(c,u)=>{r[c]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(c)?s=Math.max(s,Number(c)):o=!1}),!t&&o&&s<2*i){let c=[];for(let u in r)c[u]=r[u];return c}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Pv(this.getPriority().val())+":"),this.forEachChild(de,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":uv(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new Q(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new Q(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new Q(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,Q.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,Q.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===xs?-1:0}withIndex(t){if(t===er||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===er||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(de),s=r.getIterator(de),o=i.getNext(),c=s.getNext();for(;o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=i.getNext(),c=s.getNext()}return o===null&&c===null}else return!1;else return!1}}resolveIndex_(t){return t===er?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Od=class extends W{constructor(){super(new Je(If),W.EMPTY_NODE,Hr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return W.EMPTY_NODE}isEmpty(){return!1}},xs=new Od;Object.defineProperties(Q,{MIN:{value:new Q(tr,W.EMPTY_NODE)},MAX:{value:new Q(_n,xs)}});La.__EMPTY_NODE=W.EMPTY_NODE;Kr.__childrenNodeConstructor=W;uR(xs);hR(xs);var fR=!0;function we(n,e=null){if(n===null)return W.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),D(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Kr(t,we(e))}if(!(n instanceof Array)&&fR){let t=[],r=!1;if(Re(n,(o,c)=>{if(o.substring(0,1)!=="."){let u=we(c);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),t.push(new Q(o,u)))}}),t.length===0)return W.EMPTY_NODE;let s=Va(t,cR,o=>o.name,If);if(r){let o=Va(t,de.getCompare());return new W(s,we(e),new Hr({".priority":o},{".priority":de}))}else return new W(s,we(e),Hr.Default)}else{let t=W.EMPTY_NODE;return Re(n,(r,i)=>{if(et(n,r)&&r.substring(0,1)!=="."){let s=we(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(we(e))}}lR(we);var Es=class extends Gr{constructor(e){super(),this.indexPath_=e,D(!H(e)&&K(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?ir(e.name,t.name):s}makePost(e,t){let r=we(e),i=W.EMPTY_NODE.updateChild(this.indexPath_,r);return new Q(t,i)}maxPost(){let e=W.EMPTY_NODE.updateChild(this.indexPath_,xs);return new Q(_n,e)}toString(){return ws(this.indexPath_,0).join("/")}};var Ld=class extends Gr{compare(e,t){let r=e.node.compareTo(t.node);return r===0?ir(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Q.MIN}maxPost(){return Q.MAX}makePost(e,t){let r=we(e);return new Q(t,r)}toString(){return".value"}},xv=new Ld;function Ov(n){return{type:"value",snapshotNode:n}}function Qr(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ts(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function As(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function pR(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Ss=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){D(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let c=e.getImmediateChild(t);return c.getChild(i).equals(r.getChild(i))&&c.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Ts(t,c)):D(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):c.isEmpty()?o.trackChildChange(Qr(t,r)):o.trackChildChange(As(t,r,c))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(de,(i,s)=>{t.hasChild(i)||r.trackChildChange(Ts(i,s))}),t.isLeafNode()||t.forEachChild(de,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(As(i,s,o))}else r.trackChildChange(Qr(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?W.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Ma=class n{constructor(e){this.indexedFilter_=new Ss(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new Q(t,r))||(r=W.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=W.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(W.EMPTY_NODE);let s=this;return t.forEachChild(de,(o,c)=>{s.matches(new Q(o,c))||(i=i.updateImmediateChild(o,W.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Vd=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ma(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new Q(t,r))||(r=W.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=W.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=W.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let c=s.getNext();if(this.withinDirectionalStart(c))if(this.withinDirectionalEnd(c))i=i.updateImmediateChild(c.name,c.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(W.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let c=s.getNext();o<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?o++:i=i.updateImmediateChild(c.name,W.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let m=this.index_.getCompare();o=(g,E)=>m(E,g)}else o=this.index_.getCompare();let c=e;D(c.numChildren()===this.limit_,"");let u=new Q(t,r),h=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),f=this.rangedFilter_.matches(u);if(c.hasChild(t)){let m=c.getImmediateChild(t),g=i.getChildAfterChild(this.index_,h,this.reverse_);for(;g!=null&&(g.name===t||c.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let E=g==null?1:o(g,u);if(f&&!r.isEmpty()&&E>=0)return s?.trackChildChange(As(t,r,m)),c.updateImmediateChild(t,r);{s?.trackChildChange(Ts(t,m));let k=c.updateImmediateChild(t,W.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(Qr(g.name,g.node)),k.updateImmediateChild(g.name,g.node)):k}}else return r.isEmpty()?e:f&&o(h,u)>=0?(s!=null&&(s.trackChildChange(Ts(h.name,h.node)),s.trackChildChange(Qr(t,r))),c.updateImmediateChild(t,r).updateImmediateChild(h.name,W.EMPTY_NODE)):e}};var Md=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=de}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return D(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return D(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:tr}hasEnd(){return this.endSet_}getIndexEndValue(){return D(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return D(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:_n}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return D(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===de}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function mR(n){return n.loadsAllData()?new Ss(n.getIndex()):n.hasLimit()?new Vd(n):new Ma(n)}function gR(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function _R(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function yR(n,e){let t=n.copy();return t.index_=e,t}function zy(n){let e={};if(n.isDefault())return e;let t;if(n.index_===de?t="$priority":n.index_===xv?t="$value":n.index_===er?t="$key":(D(n.index_ instanceof Es,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=_e(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=_e(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+_e(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=_e(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+_e(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Gy(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==de&&(e.i=n.index_.toString()),e}var Fd=class n extends Da{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Ds("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(D(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),c={};this.listens_[o]=c;let u=zy(e._queryParams);this.restRequest_(s+".json",u,(h,f)=>{let m=f;if(h===404&&(m=null,h=null),h===null&&this.onDataUpdate_(s,m,!1,r),bn(this.listens_,o)===c){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=zy(e._queryParams),r=e._path.toString(),i=new Dt;return this.restRequest_(r+".json",t,(s,o)=>{let c=o;s===404&&(c=null,s=null),s===null?(this.onDataUpdate_(r,c,!1,null),i.resolve(c)):i.reject(new Error(c))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Rn(t);this.log_("Sending REST request for "+o);let c=new XMLHttpRequest;c.onreadystatechange=()=>{if(r&&c.readyState===4){this.log_("REST Response for "+o+" received. status:",c.status,"response:",c.responseText);let u=null;if(c.status>=200&&c.status<300){try{u=dr(c.responseText)}catch{qe("Failed to parse JSON response for "+o+": "+c.responseText)}r(null,u)}else c.status!==401&&c.status!==404&&qe("Got unsuccessful REST response for "+o+" Status: "+c.status),r(c.status);r=null}},c.open("GET",o,!0),c.send()})}};var Ud=class{constructor(){this.rootNode_=W.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Fa(){return{value:null,children:new Map}}function Lv(n,e,t){if(H(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=K(e);n.children.has(r)||n.children.set(r,Fa());let i=n.children.get(r);e=ce(e),Lv(i,e,t)}}function Bd(n,e,t){n.value!==null?t(e,n.value):vR(n,(r,i)=>{let s=new te(e.toString()+"/"+r);Bd(i,s,t)})}function vR(n,e){n.children.forEach((t,r)=>{e(r,t)})}var qd=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Re(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var Ky=10*1e3,IR=30*1e3,wR=5*60*1e3,$d=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new qd(e);let r=Ky+(IR-Ky)*Math.random();gs(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;Re(e,(i,s)=>{s>0&&et(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),gs(this.reportStats_.bind(this),Math.floor(Math.random()*2*wR))}};var Tt=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Tt||{});function wf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ef(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Tf(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Wd=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Tt.ACK_USER_WRITE,this.source=wf()}operationForChild(e){if(H(this.path)){if(this.affectedTree.value!=null)return D(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new te(e));return new n(ee(),t,this.revert)}}else return D(K(this.path)===e,"operationForChild called for unrelated child."),new n(ce(this.path),this.affectedTree,this.revert)}};var Ua=class n{constructor(e,t){this.source=e,this.path=t,this.type=Tt.LISTEN_COMPLETE}operationForChild(e){return H(this.path)?new n(this.source,ee()):new n(this.source,ce(this.path))}};var Yr=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Tt.OVERWRITE}operationForChild(e){return H(this.path)?new n(this.source,ee(),this.snap.getImmediateChild(e)):new n(this.source,ce(this.path),this.snap)}};var bs=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Tt.MERGE}operationForChild(e){if(H(this.path)){let t=this.children.subtree(new te(e));return t.isEmpty()?null:t.value?new Yr(this.source,ee(),t.value):new n(this.source,ee(),t)}else return D(K(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,ce(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var At=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(H(e))return this.isFullyInitialized()&&!this.filtered_;let t=K(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var jd=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function ER(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(pR(o.childName,o.snapshotNode))}),ms(n,i,"child_removed",e,r,t),ms(n,i,"child_added",e,r,t),ms(n,i,"child_moved",s,r,t),ms(n,i,"child_changed",e,r,t),ms(n,i,"value",e,r,t),i}function ms(n,e,t,r,i,s){let o=r.filter(c=>c.type===t);o.sort((c,u)=>AR(n,c,u)),o.forEach(c=>{let u=TR(n,c,s);i.forEach(h=>{h.respondsTo(c.type)&&e.push(h.createEvent(u,n.query_))})})}function TR(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function AR(n,e,t){if(e.childName==null||t.childName==null)throw Sn("Should only compare child_ events.");let r=new Q(e.childName,e.snapshotNode),i=new Q(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function tc(n,e){return{eventCache:n,serverCache:e}}function ys(n,e,t,r){return tc(new At(e,t,r),n.serverCache)}function Vv(n,e,t,r){return tc(n.eventCache,new At(e,t,r))}function Ba(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function nr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var fd,SR=()=>(fd||(fd=new Je(TC)),fd),$e=class n{constructor(e,t=SR()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return Re(e,(r,i)=>{t=t.set(new te(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ee(),value:this.value};if(H(e))return null;{let r=K(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(ce(e),t);return s!=null?{path:ge(new te(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(H(e))return this;{let t=K(e),r=this.children.get(t);return r!==null?r.subtree(ce(e)):new n(null)}}set(e,t){if(H(e))return new n(t,this.children);{let r=K(e),s=(this.children.get(r)||new n(null)).set(ce(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(H(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=K(e),r=this.children.get(t);if(r){let i=r.remove(ce(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(H(e))return this.value;{let t=K(e),r=this.children.get(t);return r?r.get(ce(e)):null}}setTree(e,t){if(H(e))return t;{let r=K(e),s=(this.children.get(r)||new n(null)).setTree(ce(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(ee(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ge(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ee(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(H(e))return null;{let s=K(e),o=this.children.get(s);return o?o.findOnPath_(ce(e),ge(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ee(),t)}foreachOnPath_(e,t,r){if(H(e))return this;{this.value&&r(t,this.value);let i=K(e),s=this.children.get(i);return s?s.foreachOnPath_(ce(e),ge(t,i),r):new n(null)}}foreach(e){this.foreach_(ee(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(ge(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var st=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new $e(null))}};function vs(n,e,t){if(H(e))return new st(new $e(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=Be(i,e);return s=s.updateChild(o,t),new st(n.writeTree_.set(i,s))}else{let i=new $e(t),s=n.writeTree_.setTree(e,i);return new st(s)}}}function zd(n,e,t){let r=n;return Re(t,(i,s)=>{r=vs(r,ge(e,i),s)}),r}function Hy(n,e){if(H(e))return st.empty();{let t=n.writeTree_.setTree(e,new $e(null));return new st(t)}}function Gd(n,e){return sr(n,e)!=null}function sr(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Be(t.path,e)):null}function Qy(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(de,(r,i)=>{e.push(new Q(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Q(r,i.value))}),e}function mn(n,e){if(H(e))return n;{let t=sr(n,e);return t!=null?new st(new $e(t)):new st(n.writeTree_.subtree(e))}}function Kd(n){return n.writeTree_.isEmpty()}function Jr(n,e){return Mv(ee(),n.writeTree_,e)}function Mv(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(D(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=Mv(ge(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(ge(n,".priority"),r)),t}}function nc(n,e){return qv(e,n)}function bR(n,e,t,r,i){D(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=vs(n.visibleWrites,e,t)),n.lastWriteId=r}function CR(n,e,t,r){D(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=zd(n.visibleWrites,e,t),n.lastWriteId=r}function RR(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function PR(n,e){let t=n.allWrites.findIndex(c=>c.writeId===e);D(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let c=n.allWrites[o];c.visible&&(o>=t&&NR(c,r.path)?i=!1:Ye(r.path,c.path)&&(s=!0)),o--}if(i){if(s)return kR(n),!0;if(r.snap)n.visibleWrites=Hy(n.visibleWrites,r.path);else{let c=r.children;Re(c,u=>{n.visibleWrites=Hy(n.visibleWrites,ge(r.path,u))})}return!0}else return!1}function NR(n,e){if(n.snap)return Ye(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Ye(ge(n.path,t),e))return!0;return!1}function kR(n){n.visibleWrites=Fv(n.allWrites,DR,ee()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function DR(n){return n.visible}function Fv(n,e,t){let r=st.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,c;if(s.snap)Ye(t,o)?(c=Be(t,o),r=vs(r,c,s.snap)):Ye(o,t)&&(c=Be(o,t),r=vs(r,ee(),s.snap.getChild(c)));else if(s.children){if(Ye(t,o))c=Be(t,o),r=zd(r,c,s.children);else if(Ye(o,t))if(c=Be(o,t),H(c))r=zd(r,ee(),s.children);else{let u=bn(s.children,K(c));if(u){let h=u.getChild(ce(c));r=vs(r,ee(),h)}}}else throw Sn("WriteRecord should have .snap or .children")}}return r}function Uv(n,e,t,r,i){if(!r&&!i){let s=sr(n.visibleWrites,e);if(s!=null)return s;{let o=mn(n.visibleWrites,e);if(Kd(o))return t;if(t==null&&!Gd(o,ee()))return null;{let c=t||W.EMPTY_NODE;return Jr(o,c)}}}else{let s=mn(n.visibleWrites,e);if(!i&&Kd(s))return t;if(!i&&t==null&&!Gd(s,ee()))return null;{let o=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(Ye(h.path,e)||Ye(e,h.path))},c=Fv(n.allWrites,o,e),u=t||W.EMPTY_NODE;return Jr(c,u)}}}function xR(n,e,t){let r=W.EMPTY_NODE,i=sr(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(de,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=mn(n.visibleWrites,e);return t.forEachChild(de,(o,c)=>{let u=Jr(mn(s,new te(o)),c);r=r.updateImmediateChild(o,u)}),Qy(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=mn(n.visibleWrites,e);return Qy(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function OR(n,e,t,r,i){D(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=ge(e,t);if(Gd(n.visibleWrites,s))return null;{let o=mn(n.visibleWrites,s);return Kd(o)?i.getChild(t):Jr(o,i.getChild(t))}}function LR(n,e,t,r){let i=ge(e,t),s=sr(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=mn(n.visibleWrites,i);return Jr(o,r.getNode().getImmediateChild(t))}else return null}function VR(n,e){return sr(n.visibleWrites,e)}function MR(n,e,t,r,i,s,o){let c,u=mn(n.visibleWrites,e),h=sr(u,ee());if(h!=null)c=h;else if(t!=null)c=Jr(u,t);else return[];if(c=c.withIndex(o),!c.isEmpty()&&!c.isLeafNode()){let f=[],m=o.getCompare(),g=s?c.getReverseIteratorFrom(r,o):c.getIteratorFrom(r,o),E=g.getNext();for(;E&&f.length<i;)m(E,r)!==0&&f.push(E),E=g.getNext();return f}else return[]}function FR(){return{visibleWrites:st.empty(),allWrites:[],lastWriteId:-1}}function qa(n,e,t,r){return Uv(n.writeTree,n.treePath,e,t,r)}function Af(n,e){return xR(n.writeTree,n.treePath,e)}function Yy(n,e,t,r){return OR(n.writeTree,n.treePath,e,t,r)}function $a(n,e){return VR(n.writeTree,ge(n.treePath,e))}function UR(n,e,t,r,i,s){return MR(n.writeTree,n.treePath,e,t,r,i,s)}function Sf(n,e,t){return LR(n.writeTree,n.treePath,e,t)}function Bv(n,e){return qv(ge(n.treePath,e),n.writeTree)}function qv(n,e){return{treePath:n,writeTree:e}}var Hd=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;D(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),D(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,As(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Ts(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Qr(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,As(r,e.snapshotNode,i.oldSnap));else throw Sn("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Qd=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},$v=new Qd,Cs=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new At(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Sf(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:nr(this.viewCache_),s=UR(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function BR(n){return{filter:n}}function qR(n,e){D(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),D(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function $R(n,e,t,r,i){let s=new Hd,o,c;if(t.type===Tt.OVERWRITE){let h=t;h.source.fromUser?o=Yd(n,e,h.path,h.snap,r,i,s):(D(h.source.fromServer,"Unknown source."),c=h.source.tagged||e.serverCache.isFiltered()&&!H(h.path),o=Wa(n,e,h.path,h.snap,r,i,c,s))}else if(t.type===Tt.MERGE){let h=t;h.source.fromUser?o=jR(n,e,h.path,h.children,r,i,s):(D(h.source.fromServer,"Unknown source."),c=h.source.tagged||e.serverCache.isFiltered(),o=Jd(n,e,h.path,h.children,r,i,c,s))}else if(t.type===Tt.ACK_USER_WRITE){let h=t;h.revert?o=KR(n,e,h.path,r,i,s):o=zR(n,e,h.path,h.affectedTree,r,i,s)}else if(t.type===Tt.LISTEN_COMPLETE)o=GR(n,e,t.path,r,s);else throw Sn("Unknown operation type: "+t.type);let u=s.getChanges();return WR(e,o,u),{viewCache:o,changes:u}}function WR(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Ba(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Ov(Ba(e)))}}function Wv(n,e,t,r,i,s){let o=e.eventCache;if($a(r,t)!=null)return e;{let c,u;if(H(t))if(D(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let h=nr(e),f=h instanceof W?h:W.EMPTY_NODE,m=Af(r,f);c=n.filter.updateFullNode(e.eventCache.getNode(),m,s)}else{let h=qa(r,nr(e));c=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let h=K(t);if(h===".priority"){D(yn(t)===1,"Can't have a priority with additional path components");let f=o.getNode();u=e.serverCache.getNode();let m=Yy(r,t,f,u);m!=null?c=n.filter.updatePriority(f,m):c=o.getNode()}else{let f=ce(t),m;if(o.isCompleteForChild(h)){u=e.serverCache.getNode();let g=Yy(r,t,o.getNode(),u);g!=null?m=o.getNode().getImmediateChild(h).updateChild(f,g):m=o.getNode().getImmediateChild(h)}else m=Sf(r,h,e.serverCache);m!=null?c=n.filter.updateChild(o.getNode(),h,m,f,i,s):c=o.getNode()}}return ys(e,c,o.isFullyInitialized()||H(t),n.filter.filtersNodes())}}function Wa(n,e,t,r,i,s,o,c){let u=e.serverCache,h,f=o?n.filter:n.filter.getIndexedFilter();if(H(t))h=f.updateFullNode(u.getNode(),r,null);else if(f.filtersNodes()&&!u.isFiltered()){let E=u.getNode().updateChild(t,r);h=f.updateFullNode(u.getNode(),E,null)}else{let E=K(t);if(!u.isCompleteForPath(t)&&yn(t)>1)return e;let R=ce(t),N=u.getNode().getImmediateChild(E).updateChild(R,r);E===".priority"?h=f.updatePriority(u.getNode(),N):h=f.updateChild(u.getNode(),E,N,R,$v,null)}let m=Vv(e,h,u.isFullyInitialized()||H(t),f.filtersNodes()),g=new Cs(i,m,s);return Wv(n,m,t,i,g,c)}function Yd(n,e,t,r,i,s,o){let c=e.eventCache,u,h,f=new Cs(i,e,s);if(H(t))h=n.filter.updateFullNode(e.eventCache.getNode(),r,o),u=ys(e,h,!0,n.filter.filtersNodes());else{let m=K(t);if(m===".priority")h=n.filter.updatePriority(e.eventCache.getNode(),r),u=ys(e,h,c.isFullyInitialized(),c.isFiltered());else{let g=ce(t),E=c.getNode().getImmediateChild(m),R;if(H(g))R=r;else{let k=f.getCompleteChild(m);k!=null?_f(g)===".priority"&&k.getChild(Cv(g)).isEmpty()?R=k:R=k.updateChild(g,r):R=W.EMPTY_NODE}if(E.equals(R))u=e;else{let k=n.filter.updateChild(c.getNode(),m,R,g,f,o);u=ys(e,k,c.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function Jy(n,e){return n.eventCache.isCompleteForChild(e)}function jR(n,e,t,r,i,s,o){let c=e;return r.foreach((u,h)=>{let f=ge(t,u);Jy(e,K(f))&&(c=Yd(n,c,f,h,i,s,o))}),r.foreach((u,h)=>{let f=ge(t,u);Jy(e,K(f))||(c=Yd(n,c,f,h,i,s,o))}),c}function Xy(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Jd(n,e,t,r,i,s,o,c){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,h;H(t)?h=r:h=new $e(null).setTree(t,r);let f=e.serverCache.getNode();return h.children.inorderTraversal((m,g)=>{if(f.hasChild(m)){let E=e.serverCache.getNode().getImmediateChild(m),R=Xy(n,E,g);u=Wa(n,u,new te(m),R,i,s,o,c)}}),h.children.inorderTraversal((m,g)=>{let E=!e.serverCache.isCompleteForChild(m)&&g.value===null;if(!f.hasChild(m)&&!E){let R=e.serverCache.getNode().getImmediateChild(m),k=Xy(n,R,g);u=Wa(n,u,new te(m),k,i,s,o,c)}}),u}function zR(n,e,t,r,i,s,o){if($a(i,t)!=null)return e;let c=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(H(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Wa(n,e,t,u.getNode().getChild(t),i,s,c,o);if(H(t)){let h=new $e(null);return u.getNode().forEachChild(er,(f,m)=>{h=h.set(new te(f),m)}),Jd(n,e,t,h,i,s,c,o)}else return e}else{let h=new $e(null);return r.foreach((f,m)=>{let g=ge(t,f);u.isCompleteForPath(g)&&(h=h.set(f,u.getNode().getChild(g)))}),Jd(n,e,t,h,i,s,c,o)}}function GR(n,e,t,r,i){let s=e.serverCache,o=Vv(e,s.getNode(),s.isFullyInitialized()||H(t),s.isFiltered());return Wv(n,o,t,r,$v,i)}function KR(n,e,t,r,i,s){let o;if($a(r,t)!=null)return e;{let c=new Cs(r,e,i),u=e.eventCache.getNode(),h;if(H(t)||K(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=qa(r,nr(e));else{let m=e.serverCache.getNode();D(m instanceof W,"serverChildren would be complete if leaf node"),f=Af(r,m)}f=f,h=n.filter.updateFullNode(u,f,s)}else{let f=K(t),m=Sf(r,f,e.serverCache);m==null&&e.serverCache.isCompleteForChild(f)&&(m=u.getImmediateChild(f)),m!=null?h=n.filter.updateChild(u,f,m,ce(t),c,s):e.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(u,f,W.EMPTY_NODE,ce(t),c,s):h=u,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=qa(r,nr(e)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,s)))}return o=e.serverCache.isFullyInitialized()||$a(r,ee())!=null,ys(e,h,o,n.filter.filtersNodes())}}var Xd=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Ss(r.getIndex()),s=mR(r);this.processor_=BR(s);let o=t.serverCache,c=t.eventCache,u=i.updateFullNode(W.EMPTY_NODE,o.getNode(),null),h=s.updateFullNode(W.EMPTY_NODE,c.getNode(),null),f=new At(u,o.isFullyInitialized(),i.filtersNodes()),m=new At(h,c.isFullyInitialized(),s.filtersNodes());this.viewCache_=tc(m,f),this.eventGenerator_=new jd(this.query_)}get query(){return this.query_}};function HR(n){return n.viewCache_.serverCache.getNode()}function QR(n){return Ba(n.viewCache_)}function YR(n,e){let t=nr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!H(e)&&!t.getImmediateChild(K(e)).isEmpty())?t.getChild(e):null}function Zy(n){return n.eventRegistrations_.length===0}function JR(n,e){n.eventRegistrations_.push(e)}function ev(n,e,t){let r=[];if(t){D(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function tv(n,e,t,r){e.type===Tt.MERGE&&e.source.queryId!==null&&(D(nr(n.viewCache_),"We should always have a full cache before handling merges"),D(Ba(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=$R(n.processor_,i,e,t,r);return qR(n.processor_,s.viewCache),D(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,jv(n,s.changes,s.viewCache.eventCache.getNode(),null)}function XR(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(de,(s,o)=>{r.push(Qr(s,o))}),t.isFullyInitialized()&&r.push(Ov(t.getNode())),jv(n,r,t.getNode(),e)}function jv(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return ER(n.eventGenerator_,e,t,i)}var ja,za=class{constructor(){this.views=new Map}};function ZR(n){D(!ja,"__referenceConstructor has already been defined"),ja=n}function e0(){return D(ja,"Reference.ts has not been loaded"),ja}function t0(n){return n.views.size===0}function bf(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return D(s!=null,"SyncTree gave us an op for an invalid query."),tv(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(tv(o,e,t,r));return s}}function zv(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let c=qa(t,i?r:null),u=!1;c?u=!0:r instanceof W?(c=Af(t,r),u=!1):(c=W.EMPTY_NODE,u=!1);let h=tc(new At(c,u,!1),new At(r,i,!1));return new Xd(e,h)}return o}function n0(n,e,t,r,i,s){let o=zv(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),JR(o,t),XR(o,t)}function r0(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],c=vn(n);if(i==="default")for(let[u,h]of n.views.entries())o=o.concat(ev(h,t,r)),Zy(h)&&(n.views.delete(u),h.query._queryParams.loadsAllData()||s.push(h.query));else{let u=n.views.get(i);u&&(o=o.concat(ev(u,t,r)),Zy(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return c&&!vn(n)&&s.push(new(e0())(e._repo,e._path)),{removed:s,events:o}}function Gv(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function gn(n,e){let t=null;for(let r of n.views.values())t=t||YR(r,e);return t}function Kv(n,e){if(e._queryParams.loadsAllData())return rc(n);{let r=e._queryIdentifier;return n.views.get(r)}}function Hv(n,e){return Kv(n,e)!=null}function vn(n){return rc(n)!=null}function rc(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Ga;function i0(n){D(!Ga,"__referenceConstructor has already been defined"),Ga=n}function s0(){return D(Ga,"Reference.ts has not been loaded"),Ga}var o0=1,Ka=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $e(null),this.pendingWriteTree_=FR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Qv(n,e,t,r,i){return bR(n.pendingWriteTree_,e,t,r,i),i?ni(n,new Yr(wf(),e,t)):[]}function a0(n,e,t,r){CR(n.pendingWriteTree_,e,t,r);let i=$e.fromObject(t);return ni(n,new bs(wf(),e,i))}function pn(n,e,t=!1){let r=RR(n.pendingWriteTree_,e);if(PR(n.pendingWriteTree_,e)){let s=new $e(null);return r.snap!=null?s=s.set(ee(),!0):Re(r.children,o=>{s=s.set(new te(o),!0)}),ni(n,new Wd(r.path,s,t))}else return[]}function Os(n,e,t){return ni(n,new Yr(Ef(),e,t))}function c0(n,e,t){let r=$e.fromObject(t);return ni(n,new bs(Ef(),e,r))}function u0(n,e){return ni(n,new Ua(Ef(),e))}function l0(n,e,t){let r=Rf(n,t);if(r){let i=Pf(r),s=i.path,o=i.queryId,c=Be(s,e),u=new Ua(Tf(o),c);return Nf(n,s,u)}else return[]}function Ha(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),c=[];if(o&&(e._queryIdentifier==="default"||Hv(o,e))){let u=r0(o,e,t,r);t0(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let h=u.removed;if(c=u.events,!i){let f=h.findIndex(g=>g._queryParams.loadsAllData())!==-1,m=n.syncPointTree_.findOnPath(s,(g,E)=>vn(E));if(f&&!m){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let E=f0(g);for(let R=0;R<E.length;++R){let k=E[R],N=k.query,B=Zv(n,k);n.listenProvider_.startListening(Is(N),Rs(n,N),B.hashFn,B.onComplete)}}}!m&&h.length>0&&!r&&(f?n.listenProvider_.stopListening(Is(e),null):h.forEach(g=>{let E=n.queryToTagMap.get(ic(g));n.listenProvider_.stopListening(Is(g),E)}))}p0(n,h)}return c}function Yv(n,e,t,r){let i=Rf(n,r);if(i!=null){let s=Pf(i),o=s.path,c=s.queryId,u=Be(o,e),h=new Yr(Tf(c),u,t);return Nf(n,o,h)}else return[]}function h0(n,e,t,r){let i=Rf(n,r);if(i){let s=Pf(i),o=s.path,c=s.queryId,u=Be(o,e),h=$e.fromObject(t),f=new bs(Tf(c),u,h);return Nf(n,o,f)}else return[]}function Zd(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,E)=>{let R=Be(g,i);s=s||gn(E,R),o=o||vn(E)});let c=n.syncPointTree_.get(i);c?(o=o||vn(c),s=s||gn(c,ee())):(c=new za,n.syncPointTree_=n.syncPointTree_.set(i,c));let u;s!=null?u=!0:(u=!1,s=W.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((E,R)=>{let k=gn(R,ee());k&&(s=s.updateImmediateChild(E,k))}));let h=Hv(c,e);if(!h&&!e._queryParams.loadsAllData()){let g=ic(e);D(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let E=m0();n.queryToTagMap.set(g,E),n.tagToQueryMap.set(E,g)}let f=nc(n.pendingWriteTree_,i),m=n0(c,e,t,f,s,u);if(!h&&!o&&!r){let g=Kv(c,e);m=m.concat(g0(n,e,g))}return m}function Cf(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,c)=>{let u=Be(o,e),h=gn(c,u);if(h)return h});return Uv(i,e,s,t,!0)}function d0(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(h,f)=>{let m=Be(h,t);r=r||gn(f,m)});let i=n.syncPointTree_.get(t);i?r=r||gn(i,ee()):(i=new za,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new At(r,!0,!1):null,c=nc(n.pendingWriteTree_,e._path),u=zv(i,e,c,s?o.getNode():W.EMPTY_NODE,s);return QR(u)}function ni(n,e){return Jv(e,n.syncPointTree_,null,nc(n.pendingWriteTree_,ee()))}function Jv(n,e,t,r){if(H(n.path))return Xv(n,e,t,r);{let i=e.get(ee());t==null&&i!=null&&(t=gn(i,ee()));let s=[],o=K(n.path),c=n.operationForChild(o),u=e.children.get(o);if(u&&c){let h=t?t.getImmediateChild(o):null,f=Bv(r,o);s=s.concat(Jv(c,u,h,f))}return i&&(s=s.concat(bf(i,n,r,t))),s}}function Xv(n,e,t,r){let i=e.get(ee());t==null&&i!=null&&(t=gn(i,ee()));let s=[];return e.children.inorderTraversal((o,c)=>{let u=t?t.getImmediateChild(o):null,h=Bv(r,o),f=n.operationForChild(o);f&&(s=s.concat(Xv(f,c,u,h)))}),i&&(s=s.concat(bf(i,n,r,t))),s}function Zv(n,e){let t=e.query,r=Rs(n,t);return{hashFn:()=>(HR(e)||W.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?l0(n,t._path,r):u0(n,t._path);{let s=bC(i,t);return Ha(n,t,null,s)}}}}function Rs(n,e){let t=ic(e);return n.queryToTagMap.get(t)}function ic(n){return n._path.toString()+"$"+n._queryIdentifier}function Rf(n,e){return n.tagToQueryMap.get(e)}function Pf(n){let e=n.indexOf("$");return D(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new te(n.substr(0,e))}}function Nf(n,e,t){let r=n.syncPointTree_.get(e);D(r,"Missing sync point for query tag that we're tracking");let i=nc(n.pendingWriteTree_,e);return bf(r,t,i,null)}function f0(n){return n.fold((e,t,r)=>{if(t&&vn(t))return[rc(t)];{let i=[];return t&&(i=Gv(t)),Re(r,(s,o)=>{i=i.concat(o)}),i}})}function Is(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(s0())(n._repo,n._path):n}function p0(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=ic(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function m0(){return o0++}function g0(n,e,t){let r=e._path,i=Rs(n,e),s=Zv(n,t),o=n.listenProvider_.startListening(Is(e),i,s.hashFn,s.onComplete),c=n.syncPointTree_.subtree(r);if(i)D(!vn(c.value),"If we're adding a query, it shouldn't be shadowed");else{let u=c.fold((h,f,m)=>{if(!H(h)&&f&&vn(f))return[rc(f).query];{let g=[];return f&&(g=g.concat(Gv(f).map(E=>E.query))),Re(m,(E,R)=>{g=g.concat(R)}),g}});for(let h=0;h<u.length;++h){let f=u[h];n.listenProvider_.stopListening(Is(f),Rs(n,f))}}return o}var ef=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},tf=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ge(this.path_,e);return new n(this.syncTree_,t)}node(){return Cf(this.syncTree_,this.path_)}},_0=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},nv=function(n,e,t){if(!n||typeof n!="object")return n;if(D(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return y0(n[".sv"],e,t);if(typeof n[".sv"]=="object")return v0(n[".sv"],e);D(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},y0=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:D(!1,"Unexpected server value: "+n)}},v0=function(n,e,t){n.hasOwnProperty("increment")||D(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&D(!1,"Unexpected increment value: "+r);let i=e.node();if(D(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},eI=function(n,e,t,r){return kf(e,new tf(t,n),r)},tI=function(n,e,t){return kf(n,new ef(e),t)};function kf(n,e,t){let r=n.getPriority().val(),i=nv(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,c=nv(o.getValue(),e,t);return c!==o.getValue()||i!==o.getPriority().val()?new Kr(c,we(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Kr(i))),o.forEachChild(de,(c,u)=>{let h=kf(u,e.getImmediateChild(c),t);h!==u&&(s=s.updateImmediateChild(c,h))}),s}}var Ps=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Df(n,e){let t=e instanceof te?e:new te(e),r=n,i=K(t);for(;i!==null;){let s=bn(r.node.children,i)||{children:{},childCount:0};r=new Ps(i,r,s),t=ce(t),i=K(t)}return r}function ri(n){return n.node.value}function nI(n,e){n.node.value=e,nf(n)}function rI(n){return n.node.childCount>0}function I0(n){return ri(n)===void 0&&!rI(n)}function sc(n,e){Re(n.node.children,(t,r)=>{e(new Ps(t,n,r))})}function iI(n,e,t,r){t&&!r&&e(n),sc(n,i=>{iI(i,e,!0,r)}),t&&r&&e(n)}function w0(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Ls(n){return new te(n.parent===null?n.name:Ls(n.parent)+"/"+n.name)}function nf(n){n.parent!==null&&E0(n.parent,n.name,n)}function E0(n,e,t){let r=I0(t),i=et(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,nf(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,nf(n))}var T0=/[\[\].#$\/\u0000-\u001F\u007F]/,A0=/[\[\].#$\u0000-\u001F\u007F]/,pd=10*1024*1024,oc=function(n){return typeof n=="string"&&n.length!==0&&!T0.test(n)},sI=function(n){return typeof n=="string"&&n.length!==0&&!A0.test(n)},S0=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),sI(n)},rf=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!pf(n)||n&&typeof n=="object"&&et(n,".sv")},Vs=function(n,e,t,r){r&&e===void 0||ac(mr(n,"value"),e,t)},ac=function(n,e,t){let r=t instanceof te?new Rd(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Jn(r));if(typeof e=="function")throw new Error(n+"contains a function "+Jn(r)+" with contents = "+e.toString());if(pf(e))throw new Error(n+"contains "+e.toString()+" "+Jn(r));if(typeof e=="string"&&e.length>pd/3&&Ni(e)>pd)throw new Error(n+"contains a string greater than "+pd+" utf8 bytes "+Jn(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Re(e,(o,c)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!oc(o)))throw new Error(n+" contains an invalid key ("+o+") "+Jn(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);nR(r,o),ac(n,c,r),rR(r)}),i&&s)throw new Error(n+' contains ".value" child '+Jn(r)+" in addition to actual children.")}},b0=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=ws(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!oc(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(tR);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Ye(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},C0=function(n,e,t,r){if(r&&e===void 0)return;let i=mr(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];Re(e,(o,c)=>{let u=new te(o);if(ac(i,c,ge(t,u)),_f(u)===".priority"&&!rf(c))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),b0(i,s)};var xf=function(n,e,t,r){if(!(r&&t===void 0)&&!oc(t))throw new Error(mr(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Of=function(n,e,t,r){if(!(r&&t===void 0)&&!sI(t))throw new Error(mr(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},R0=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Of(n,e,t,r)},Lf=function(n,e){if(K(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},P0=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!oc(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!S0(t))throw new Error(mr(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var sf=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function cc(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!yf(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function oI(n,e,t){cc(n,t),aI(n,r=>yf(r,e))}function Xe(n,e,t){cc(n,t),aI(n,r=>Ye(r,e)||Ye(e,r))}function aI(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(N0(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function N0(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();Zn&&Ce("event: "+t.toString()),ti(r)}}}var k0="repo_interrupt",D0=25,of=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fa(),this.transactionQueueTree_=new Ps,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function x0(n,e,t){if(n.stats_=gf(n.repoInfo_),n.forceRestClient_||NC())n.server_=new Fd(n.repoInfo_,(r,i,s,o)=>{rv(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>iv(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{_e(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new vf(n.repoInfo_,e,(r,i,s,o)=>{rv(n,r,i,s,o)},r=>{iv(n,r)},r=>{O0(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=DC(n.repoInfo_,()=>new $d(n.stats_,n.server_)),n.infoData_=new Ud,n.infoSyncTree_=new Ka({startListening:(r,i,s,o)=>{let c=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(c=Os(n.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),c},stopListening:()=>{}}),Vf(n,"connected",!1),n.serverSyncTree_=new Ka({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(c,u)=>{let h=o(c,u);Xe(n.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function cI(n){let t=n.infoData_.getNode(new te(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function uc(n){return _0({timestamp:cI(n)})}function rv(n,e,t,r,i){n.dataUpdateCount++;let s=new te(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let u=Pi(t,h=>we(h));o=h0(n.serverSyncTree_,s,u,i)}else{let u=we(t);o=Yv(n.serverSyncTree_,s,u,i)}else if(r){let u=Pi(t,h=>we(h));o=c0(n.serverSyncTree_,s,u)}else{let u=we(t);o=Os(n.serverSyncTree_,s,u)}let c=s;o.length>0&&(c=Xr(n,s)),Xe(n.eventQueue_,c,o)}function iv(n,e){Vf(n,"connected",e),e===!1&&F0(n)}function O0(n,e){Re(e,(t,r)=>{Vf(n,t,r)})}function Vf(n,e,t){let r=new te("/.info/"+e),i=we(t);n.infoData_.updateSnapshot(r,i);let s=Os(n.infoSyncTree_,r,i);Xe(n.eventQueue_,r,s)}function Mf(n){return n.nextWriteId_++}function L0(n,e,t){let r=d0(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=we(i).withIndex(e._queryParams.getIndex());Zd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Os(n.serverSyncTree_,e._path,s);else{let c=Rs(n.serverSyncTree_,e);o=Yv(n.serverSyncTree_,e._path,s,c)}return Xe(n.eventQueue_,e._path,o),Ha(n.serverSyncTree_,e,t,null,!0),s},i=>(Ms(n,"get for query "+_e(e)+" failed: "+i),Promise.reject(new Error(i))))}function V0(n,e,t,r,i){Ms(n,"set",{path:e.toString(),value:t,priority:r});let s=uc(n),o=we(t,r),c=Cf(n.serverSyncTree_,e),u=tI(o,c,s),h=Mf(n),f=Qv(n.serverSyncTree_,e,u,h,!0);cc(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(g,E)=>{let R=g==="ok";R||qe("set at "+e+" failed: "+g);let k=pn(n.serverSyncTree_,h,!R);Xe(n.eventQueue_,e,k),af(n,i,g,E)});let m=Uf(n,e);Xr(n,m),Xe(n.eventQueue_,m,[])}function M0(n,e,t,r){Ms(n,"update",{path:e.toString(),value:t});let i=!0,s=uc(n),o={};if(Re(t,(c,u)=>{i=!1,o[c]=eI(ge(e,c),we(u),n.serverSyncTree_,s)}),i)Ce("update() called with empty data.  Don't do anything."),af(n,r,"ok",void 0);else{let c=Mf(n),u=a0(n.serverSyncTree_,e,o,c);cc(n.eventQueue_,u),n.server_.merge(e.toString(),t,(h,f)=>{let m=h==="ok";m||qe("update at "+e+" failed: "+h);let g=pn(n.serverSyncTree_,c,!m),E=g.length>0?Xr(n,e):e;Xe(n.eventQueue_,E,g),af(n,r,h,f)}),Re(t,h=>{let f=Uf(n,ge(e,h));Xr(n,f)}),Xe(n.eventQueue_,e,[])}}function F0(n){Ms(n,"onDisconnectEvents");let e=uc(n),t=Fa();Bd(n.onDisconnect_,ee(),(i,s)=>{let o=eI(i,s,n.serverSyncTree_,e);Lv(t,i,o)});let r=[];Bd(t,ee(),(i,s)=>{r=r.concat(Os(n.serverSyncTree_,i,s));let o=Uf(n,i);Xr(n,o)}),n.onDisconnect_=Fa(),Xe(n.eventQueue_,ee(),r)}function U0(n,e,t){let r;K(e._path)===".info"?r=Zd(n.infoSyncTree_,e,t):r=Zd(n.serverSyncTree_,e,t),oI(n.eventQueue_,e._path,r)}function sv(n,e,t){let r;K(e._path)===".info"?r=Ha(n.infoSyncTree_,e,t):r=Ha(n.serverSyncTree_,e,t),oI(n.eventQueue_,e._path,r)}function B0(n){n.persistentConnection_&&n.persistentConnection_.interrupt(k0)}function Ms(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ce(t,...e)}function af(n,e,t,r){e&&ti(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function uI(n,e,t){return Cf(n.serverSyncTree_,e,t)||W.EMPTY_NODE}function Ff(n,e=n.transactionQueueTree_){if(e||lc(n,e),ri(e)){let t=hI(n,e);D(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&q0(n,Ls(e),t)}else rI(e)&&sc(e,t=>{Ff(n,t)})}function q0(n,e,t){let r=t.map(h=>h.currentWriteId),i=uI(n,e,r),s=i,o=i.hash();for(let h=0;h<t.length;h++){let f=t[h];D(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;let m=Be(e,f.path);s=s.updateChild(m,f.currentOutputSnapshotRaw)}let c=s.val(!0),u=e;n.server_.put(u.toString(),c,h=>{Ms(n,"transaction put response",{path:u.toString(),status:h});let f=[];if(h==="ok"){let m=[];for(let g=0;g<t.length;g++)t[g].status=2,f=f.concat(pn(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&m.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();lc(n,Df(n.transactionQueueTree_,e)),Ff(n,n.transactionQueueTree_),Xe(n.eventQueue_,e,f);for(let g=0;g<m.length;g++)ti(m[g])}else{if(h==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{qe("transaction at "+u.toString()+" failed: "+h);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=h}Xr(n,e)}},o)}function Xr(n,e){let t=lI(n,e),r=Ls(t),i=hI(n,t);return $0(n,i,r),r}function $0(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(c=>c.status===0).map(c=>c.currentWriteId);for(let c=0;c<e.length;c++){let u=e[c],h=Be(t,u.path),f=!1,m;if(D(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)f=!0,m=u.abortReason,i=i.concat(pn(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=D0)f=!0,m="maxretry",i=i.concat(pn(n.serverSyncTree_,u.currentWriteId,!0));else{let g=uI(n,u.path,o);u.currentInputSnapshot=g;let E=e[c].update(g.val());if(E!==void 0){ac("transaction failed: Data returned ",E,u.path);let R=we(E);typeof E=="object"&&E!=null&&et(E,".priority")||(R=R.updatePriority(g.getPriority()));let N=u.currentWriteId,B=uc(n),j=tI(R,g,B);u.currentOutputSnapshotRaw=R,u.currentOutputSnapshotResolved=j,u.currentWriteId=Mf(n),o.splice(o.indexOf(N),1),i=i.concat(Qv(n.serverSyncTree_,u.path,j,u.currentWriteId,u.applyLocally)),i=i.concat(pn(n.serverSyncTree_,N,!0))}else f=!0,m="nodata",i=i.concat(pn(n.serverSyncTree_,u.currentWriteId,!0))}Xe(n.eventQueue_,t,i),i=[],f&&(e[c].status=2,function(g){setTimeout(g,Math.floor(0))}(e[c].unwatcher),e[c].onComplete&&(m==="nodata"?r.push(()=>e[c].onComplete(null,!1,e[c].currentInputSnapshot)):r.push(()=>e[c].onComplete(new Error(m),!1,null))))}lc(n,n.transactionQueueTree_);for(let c=0;c<r.length;c++)ti(r[c]);Ff(n,n.transactionQueueTree_)}function lI(n,e){let t,r=n.transactionQueueTree_;for(t=K(e);t!==null&&ri(r)===void 0;)r=Df(r,t),e=ce(e),t=K(e);return r}function hI(n,e){let t=[];return dI(n,e,t),t.sort((r,i)=>r.order-i.order),t}function dI(n,e,t){let r=ri(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);sc(e,i=>{dI(n,i,t)})}function lc(n,e){let t=ri(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,nI(e,t.length>0?t:void 0)}sc(e,r=>{lc(n,r)})}function Uf(n,e){let t=Ls(lI(n,e)),r=Df(n.transactionQueueTree_,e);return w0(r,i=>{md(n,i)}),md(n,r),iI(r,i=>{md(n,i)}),t}function md(n,e){let t=ri(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(D(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(D(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(pn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?nI(e,void 0):t.length=s+1,Xe(n.eventQueue_,Ls(e),i);for(let o=0;o<r.length;o++)ti(r[o])}}function W0(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function j0(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):qe(`Invalid query segment '${t}' in query '${n}'`)}return e}var ov=function(n,e){let t=z0(n),r=t.namespace;t.domain==="firebase.com"&&jt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&jt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||wC();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Na(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new te(t.pathString)}},z0=function(n){let e="",t="",r="",i="",s="",o=!0,c="https",u=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(c=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let m=n.indexOf("?");m===-1&&(m=n.length),e=n.substring(0,Math.min(f,m)),f<m&&(i=W0(n.substring(f,m)));let g=j0(n.substring(Math.min(n.length,m)));h=e.indexOf(":"),h>=0?(o=c==="https"||c==="wss",u=parseInt(e.substring(h+1),10)):h=e.length;let E=e.slice(0,h);if(E.toLowerCase()==="localhost")t="localhost";else if(E.split(".").length<=2)t=E;else{let R=e.indexOf(".");r=e.substring(0,R).toLowerCase(),t=e.substring(R+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:o,scheme:c,pathString:i,namespace:s}};var av="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",G0=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=av.charAt(t%64),t=Math.floor(t/64);D(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=av.charAt(e[i]);return D(o.length===20,"nextPushId: Length should be 20."),o}}();var Qa=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+_e(this.snapshot.exportVal())}},Ya=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ja=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return D(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Zr=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return H(this._path)?null:_f(this._path)}get ref(){return new St(this._repo,this._path)}get _queryIdentifier(){let e=Gy(this._queryParams),t=mf(e);return t==="{}"?"default":t}get _queryObject(){return Gy(this._queryParams)}isEqual(e){if(e=ie(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=yf(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+eR(this._path)}};function K0(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Bf(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===er){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==tr)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==_n)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===de){if(e!=null&&!rf(e)||t!=null&&!rf(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(D(n.getIndex()instanceof Es||n.getIndex()===xv,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function fI(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var St=class n extends Zr{constructor(e,t){super(e,t,new Md,!1)}get parent(){let e=Cv(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Ns=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new te(e),r=rr(this.ref,e);return new n(this._node.getChild(t),r,de)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,rr(this.ref,r),de)))}hasChild(e){let t=new te(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function pI(n,e){return n=ie(n),n._checkNotDeleted("ref"),e!==void 0?rr(n._root,e):n._root}function rr(n,e){return n=ie(n),K(n._path)===null?R0("child","path",e,!1):Of("child","path",e,!1),new St(n._repo,ge(n._path,e))}function mI(n,e){n=ie(n),Lf("push",n._path),Vs("push",e,n._path,!0);let t=cI(n._repo),r=G0(t),i=rr(n,r),s=rr(n,r),o;return e!=null?o=hc(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function gI(n){return Lf("remove",n._path),hc(n,null)}function hc(n,e){n=ie(n),Lf("set",n._path),Vs("set",e,n._path,!1);let t=new Dt;return V0(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function _I(n,e){C0("update",e,n._path,!1);let t=new Dt;return M0(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function yI(n){n=ie(n);let e=new Ja(()=>{}),t=new Xa(e);return L0(n._repo,n,t).then(r=>new Ns(r,new St(n._repo,n._path),n._queryParams.getIndex()))}var Xa=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new Qa("value",this,new Ns(e.snapshotNode,new St(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ya(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},cf=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ya(this,e,t):null}createEvent(e,t){D(e.childName!=null,"Child events should have a childName.");let r=rr(new St(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Qa(e.type,this,new Ns(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function H0(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=t,h=(f,m)=>{sv(n._repo,n,c),u(f,m)};h.userCallback=t.userCallback,h.context=t.context,t=h}let o=new Ja(t,s||void 0),c=e==="value"?new Xa(o):new cf(e,o);return U0(n._repo,n,c),()=>sv(n._repo,n,c)}function vI(n,e,t,r){return H0(n,"value",e,t,r)}var ei=class{},Za=class extends ei{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Vs("endAt",this._value,e._path,!0);let t=_R(e._queryParams,this._value,this._key);if(fI(t),Bf(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Zr(e._repo,e._path,t,e._orderByCalled)}};function II(n,e){return xf("endAt","key",e,!0),new Za(n,e)}var ec=class extends ei{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Vs("startAt",this._value,e._path,!0);let t=gR(e._queryParams,this._value,this._key);if(fI(t),Bf(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Zr(e._repo,e._path,t,e._orderByCalled)}};function wI(n=null,e){return xf("startAt","key",e,!0),new ec(n,e)}var uf=class extends ei{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){K0(e,"orderByChild");let t=new te(this._path);if(H(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Es(t),i=yR(e._queryParams,r);return Bf(i),new Zr(e._repo,e._path,i,!0)}};function EI(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Of("orderByChild","path",n,!1),new uf(n)}var lf=class extends ei{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Vs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Za(this._value,this._key)._apply(new ec(this._value,this._key)._apply(e))}};function TI(n,e){return xf("equalTo","key",e,!0),new lf(n,e)}function AI(n,...e){let t=ie(n);for(let r of e)t=r._apply(t);return t}ZR(St);i0(St);var Q0="FIREBASE_DATABASE_EMULATOR_HOST",hf={},Y0=!1;function J0(n,e,t,r){n.repoInfo_=new Na(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function X0(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||jt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ce("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ov(s,i),c=o.repoInfo,u,h;typeof process<"u"&&process.env&&(h=process.env[Q0]),h?(u=!0,s=`http://${h}?ns=${c.namespace}`,o=ov(s,i),c=o.repoInfo):u=!o.repoInfo.secure;let f=i&&u?new _s(_s.OWNER):new wd(n.name,n.options,e);P0("Invalid Firebase Database URL",o),H(o.path)||jt("Database URL must point to the root of a Firebase Database (not including a child path).");let m=eP(c,n,f,new Id(n.name,t));return new df(m,n)}function Z0(n,e){let t=hf[e];(!t||t[n.key]!==n)&&jt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),B0(n),delete t[n.key]}function eP(n,e,t,r){let i=hf[e.name];i||(i={},hf[e.name]=i);let s=i[n.toURLString()];return s&&jt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new of(n,Y0,t,r),i[n.toURLString()]=s,s}var df=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(x0(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new St(this._repo,ee())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Z0(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&jt("Cannot call "+e+" on a deleted database.")}};function SI(n=Zt(),e){let t=Nn(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let r=io("database");r&&bI(t,...r)}return t}function bI(n,e,t,r={}){n=ie(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&jt("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&jt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new _s(_s.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:so(r.mockUserToken,n.app.options.projectId);s=new _s(o)}J0(i,e,t,s)}function tP(n){yC(ht),lt(new We("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return X0(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),le(Py,Ny,n),le(Py,Ny,"esm2017")}vf.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};vf.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};tP();var or=class{constructor(e){return e}},CI="database",qf=class{constructor(){return Dn(CI)}};var $f=new Yt("angularfire2.database-instances");function nP(n,e){let t=_r(CI,n,e);return t&&new or(t)}function rP(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new or(r)}}var iP={provide:qf,deps:[[new Se,$f]]},sP={provide:or,useFactory:nP,deps:[[new Se,$f],nt]};function Zx(n,...e){return le("angularfire",Lt.full,"rtdb"),Jt([sP,iP,{provide:$f,useFactory:rP(n),multi:!0,deps:[He,kt,tn,Vt,[new Se,Fn],[new Se,en],...e]}])}var eO=ne(II,!0);var tO=ne(TI,!0);var RI=ne(yI,!0),nO=ne(SI,!0);var PI=ne(vI,!0),rO=ne(EI,!0);var NI=ne(mI,!0),iO=ne(AI,!0),ii=ne(pI,!0);var kI=ne(gI,!0);var DI=ne(hc,!0);var sO=ne(wI,!0),xI=ne(_I,!0);var OI=class n{constructor(e,t){this.db=e;this.zone=t}path="staff";getAllStaff(){return new Pt(e=>{let t=ii(this.db,this.path);PI(t,r=>{this.zone.run(()=>{let i=r.val(),s=i?Object.keys(i).map(o=>ot({id:o},i[o])):[];e.next(s)})})})}addStaff(e){let t=NI(ii(this.db,this.path));return DI(t,An(ot({},e),{id:t.key}))}updateStaff(e,t){return xI(ii(this.db,`${this.path}/${e}`),t)}deleteStaff(e){return kI(ii(this.db,`${this.path}/${e}`))}getStaffById(e){return y(this,null,function*(){let t=yield RI(ii(this.db,`${this.path}/${e}`));return t.exists()?ot({id:e},t.val()):null})}static \u0275fac=function(t){return new(t||n)(Nt(or),Nt(He))};static \u0275prov=hr({token:n,factory:n.\u0275fac,providedIn:"root"})};export{KP as a,HP as b,KN as c,HN as d,Yn as e,GD as f,KD as g,HD as h,QD as i,Ry as j,or as k,Zx as l,eO as m,tO as n,RI as o,nO as p,PI as q,rO as r,NI as s,iO as t,ii as u,kI as v,DI as w,sO as x,xI as y,OI as z};
