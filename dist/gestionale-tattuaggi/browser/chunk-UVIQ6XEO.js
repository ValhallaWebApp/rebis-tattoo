import{a as at}from"./chunk-PBQU3ITQ.js";import{Gb as W,Hb as X,Ib as tt,Lb as et,Na as q,Qa as J,Ta as K,Wa as Q,f as Y,i as $,l as Z,pc as nt,rc as it,xc as ot,zc as rt}from"./chunk-E5ZACFZL.js";import{Ba as z,Ia as o,Ja as i,Ka as j,La as w,Ma as F,Oa as v,Ra as f,Ta as l,_ as S,ac as V,bc as B,ca as r,db as a,eb as d,fb as M,i as y,jc as R,kc as G,m as N,mb as U,mc as H,rb as C,tb as L,ua as g,v as _,vb as O,w as u,ya as A,za as s}from"./chunk-ZWDWJLXC.js";import"./chunk-VPSPPOSA.js";import"./chunk-L4TIKYZG.js";import{M as I,Ob as D,X as T}from"./chunk-Y3XNR5LB.js";import{a as E,b as k}from"./chunk-ACKELEN3.js";function pt(n,t){n&1&&(o(0,"div",7),j(1,"mat-progress-spinner",8),o(2,"div",9),a(3,"Caricamento progetto..."),i()())}function mt(n,t){n&1&&(o(0,"div",7)(1,"mat-icon",10),a(2,"search_off"),i(),o(3,"div",9),a(4,"Progetto non trovato."),i(),o(5,"a",11),a(6," Vai ai progetti "),i()())}function gt(n,t){if(n&1){let e=v();o(0,"button",31),f("click",function(){_(e);let p=l(2);return u(p.prev())}),o(1,"mat-icon"),a(2,"chevron_left"),i()()}}function _t(n,t){if(n&1){let e=v();o(0,"button",32),f("click",function(){_(e);let p=l(2);return u(p.next())}),o(1,"mat-icon"),a(2,"chevron_right"),i()()}}function ut(n,t){if(n&1){let e=v();o(0,"button",35),f("click",function(){let p=_(e).index,m=l(3);return u(m.setActive(p))}),o(1,"img",36),f("error",function(p){_(e);let m=l(3);return u(m.onImgError(p))}),i()()}if(n&2){let e=t.$implicit,c=t.index,p=l(2).ngIf,m=l();z("active",c===m.activeIndex),A("aria-label","immagine "+(c+1)),r(),s("src",e,S)("alt",p.title+" - "+(c+1))}}function ft(n,t){if(n&1&&(o(0,"div",33),g(1,ut,2,5,"button",34),i()),n&2){let e=l(2);r(),s("ngForOf",e.imageUrls())}}function xt(n,t){if(n&1&&(o(0,"mat-chip"),a(1),i()),n&2){let e=l().ngIf;r(),d(e.style)}}function vt(n,t){if(n&1&&(o(0,"mat-chip"),a(1),i()),n&2){let e=l(2);r(),M(" ",e.colorTypeLabel()," ")}}function ht(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Zona"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l(2);r(4),d(e.zoneLabel())}}function bt(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Data progetto"),i(),o(3,"div",27),a(4),C(5,"date"),i()()),n&2){let e=l(2);r(4),d(L(5,1,e.createdAtOf(),"dd/MM/yyyy"))}}function yt(n,t){if(n&1&&(o(0,"div",37),a(1),i()),n&2){let e=l().ngIf;r(),d(e.description)}}function Ct(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Parte del corpo"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l().ngIf;r(4),d(e.bodyPart)}}function Pt(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Posizione"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l().ngIf;r(4),d(e.placement)}}function It(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Dimensione"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l().ngIf;r(4),d(e.size)}}function St(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Soggetto"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l().ngIf;r(4),d(e.subject)}}function jt(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Sedute stimate"),i(),o(3,"div",27),a(4),i()()),n&2){let e=l().ngIf;r(4),d(e.estimatedSessions)}}function Mt(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Prezzo stimato"),i(),o(3,"div",27),a(4),C(5,"currency"),i()()),n&2){let e=l().ngIf;r(4),d(O(5,1,e.estimatedPrice,"EUR","symbol","1.0-0"))}}function Ot(n,t){if(n&1&&(o(0,"div",25)(1,"div",26),a(2,"Acconto"),i(),o(3,"div",27),a(4),C(5,"currency"),i()()),n&2){let e=l().ngIf;r(4),d(O(5,1,e.deposit,"EUR","symbol","1.0-0"))}}function Et(n,t){if(n&1&&(o(0,"mat-card",23)(1,"mat-card-header")(2,"mat-card-title"),a(3,"Note per il cliente"),i()(),o(4,"mat-card-content")(5,"div",38),a(6),i()()()),n&2){let e=l().ngIf;r(6),d(e.clientNotes)}}function kt(n,t){if(n&1){let e=v();w(0),o(1,"div",12)(2,"div",13)(3,"div",14),g(4,gt,3,0,"button",15),o(5,"img",16),f("error",function(p){_(e);let m=l();return u(m.onImgError(p))}),i(),g(6,_t,3,0,"button",17),i(),g(7,ft,2,1,"div",18),i(),o(8,"div",19)(9,"div",20)(10,"div")(11,"h1",21),a(12),i(),o(13,"div",22)(14,"mat-chip-set")(15,"mat-chip"),a(16),i(),g(17,xt,2,1,"mat-chip",6)(18,vt,2,1,"mat-chip",6),i()()()(),o(19,"mat-card",23)(20,"mat-card-content")(21,"div",24)(22,"div",25)(23,"div",26),a(24,"Artista"),i(),o(25,"div",27),a(26),i()(),g(27,ht,5,1,"div",28)(28,bt,6,4,"div",28),i()()(),o(29,"mat-card",23)(30,"mat-card-content"),g(31,yt,2,1,"div",29),o(32,"div",24),g(33,Ct,5,1,"div",28)(34,Pt,5,1,"div",28)(35,It,5,1,"div",28)(36,St,5,1,"div",28)(37,jt,5,1,"div",28)(38,Mt,6,6,"div",28)(39,Ot,6,6,"div",28),i()()(),g(40,Et,7,1,"mat-card",30),i()(),F()}if(n&2){let e=t.ngIf,c=l();r(4),s("ngIf",c.hasMultipleImages()),r(),s("src",c.activeCover(),S)("alt",e.title),r(),s("ngIf",c.hasMultipleImages()),r(),s("ngIf",c.hasMultipleImages()),r(5),d(e.title),r(4),d(c.statusLabel()),r(),s("ngIf",e.style),r(),s("ngIf",c.colorTypeLabel()!=="-"),r(8),d(c.artistName()),r(),s("ngIf",c.zoneLabel()),r(),s("ngIf",c.createdAtOf()),r(3),s("ngIf",e.description),r(2),s("ngIf",e.bodyPart),r(),s("ngIf",e.placement),r(),s("ngIf",e.size),r(),s("ngIf",e.subject),r(),s("ngIf",e.estimatedSessions),r(),s("ngIf",e.estimatedPrice),r(),s("ngIf",e.deposit),r(),s("ngIf",e.clientNotes)}}var ct=class n{route=y(Y);projectsService=y(at);staffService=y(rt);sub;staffSub;loading=!0;notFound=!1;project;artists=[];activeIndex=0;fallbackCover=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800"><defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop offset="0" stop-color="#151515"/><stop offset="1" stop-color="#2a2a2a"/></linearGradient></defs><rect width="1200" height="800" fill="url(#g)"/><rect x="80" y="80" width="1040" height="640" fill="none" stroke="#3a3a3a" stroke-width="6" rx="28"/><path d="M360 520l140-160 120 120 180-220 220 260" fill="none" stroke="#8a8a8a" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/><circle cx="460" cy="320" r="46" fill="#8a8a8a"/><text x="600" y="680" fill="#9a9a9a" font-size="32" text-anchor="middle" font-family="Arial, sans-serif">No photo</text></svg>')}`;ngOnInit(){this.staffSub=this.staffService.getAllStaff().pipe(T(t=>(t??[]).filter(e=>e?.isActive!==!1))).subscribe(t=>this.artists=t??[]),this.sub=this.route.paramMap.pipe(D(t=>{this.loading=!0,this.notFound=!1,this.activeIndex=0;let e=t.get("idProgetto")??t.get("projectId")??t.get("id");return e?I(this.projectsService.getProjectById(e)):I(Promise.resolve(null))})).subscribe(t=>{let e=t?this.normalizeProject(t):void 0;if(e&&(e.isPublic===!1||String(e.status??"").trim()!=="completed")){this.project=void 0,this.notFound=!0,this.loading=!1,this.scrollToTop();return}this.project=e,this.loading=!1,this.notFound=!this.project,this.activeIndex=this.getCoverIndex(),this.scrollToTop()})}ngOnDestroy(){this.sub?.unsubscribe(),this.staffSub?.unsubscribe()}goBackToProjects(){return["/progetti"]}goToArtistProjects(){let t=this.project?.artistId;return t?["/progetti",t]:["/progetti"]}artistName(){let t=this.project?.artistId;return t?this.artists.find(e=>String(e.id??"")===t)?.name??"Artista":"Artista"}projectId(){return String(this.project?.id??"").trim()}createdAtOf(){return String(this.project?.createdAt??this.project?.createAt??this.project?.dataProgetto??"").trim()}zoneLabel(){let t=String(this.project?.bodyPart??"").trim(),e=String(this.project?.zone??"").trim(),c=String(this.project?.placement??"").trim();return[t||e,c].filter(Boolean).join(" - ")}imageUrls(){let t=this.project,c=(Array.isArray(t?.finalImages)?t.finalImages:[]).map(x=>String(x?.url??"").trim()).filter(Boolean),p=Array.isArray(t?.imageUrls)?t.imageUrls:[],m=Array.isArray(t?.copertine)?t.copertine:[],P=[...p,...m].map(x=>String(x??"").trim()).filter(Boolean),h=[...c,...P],b=h.length?Array.from(new Set(h)):[];return b.length?b:[this.fallbackCover]}hasMultipleImages(){return this.imageUrls().length>1}activeCover(){let t=this.imageUrls(),e=Math.min(Math.max(this.activeIndex,0),t.length-1);return t[e]??this.fallbackCover}setActive(t){let e=this.imageUrls();this.activeIndex=Math.min(Math.max(t,0),e.length-1)}next(){let t=this.imageUrls();this.activeIndex=(this.activeIndex+1)%t.length}prev(){let t=this.imageUrls();this.activeIndex=(this.activeIndex-1+t.length)%t.length}onImgError(t){let e=t.target;e&&e.src!==this.fallbackCover&&(e.src=this.fallbackCover)}statusLabel(){let t=String(this.project?.status??"").trim();switch(t){case"draft":return"Bozza";case"scheduled":return"Pianificato";case"active":return"Attivo";case"healing":return"Guarigione";case"completed":return"Concluso";case"cancelled":return"Annullato";case"approved":return"Approvato";case"in_progress":return"In corso";case"paused":return"In pausa";default:return t||"-"}}colorTypeLabel(){let t=String(this.project?.colorType??"").trim().toLowerCase();return t?t==="black"||t==="blackwork"?"Nero":t==="black_grey"||t==="black&grey"||t==="blackgrey"?"Black & Grey":t==="color"||t==="full_color"||t==="fullcolor"?"Colore":t==="mixed"?"Misto":t:"-"}scrollToTop(){typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"})}getCoverIndex(){let e=(Array.isArray(this.project?.finalImages)?this.project.finalImages:[]).findIndex(c=>!!c?.isCover);return e>=0?e:0}normalizeProject(t){let e=String(t?.title??t?.name??"").trim()||"Progetto",c=String(t?.description??t?.notes??t?.note??"").trim(),p=String(t?.style??t?.genere??"").trim(),m=String(t?.subject??"").trim(),P=String(t?.bodyPart??t?.zone??"").trim(),h=String(t?.placement??t?.posizione??"").trim(),b=String(t?.size??t?.dimensione??"").trim(),x=Number.isFinite(Number(t?.estimatedSessions))?Number(t.estimatedSessions):Number.isFinite(Number(t?.numeroSedute))?Number(t.numeroSedute):void 0,st=Number.isFinite(Number(t?.estimatedPrice))?Number(t.estimatedPrice):Number.isFinite(Number(t?.price))?Number(t.price):void 0,lt=Number.isFinite(Number(t?.deposit))?Number(t.deposit):Number.isFinite(Number(t?.acconto))?Number(t.acconto):void 0,dt=String(t?.clientNotes??t?.noteCliente??"").trim();return k(E({},t),{title:e,description:c,style:p,subject:m,bodyPart:P,placement:h,size:b,estimatedSessions:x,estimatedPrice:st,deposit:lt,clientNotes:dt})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-project-detail"]],standalone:!0,features:[U],decls:14,vars:6,consts:[[1,"page"],[1,"topbar"],["mat-stroked-button","",3,"routerLink"],[1,"spacer"],["mat-button","",3,"routerLink"],["class","state",4,"ngIf"],[4,"ngIf"],[1,"state"],["mode","indeterminate","diameter","36"],[1,"state__text"],[1,"state__icon"],["mat-stroked-button","","routerLink","/progetti"],[1,"layout"],[1,"gallery"],[1,"gallery__hero"],["mat-icon-button","","class","nav left","aria-label","precedente",3,"click",4,"ngIf"],["loading","lazy","decoding","async",1,"hero-img",3,"error","src","alt"],["mat-icon-button","","class","nav right","aria-label","successivo",3,"click",4,"ngIf"],["class","thumbs",4,"ngIf"],[1,"details"],[1,"head"],[1,"title"],[1,"meta"],[1,"card"],[1,"grid"],[1,"row"],[1,"k"],[1,"v"],["class","row",4,"ngIf"],["class","desc",4,"ngIf"],["class","card",4,"ngIf"],["mat-icon-button","","aria-label","precedente",1,"nav","left",3,"click"],["mat-icon-button","","aria-label","successivo",1,"nav","right",3,"click"],[1,"thumbs"],["class","thumb","type","button",3,"active","click",4,"ngFor","ngForOf"],["type","button",1,"thumb",3,"click"],["loading","lazy","decoding","async",3,"error","src","alt"],[1,"desc"],[1,"notes"]],template:function(e,c){e&1&&(o(0,"section",0)(1,"div",1)(2,"a",2)(3,"mat-icon"),a(4,"arrow_back"),i(),a(5," Torna ai progetti "),i(),j(6,"span",3),o(7,"a",4)(8,"mat-icon"),a(9,"person"),i(),a(10),i()(),g(11,pt,4,0,"div",5)(12,mt,7,0,"div",5)(13,kt,41,21,"ng-container",6),i()),e&2&&(r(2),s("routerLink",c.goBackToProjects()),r(5),s("routerLink",c.goToArtistProjects()),r(3),M(" ",c.artistName()," "),r(),s("ngIf",c.loading),r(),s("ngIf",!c.loading&&c.notFound),r(),s("ngIf",!c.loading&&!c.notFound&&c.project))},dependencies:[H,V,B,G,R,Z,$,ot,J,K,Q,W,tt,et,X,nt,it,q],styles:[".page[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto;width:100%}.topbar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.topbar[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{flex:1}.state[_ngcontent-%COMP%]{display:grid;place-items:center;gap:10px;padding:40px 0;text-align:center}.state__icon[_ngcontent-%COMP%]{font-size:44px;width:44px;height:44px;opacity:.8}.state__text[_ngcontent-%COMP%]{opacity:.9}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.15fr .85fr;gap:18px}@media (max-width: 1024px){.layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}.gallery[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.gallery__hero[_ngcontent-%COMP%]{position:relative;border-radius:16px;overflow:hidden;background:linear-gradient(145deg,#ffffff0d,#00000040);min-height:320px}.gallery[_ngcontent-%COMP%]   .hero-img[_ngcontent-%COMP%]{width:100%;height:520px;object-fit:cover;display:block}@media (max-width: 1024px){.gallery[_ngcontent-%COMP%]   .hero-img[_ngcontent-%COMP%]{height:420px}}.gallery[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);z-index:2;background:#00000059;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}.gallery[_ngcontent-%COMP%]   .nav.left[_ngcontent-%COMP%]{left:10px}.gallery[_ngcontent-%COMP%]   .nav.right[_ngcontent-%COMP%]{right:10px}.thumbs[_ngcontent-%COMP%]{display:flex;gap:10px;overflow-x:auto;padding-bottom:2px}.thumbs[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:0;cursor:pointer;background:transparent;overflow:hidden;flex:0 0 auto;width:86px;height:86px}.thumbs[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.thumbs[_ngcontent-%COMP%]   .thumb.active[_ngcontent-%COMP%]{border-color:#ffffff73;transform:translateY(-1px)}.thumbs[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]:focus-visible{outline:2px solid rgba(255,255,255,.45);outline-offset:2px}.details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.head[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between}.head[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin:0 0 8px;font-size:28px;line-height:1.15;letter-spacing:.3px}.head[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{opacity:.95}.card[_ngcontent-%COMP%]{border-radius:16px;background:#ffffff0a;box-shadow:none;border:1px solid rgba(255,255,255,.06)}.desc[_ngcontent-%COMP%]{font-size:15px;line-height:1.6;opacity:.95}.grid[_ngcontent-%COMP%]{margin-top:14px;display:grid;gap:10px}.grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:160px 1fr;gap:10px;align-items:baseline}@media (max-width: 520px){.grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .k[_ngcontent-%COMP%]{opacity:.75;font-size:13px}.grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   .v[_ngcontent-%COMP%]{font-weight:600}.notes[_ngcontent-%COMP%]{line-height:1.6;opacity:.95}"]})};export{ct as ProjectDetailComponent};
