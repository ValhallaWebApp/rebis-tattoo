import{Fc as Bo,Gc as $o,Ia as Ze,Ma as fe,Ta as Vo,a as Do,b as Lo,d as ke,e as h,ga as Fo,h as bt,ja as Uo,ma as Qe,o as Mo,oa as Wo,p as xo,qa as B,s as Vi,u as Bi,v as $i,wa as Xe}from"./chunk-JF75SBGN.js";var ji={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var p=function(n,e){if(!n)throw Pe(e)},Pe=function(n){return new Error("Firebase Database ("+ji.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var jo=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},gu=function(n){let e=[],t=0,i=0;for(;t<n.length;){let s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){let r=n[t++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){let r=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{let r=n[t++],o=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Sn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){let r=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,l=c?n[s+2]:0,u=r>>2,d=(r&3)<<4|a>>4,f=(a&15)<<2|l>>6,_=l&63;c||(_=64,o||(f=64)),i.push(t[u],t[d],t[f],t[_])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jo(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gu(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){let r=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;let l=s<n.length?t[n.charAt(s)]:64;++s;let d=s<n.length?t[n.charAt(s)]:64;if(++s,r==null||a==null||l==null||d==null)throw new zi;let f=r<<2|a>>4;if(i.push(f),l!==64){let _=a<<4&240|l>>2;if(i.push(_),d!==64){let m=l<<6&192|d;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},zi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},qi=function(n){let e=jo(n);return Sn.encodeByteArray(e,!0)},At=function(n){return qi(n).replace(/\./g,"")},Rt=function(n){try{return Sn.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function zo(n){return Go(void 0,n)}function Go(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!vu(t)||(n[t]=Go(n[t],e[t]));return n}function vu(n){return n!=="__proto__"}function yu(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Iu=()=>yu().__FIREBASE_DEFAULTS__,Eu=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wu=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Rt(n[1]);return e&&JSON.parse(e)},bn=()=>{try{return Iu()||Eu()||wu()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ki=n=>{var e,t;return(t=(e=bn())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},qo=n=>{let e=Ki(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Yi=()=>{var n;return(n=bn())===null||n===void 0?void 0:n.config},Ji=n=>{var e;return(e=bn())===null||e===void 0?void 0:e[`_${n}`]};var re=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function Ko(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[At(JSON.stringify(t)),At(JSON.stringify(o)),""].join(".")}function F(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nt(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(F())}function Tu(){var n;let e=(n=bn())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Yo(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Jo(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function An(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Qo(){let n=F();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Q(){return ji.NODE_CLIENT===!0||ji.NODE_ADMIN===!0}function og(){return!Tu()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xo(){try{return typeof indexedDB=="object"}catch{return!1}}function Zo(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var r;e(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}var Cu="FirebaseError",G=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=Cu,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oe.prototype.create)}},oe=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?Su(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new G(s,a,i)}};function Su(n,e){return n.replace(bu,(t,i)=>{let s=e[i];return s!=null?String(s):`<${i}?>`})}var bu=/\{\$([^}]+)}/g;function et(n){return JSON.parse(n)}function P(n){return JSON.stringify(n)}var ea=function(n){let e={},t={},i={},s="";try{let r=n.split(".");e=et(Rt(r[0])||""),t=et(Rt(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}};var ta=function(n){let e=ea(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},na=function(n){let e=ea(n).claims;return typeof e=="object"&&e.admin===!0};function q(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Oe(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function kt(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Pt(n,e,t){let i={};for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function tt(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let s of t){if(!i.includes(s))return!1;let r=n[s],o=e[s];if(Ho(r)&&Ho(o)){if(!tt(r,o))return!1}else if(r!==o)return!1}for(let s of i)if(!t.includes(s))return!1;return!0}function Ho(n){return n!==null&&typeof n=="object"}function De(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function nt(n){let e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){let[s,r]=i.split("=");e[decodeURIComponent(s)]=decodeURIComponent(r)}}),e}function it(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}var Cn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);let i=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)i[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)i[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){let f=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let d=0;d<80;d++){d<40?d<20?(l=a^r&(o^a),u=1518500249):(l=r^o^a,u=1859775393):d<60?(l=r&o|a&(r|o),u=2400959708):(l=r^o^a,u=3395469782);let f=(s<<5|s>>>27)+l+c+u+i[d]&4294967295;c=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let i=t-this.blockSize,s=0,r=this.buf_,o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<t;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}};function ia(n,e){let t=new Gi(n,e);return t.subscribe.bind(t)}var Gi=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");Au(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=Hi),s.error===void 0&&(s.error=Hi),s.complete===void 0&&(s.complete=Hi);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Au(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Hi(){}function st(n,e){return`${n} failed: ${e} argument `}var sa=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){let r=s-55296;i++,p(i<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Ot=function(n){let e=0;for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};var ag=4*60*60*1e3;function O(n){return n&&n._delegate?n._delegate:n}var $=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Le="[DEFAULT]";var Rn=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new re;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),s=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Nu(e))try{this.getOrInitializeService({instanceIdentifier:Le})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(t);try{let r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Le){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return h(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Le){return this.instances.has(e)}getOptions(e=Le){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[r,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,t){var i;let s=this.normalizeInstanceIdentifier(t),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);let o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Ru(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Le){return this.component?this.component.multipleInstances?e:Le:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Ru(n){return n===Le?void 0:n}function Nu(n){return n.instantiationMode==="EAGER"}var Dt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Rn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var ku=[],S=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(S||{}),Pu={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},Ou=S.INFO,Du={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},Lu=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),s=Du[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},pe=class{constructor(e){this.name=e,this._logLevel=Ou,this._logHandler=Lu,this._userLogHandler=null,ku.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in S))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Pu[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...e),this._logHandler(this,S.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...e),this._logHandler(this,S.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,S.INFO,...e),this._logHandler(this,S.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,S.WARN,...e),this._logHandler(this,S.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...e),this._logHandler(this,S.ERROR,...e)}};var Mu=(n,e)=>e.some(t=>n instanceof t),ra,oa;function xu(){return ra||(ra=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fu(){return oa||(oa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var aa=new WeakMap,Xi=new WeakMap,ca=new WeakMap,Qi=new WeakMap,es=new WeakMap;function Uu(n){let e=new Promise((t,i)=>{let s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(X(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&aa.set(t,n)}).catch(()=>{}),es.set(e,n),e}function Wu(n){if(Xi.has(n))return;let e=new Promise((t,i)=>{let s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});Xi.set(n,e)}var Zi={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Xi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ca.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return X(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function la(n){Zi=n(Zi)}function Vu(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(Nn(this),e,...t);return ca.set(i,e.sort?e.sort():[e]),X(i)}:Fu().includes(n)?function(...e){return n.apply(Nn(this),e),X(aa.get(this))}:function(...e){return X(n.apply(Nn(this),e))}}function Bu(n){return typeof n=="function"?Vu(n):(n instanceof IDBTransaction&&Wu(n),Mu(n,xu())?new Proxy(n,Zi):n)}function X(n){if(n instanceof IDBRequest)return Uu(n);if(Qi.has(n))return Qi.get(n);let e=Bu(n);return e!==n&&(Qi.set(n,e),es.set(e,n)),e}var Nn=n=>es.get(n);function da(n,e,{blocked:t,upgrade:i,blocking:s,terminated:r}={}){let o=indexedDB.open(n,e),a=X(o);return i&&o.addEventListener("upgradeneeded",c=>{i(X(o.result),c.oldVersion,c.newVersion,X(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var $u=["get","getKey","getAll","getAllKeys","count"],Hu=["put","add","delete","clear"],ts=new Map;function ua(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ts.get(e))return ts.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,s=Hu.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||$u.includes(t)))return;let r=function(o,...a){return h(this,null,function*(){let c=this.transaction(o,s?"readwrite":"readonly"),l=c.store;return i&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),s&&c.done]))[0]})};return ts.set(e,r),r}la(n=>Lo(Do({},n),{get:(e,t,i)=>ua(e,t)||n.get(e,t,i),has:(e,t)=>!!ua(e,t)||n.has(e,t)}));var is=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ju(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function ju(n){let e=n.getComponent();return e?.type==="VERSION"}var ss="@firebase/app",ha="0.10.13";var ae=new pe("@firebase/app"),zu="@firebase/app-compat",Gu="@firebase/analytics-compat",qu="@firebase/analytics",Ku="@firebase/app-check-compat",Yu="@firebase/app-check",Ju="@firebase/auth",Qu="@firebase/auth-compat",Xu="@firebase/database",Zu="@firebase/data-connect",ed="@firebase/database-compat",td="@firebase/functions",nd="@firebase/functions-compat",id="@firebase/installations",sd="@firebase/installations-compat",rd="@firebase/messaging",od="@firebase/messaging-compat",ad="@firebase/performance",cd="@firebase/performance-compat",ld="@firebase/remote-config",ud="@firebase/remote-config-compat",dd="@firebase/storage",hd="@firebase/storage-compat",fd="@firebase/firestore",pd="@firebase/vertexai-preview",_d="@firebase/firestore-compat",md="firebase",gd="10.14.1";var rs="[DEFAULT]",vd={[ss]:"fire-core",[zu]:"fire-core-compat",[qu]:"fire-analytics",[Gu]:"fire-analytics-compat",[Yu]:"fire-app-check",[Ku]:"fire-app-check-compat",[Ju]:"fire-auth",[Qu]:"fire-auth-compat",[Xu]:"fire-rtdb",[Zu]:"fire-data-connect",[ed]:"fire-rtdb-compat",[td]:"fire-fn",[nd]:"fire-fn-compat",[id]:"fire-iid",[sd]:"fire-iid-compat",[rd]:"fire-fcm",[od]:"fire-fcm-compat",[ad]:"fire-perf",[cd]:"fire-perf-compat",[ld]:"fire-rc",[ud]:"fire-rc-compat",[dd]:"fire-gcs",[hd]:"fire-gcs-compat",[fd]:"fire-fst",[_d]:"fire-fst-compat",[pd]:"fire-vertex","fire-js":"fire-js",[md]:"fire-js-all"};var Lt=new Map,yd=new Map,os=new Map;function fa(n,e){try{n.container.addComponent(e)}catch(t){ae.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function me(n){let e=n.name;if(os.has(e))return ae.debug(`There were multiple attempts to register component ${e}.`),!1;os.set(e,n);for(let t of Lt.values())fa(t,n);for(let t of yd.values())fa(t,n);return!0}function xt(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function K(n){return n.settings!==void 0}var Id={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_e=new oe("app","Firebase",Id);var as=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new $("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _e.create("app-deleted",{appName:this._name})}};var ge=gd;function us(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:rs,automaticDataCollectionEnabled:!1},e),s=i.name;if(typeof s!="string"||!s)throw _e.create("bad-app-name",{appName:String(s)});if(t||(t=Yi()),!t)throw _e.create("no-options");let r=Lt.get(s);if(r){if(tt(t,r.options)&&tt(i,r.config))return r;throw _e.create("duplicate-app",{appName:s})}let o=new Dt(s);for(let c of os.values())o.addComponent(c);let a=new as(t,i,o);return Lt.set(s,a),a}function rt(n=rs){let e=Lt.get(n);if(!e&&n===rs&&Yi())return us();if(!e)throw _e.create("no-app",{appName:n});return e}function kn(){return Array.from(Lt.values())}function D(n,e,t){var i;let s=(i=vd[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);let r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){let a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ae.warn(a.join(" "));return}me(new $(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}var Ed="firebase-heartbeat-database",wd=1,Mt="firebase-heartbeat-store",ns=null;function ga(){return ns||(ns=da(Ed,wd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Mt)}catch(t){console.warn(t)}}}}).catch(n=>{throw _e.create("idb-open",{originalErrorMessage:n.message})})),ns}function Td(n){return h(this,null,function*(){try{let t=(yield ga()).transaction(Mt),i=yield t.objectStore(Mt).get(va(n));return yield t.done,i}catch(e){if(e instanceof G)ae.warn(e.message);else{let t=_e.create("idb-get",{originalErrorMessage:e?.message});ae.warn(t.message)}}})}function pa(n,e){return h(this,null,function*(){try{let i=(yield ga()).transaction(Mt,"readwrite");yield i.objectStore(Mt).put(e,va(n)),yield i.done}catch(t){if(t instanceof G)ae.warn(t.message);else{let i=_e.create("idb-set",{originalErrorMessage:t?.message});ae.warn(i.message)}}})}function va(n){return`${n.name}!${n.options.appId}`}var Cd=1024,Sd=30*24*60*60*1e3,cs=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ls(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return h(this,null,function*(){var e,t;try{let s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=_a();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=Sd}),this._storage.overwrite(this._heartbeatsCache))}catch(i){ae.warn(i)}})}getHeartbeatsHeader(){return h(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=_a(),{heartbeatsToSend:i,unsentEntries:s}=bd(this._heartbeatsCache.heartbeats),r=At(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return ae.warn(t),""}})}};function _a(){return new Date().toISOString().substring(0,10)}function bd(n,e=Cd){let t=[],i=n.slice();for(let s of n){let r=t.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),ma(t)>e){r.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ma(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var ls=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return h(this,null,function*(){return Xo()?Zo().then(()=>!0).catch(()=>!1):!1})}read(){return h(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Td(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return h(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return pa(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return h(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return pa(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return})}};function ma(n){return At(JSON.stringify({version:2,heartbeats:n})).length}function Ad(n){me(new $("platform-logger",e=>new is(e),"PRIVATE")),me(new $("heartbeat",e=>new cs(e),"PRIVATE")),D(ss,ha,n),D(ss,ha,"esm2017"),D("fire-js","")}Ad("");var Rd="firebase",Nd="10.14.1";D(Rd,Nd,"app");var xe=new Bo("ANGULARFIRE2_VERSION");function On(n,e,t){if(e){if(e.length===1)return e[0];let r=e.filter(o=>o.app===t);if(r.length===1)return r[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ft=(n,e)=>{let t=e?[e]:kn(),i=[];return t.forEach(s=>{s.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},at=class{constructor(){return Ft(kd)}},kd="app-check";function ot(){}var Pn=class{zone;delegate;constructor(e,t=xo){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let s=this.zone,r=function(o){s.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(r,t,i)}},ds=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ot,{},ot,ot)),t.pipe(Fo({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ct=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Pn(Zone.current)),this.insideAngular=t.run(()=>new Pn(Zone.current,Mo)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(Wo(fe))};static \u0275prov=Uo({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Dn(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Pd(n){return Dn().ngZone.runOutsideAngular(()=>n())}function Me(n){return Dn().ngZone.run(()=>n())}function Od(n){return Dd(Dn())(n)}function Dd(n){return function(t){return t=t.lift(new ds(n.ngZone)),t.pipe($i(n.outsideAngular),Bi(n.insideAngular))}}var Ld=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Me(()=>n.apply(void 0,i))},R=(n,e)=>function(){let t,i=arguments;for(let r=0;r<arguments.length;r++)typeof i[r]=="function"&&(e&&(t||=Me(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ot,{},ot,ot))),i[r]=Ld(i[r],t));let s=Pd(()=>n.apply(this,i));if(!e)if(s instanceof bt){let r=Dn();return s.pipe($i(r.outsideAngular),Bi(r.insideAngular))}else return Me(()=>s);return s instanceof bt?s.pipe(Od):s instanceof Promise?Me(()=>new Promise((r,o)=>s.then(a=>Me(()=>r(a)),a=>Me(()=>o(a))))):typeof s=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),s.apply(this,arguments)}:Me(()=>s)};var ce=class{constructor(e){return e}},Fe=class{constructor(){return kn()}};function Md(n){return n&&n.length===1?n[0]:new ce(rt())}var hs=new Qe("angularfire2._apps"),xd={provide:ce,useFactory:Md,deps:[[new B,hs]]},Fd={provide:Fe,deps:[[new B,hs]]};function Ud(n){return(e,t)=>{let i=t.get(Vo);D("angularfire",xe.full,"core"),D("angularfire",xe.full,"app"),D("angular",$o.full,i.toString());let s=e.runOutsideAngular(()=>n(t));return new ce(s)}}function Kg(n,...e){return Xe([xd,Fd,{provide:hs,useFactory:Ud(n),multi:!0,deps:[fe,Ze,ct,...e]}])}var Yg=R(us,!0);function Ma(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var xa=Ma,Fa=new oe("auth","Firebase",Ma());var Wn=new pe("@firebase/auth");function Wd(n,...e){Wn.logLevel<=S.WARN&&Wn.warn(`Auth (${ge}): ${n}`,...e)}function Mn(n,...e){Wn.logLevel<=S.ERROR&&Wn.error(`Auth (${ge}): ${n}`,...e)}function ee(n,...e){throw Ms(n,...e)}function Ue(n,...e){return Ms(n,...e)}function Ua(n,e,t){let i=Object.assign(Object.assign({},xa()),{[e]:t});return new oe("auth","Firebase",i).create(e,{appName:n.name})}function de(n){return Ua(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ms(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Fa.create(n,...e)}function g(n,e,...t){if(!n)throw Ms(e,...t)}function le(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Mn(e),new Error(e)}function ye(n,e){n||le(e)}function ms(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Vd(){return ya()==="http:"||ya()==="https:"}function ya(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function Bd(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Vd()||Jo()||"connection"in navigator)?navigator.onLine:!0}function $d(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var We=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,ye(t>e,"Short delay should be less than long delay!"),this.isMobile=Nt()||An()}get(){return Bd()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function xs(n,e){ye(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Vn=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;le("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;le("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;le("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Hd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var jd=new We(3e4,6e4);function Ie(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Ee(r,o,a,c){return h(this,arguments,function*(n,e,t,i,s={}){return Wa(n,s,()=>h(this,null,function*(){let l={},u={};i&&(e==="GET"?u=i:l={body:JSON.stringify(i)});let d=De(Object.assign({key:n.config.apiKey},u)).slice(1),f=yield n._getAdditionalHeaders();f["Content-Type"]="application/json",n.languageCode&&(f["X-Firebase-Locale"]=n.languageCode);let _=Object.assign({method:e,headers:f},l);return Yo()||(_.referrerPolicy="no-referrer"),Vn.fetch()(Va(n,n.config.apiHost,t,d),_)}))})}function Wa(n,e,t){return h(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},Hd),e);try{let s=new gs(n),r=yield Promise.race([t(),s.promise]);s.clearNetworkTimeout();let o=yield r.json();if("needConfirmation"in o)throw Ln(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{let a=r.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ln(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Ln(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Ln(n,"user-disabled",o);let u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Ua(n,u,l);ee(n,u)}}catch(s){if(s instanceof G)throw s;ee(n,"network-request-failed",{message:String(s)})}})}function zt(r,o,a,c){return h(this,arguments,function*(n,e,t,i,s={}){let l=yield Ee(n,e,t,i,s);return"mfaPendingCredential"in l&&ee(n,"multi-factor-auth-required",{_serverResponse:l}),l})}function Va(n,e,t,i){let s=`${e}${t}?${i}`;return n.config.emulator?xs(n.config,s):`${n.config.apiScheme}://${s}`}function zd(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var gs=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ue(this.auth,"network-request-failed")),jd.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Ln(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let s=Ue(n,e,i);return s.customData._tokenResponse=t,s}function Ia(n){return n!==void 0&&n.enterprise!==void 0}var vs=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zd(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function Gd(n,e){return h(this,null,function*(){return Ee(n,"GET","/v2/recaptchaConfig",Ie(n,e))})}function qd(n,e){return h(this,null,function*(){return Ee(n,"POST","/v1/accounts:delete",e)})}function Ba(n,e){return h(this,null,function*(){return Ee(n,"POST","/v1/accounts:lookup",e)})}function Ut(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Fs(n,e=!1){return h(this,null,function*(){let t=O(n),i=yield t.getIdToken(e),s=Us(i);g(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");let r=typeof s.firebase=="object"?s.firebase:void 0,o=r?.sign_in_provider;return{claims:s,token:i,authTime:Ut(fs(s.auth_time)),issuedAtTime:Ut(fs(s.iat)),expirationTime:Ut(fs(s.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}})}function fs(n){return Number(n)*1e3}function Us(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Mn("JWT malformed, contained fewer than 3 sections"),null;try{let s=Rt(t);return s?JSON.parse(s):(Mn("Failed to decode base64 JWT payload"),null)}catch(s){return Mn("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Ea(n){let e=Us(n);return g(e,"internal-error"),g(typeof e.exp<"u","internal-error"),g(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Vt(n,e,t=!1){return h(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof G&&Kd(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function Kd({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var ys=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>h(this,null,function*(){yield this.iteration()}),t)}iteration(){return h(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Bt=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ut(this.lastLoginAt),this.creationTime=Ut(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Bn(n){return h(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),s=yield Vt(n,Ba(t,{idToken:i}));g(s?.users.length,t,"internal-error");let r=s.users[0];n._notifyReloadListener(r);let o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?$a(r.providerUserInfo):[],a=Yd(n.providerData,o),c=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!a?.length,u=c?l:!1,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Bt(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,d)})}function Ws(n){return h(this,null,function*(){let e=O(n);yield Bn(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Yd(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function $a(n){return n.map(e=>{var{providerId:t}=e,i=Vi(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function Jd(n,e){return h(this,null,function*(){let t=yield Wa(n,{},()=>h(this,null,function*(){let i=De({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=Va(n,s,"/v1/token",`key=${r}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Vn.fetch()(o,{method:"POST",headers:a,body:i})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Qd(n,e){return h(this,null,function*(){return Ee(n,"POST","/v2/accounts:revokeToken",Ie(n,e))})}var Wt=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(typeof e.idToken<"u","internal-error"),g(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ea(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){g(e.length!==0,"internal-error");let t=Ea(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return h(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(g(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return h(this,null,function*(){let{accessToken:i,refreshToken:s,expiresIn:r}=yield Jd(e,t);this.updateTokensAndExpiration(i,s,Number(r))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:s,expirationTime:r}=t,o=new n;return i&&(g(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),s&&(g(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),r&&(g(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return le("not implemented")}};function ve(n,e){g(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var lt=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=Vi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ys(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Bt(r.createdAt||void 0,r.lastLoginAt||void 0)}getIdToken(e){return h(this,null,function*(){let t=yield Vt(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Fs(this,e)}reload(){return Ws(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return h(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield Bn(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return h(this,null,function*(){if(K(this.auth.app))return Promise.reject(de(this.auth));let e=yield this.getIdToken();return yield Vt(this,qd(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,o,a,c,l,u;let d=(i=t.displayName)!==null&&i!==void 0?i:void 0,f=(s=t.email)!==null&&s!==void 0?s:void 0,_=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,m=(o=t.photoURL)!==null&&o!==void 0?o:void 0,C=(a=t.tenantId)!==null&&a!==void 0?a:void 0,k=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,se=(l=t.createdAt)!==null&&l!==void 0?l:void 0,Re=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:Ne,emailVerified:Tn,isAnonymous:Po,providerData:Ui,stsTokenManager:Oo}=t;g(Ne&&Oo,e,"internal-error");let _u=Wt.fromJSON(this.name,Oo);g(typeof Ne=="string",e,"internal-error"),ve(d,e.name),ve(f,e.name),g(typeof Tn=="boolean",e,"internal-error"),g(typeof Po=="boolean",e,"internal-error"),ve(_,e.name),ve(m,e.name),ve(C,e.name),ve(k,e.name),ve(se,e.name),ve(Re,e.name);let Wi=new n({uid:Ne,auth:e,email:f,emailVerified:Tn,displayName:d,isAnonymous:Po,photoURL:m,phoneNumber:_,tenantId:C,stsTokenManager:_u,createdAt:se,lastLoginAt:Re});return Ui&&Array.isArray(Ui)&&(Wi.providerData=Ui.map(mu=>Object.assign({},mu))),k&&(Wi._redirectEventId=k),Wi}static _fromIdTokenResponse(e,t,i=!1){return h(this,null,function*(){let s=new Wt;s.updateFromServerResponse(t);let r=new n({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return yield Bn(r),r})}static _fromGetAccountInfoResponse(e,t,i){return h(this,null,function*(){let s=t.users[0];g(s.localId!==void 0,"internal-error");let r=s.providerUserInfo!==void 0?$a(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!r?.length,a=new Wt;a.updateFromIdToken(i);let c=new n({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new Bt(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!r?.length};return Object.assign(c,l),c})}};var wa=new Map;function ue(n){ye(n instanceof Function,"Expected a class definition");let e=wa.get(n);return e?(ye(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,wa.set(n,e),e)}var Xd=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return h(this,null,function*(){return!0})}_set(t,i){return h(this,null,function*(){this.storage[t]=i})}_get(t){return h(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return h(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),Is=Xd;function xn(n,e,t){return`firebase:${n}:${e}:${t}`}var $n=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:s,name:r}=this.auth;this.fullUserKey=xn(this.userKey,s.apiKey,r),this.fullPersistenceKey=xn("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return h(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?lt._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return h(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return h(this,null,function*(){if(!t.length)return new n(ue(Is),e,i);let s=(yield Promise.all(t.map(l=>h(this,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),r=s[0]||ue(Is),o=xn(i,e.config.apiKey,e.name),a=null;for(let l of t)try{let u=yield l._get(o);if(u){let d=lt._fromJSON(e,u);l!==r&&(a=d),r=l;break}}catch{}let c=s.filter(l=>l._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new n(r,e,i):(r=c[0],a&&(yield r._set(o,a.toJSON())),yield Promise.all(t.map(l=>h(this,null,function*(){if(l!==r)try{yield l._remove(o)}catch{}}))),new n(r,e,i))})}};function Ta(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ga(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ha(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ka(e))return"Blackberry";if(Ya(e))return"Webos";if(ja(e))return"Safari";if((e.includes("chrome/")||za(e))&&!e.includes("edge/"))return"Chrome";if(qa(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function Ha(n=F()){return/firefox\//i.test(n)}function ja(n=F()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function za(n=F()){return/crios\//i.test(n)}function Ga(n=F()){return/iemobile/i.test(n)}function qa(n=F()){return/android/i.test(n)}function Ka(n=F()){return/blackberry/i.test(n)}function Ya(n=F()){return/webos/i.test(n)}function Vs(n=F()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Zd(n=F()){var e;return Vs(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function eh(){return Qo()&&document.documentMode===10}function Ja(n=F()){return Vs(n)||qa(n)||Ya(n)||Ka(n)||/windows phone/i.test(n)||Ga(n)}function Qa(n,e=[]){let t;switch(n){case"Browser":t=Ta(F());break;case"Worker":t=`${Ta(F())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ge}/${i}`}var Es=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=r=>new Promise((o,a)=>{try{let c=e(r);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);let s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}runMiddleware(e){return h(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function th(t){return h(this,arguments,function*(n,e={}){return Ee(n,"GET","/v2/passwordPolicy",Ie(n,e))})}var nh=6,ws=class{constructor(e){var t,i,s,r;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:nh,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,s,r,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}};var Ts=class{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hn(this),this.idTokenSubscription=new Hn(this),this.beforeStateQueue=new Es(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fa,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ue(t)),this._initializationPromise=this.queue(()=>h(this,null,function*(){var i,s;if(!this._deleted&&(this.persistenceManager=yield $n.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return h(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return h(this,null,function*(){try{let t=yield Ba(this,{idToken:e}),i=yield lt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return h(this,null,function*(){var t;if(K(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),s=i,r=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(s=c.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{yield this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)})}tryRedirectSignIn(e){return h(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return h(this,null,function*(){try{yield Bn(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=$d()}_delete(){return h(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return h(this,null,function*(){if(K(this.app))return Promise.reject(de(this));let t=e?O(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return h(this,null,function*(){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>h(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return h(this,null,function*(){return K(this.app)?Promise.reject(de(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return K(this.app)?Promise.reject(de(this)):this.queue(()=>h(this,null,function*(){yield this.assertedPersistence.setPersistence(ue(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return h(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return h(this,null,function*(){let e=yield th(this),t=new ws(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new oe("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return h(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield Qd(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return h(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return h(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ue(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=yield $n.create(this,[ue(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return h(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>h(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return h(this,null,function*(){if(e===this.currentUser)return this.queue(()=>h(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};let r=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof t=="function"){let c=e.addObserver(t,i,s);return()=>{o=!0,c()}}else{let c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return h(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qa(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return h(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let s=yield this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t})}_getAppCheckToken(){return h(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&Wd(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Be(n){return O(n)}var Hn=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=ia(t=>this.observer=t)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Jn={loadJS(){return h(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ih(n){Jn=n}function Xa(n){return Jn.loadJS(n)}function sh(){return Jn.recaptchaEnterpriseScript}function rh(){return Jn.gapiScript}function Za(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var oh="recaptcha-enterprise",ah="NO_RECAPTCHA",Cs=class{constructor(e){this.type=oh,this.auth=Be(e)}verify(e="verify",t=!1){return h(this,null,function*(){function i(r){return h(this,null,function*(){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise((o,a)=>h(this,null,function*(){Gd(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let l=new vs(c);return r.tenantId==null?r._agentRecaptchaConfig=l:r._tenantRecaptchaConfigs[r.tenantId]=l,o(l.siteKey)}}).catch(c=>{a(c)})}))})}function s(r,o,a){let c=window.grecaptcha;Ia(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(l=>{o(l)}).catch(()=>{o(ah)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((r,o)=>{i(this.auth).then(a=>{if(!t&&Ia(window.grecaptcha))s(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=sh();c.length!==0&&(c+=a),Xa(c).then(()=>{s(a,r,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})})}};function Ca(n,e,t,i=!1){return h(this,null,function*(){let s=new Cs(n),r;try{r=yield s.verify(t)}catch{r=yield s.verify(t,!0)}let o=Object.assign({},e);return i?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function Ss(n,e,t,i){return h(this,null,function*(){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let r=yield Ca(n,e,t,t==="getOobCode");return i(n,r)}else return i(n,e).catch(r=>h(this,null,function*(){if(r.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=yield Ca(n,e,t,t==="getOobCode");return i(n,o)}else return Promise.reject(r)}))})}function Bs(n,e){let t=xt(n,"auth");if(t.isInitialized()){let s=t.getImmediate(),r=t.getOptions();if(tt(r,e??{}))return s;ee(s,"already-initialized")}return t.initialize({options:e})}function ch(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(ue);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function $s(n,e,t){let i=Be(n);g(i._canInitEmulator,i,"emulator-config-failed"),g(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");let s=!!t?.disableWarnings,r=ec(e),{host:o,port:a}=lh(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${r}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||uh()}function ec(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function lh(n){let e=ec(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){let r=s[1];return{host:r,port:Sa(i.substr(r.length+1))}}else{let[r,o]=i.split(":");return{host:r,port:Sa(o)}}}function Sa(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function uh(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var $t=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return le("not implemented")}_getIdTokenResponse(e){return le("not implemented")}_linkToIdToken(e,t){return le("not implemented")}_getReauthenticationResolver(e){return le("not implemented")}};function dh(n,e){return h(this,null,function*(){return Ee(n,"POST","/v1/accounts:signUp",e)})}function hh(n,e){return h(this,null,function*(){return zt(n,"POST","/v1/accounts:signInWithPassword",Ie(n,e))})}function fh(n,e){return h(this,null,function*(){return zt(n,"POST","/v1/accounts:signInWithEmailLink",Ie(n,e))})}function ph(n,e){return h(this,null,function*(){return zt(n,"POST","/v1/accounts:signInWithEmailLink",Ie(n,e))})}var Ht=class n extends $t{constructor(e,t,i,s=null){super("password",i),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new n(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return h(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ss(e,t,"signInWithPassword",hh);case"emailLink":return fh(e,{email:this._email,oobCode:this._password});default:ee(e,"internal-error")}})}_linkToIdToken(e,t){return h(this,null,function*(){switch(this.signInMethod){case"password":let i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ss(e,i,"signUpPassword",dh);case"emailLink":return ph(e,{idToken:t,email:this._email,oobCode:this._password});default:ee(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function ps(n,e){return h(this,null,function*(){return zt(n,"POST","/v1/accounts:signInWithIdp",Ie(n,e))})}function _h(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function mh(n){let e=nt(it(n)).link,t=e?nt(it(e)).deep_link_id:null,i=nt(it(n)).deep_link_id;return(i?nt(it(i)).link:null)||i||t||e||n}var jn=class n{constructor(e){var t,i,s,r,o,a;let c=nt(it(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,d=_h((s=c.mode)!==null&&s!==void 0?s:null);g(l&&u&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=u,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let t=mh(e);try{return new n(t)}catch{return null}}};var tc=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,i){return Ht._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){let s=jn.parseLink(i);return g(s,"argument-error"),Ht._fromEmailAndCode(t,s.code,s.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),zn=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var bs=class extends zn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function gh(n,e){return h(this,null,function*(){return zt(n,"POST","/v1/accounts:signUp",Ie(n,e))})}var ut=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,s=!1){return h(this,null,function*(){let r=yield lt._fromIdTokenResponse(e,i,s),o=ba(i);return new n({user:r,providerId:o,_tokenResponse:i,operationType:t})})}static _forOperation(e,t,i){return h(this,null,function*(){yield e._updateTokensIfNecessary(i,!0);let s=ba(i);return new n({user:e,providerId:s,_tokenResponse:i,operationType:t})})}};function ba(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var As=class n extends G{constructor(e,t,i,s){var r;super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new n(e,t,i,s)}};function nc(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?As._fromErrorAndOperation(n,r,e,i):r})}function vh(n,e,t=!1){return h(this,null,function*(){let i=yield Vt(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return ut._forOperation(n,"link",i)})}function yh(n,e,t=!1){return h(this,null,function*(){let{auth:i}=n;if(K(i.app))return Promise.reject(de(i));let s="reauthenticate";try{let r=yield Vt(n,nc(i,s,e,n),t);g(r.idToken,i,"internal-error");let o=Us(r.idToken);g(o,i,"internal-error");let{sub:a}=o;return g(n.uid===a,i,"user-mismatch"),ut._forOperation(n,s,r)}catch(r){throw r?.code==="auth/user-not-found"&&ee(i,"user-mismatch"),r}})}function ic(n,e,t=!1){return h(this,null,function*(){if(K(n.app))return Promise.reject(de(n));let i="signIn",s=yield nc(n,i,e),r=yield ut._fromIdTokenResponse(n,i,s);return t||(yield n._updateCurrentUser(r.user)),r})}function Hs(n,e){return h(this,null,function*(){return ic(Be(n),e)})}function sc(n){return h(this,null,function*(){let e=Be(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function js(n,e,t){return h(this,null,function*(){if(K(n.app))return Promise.reject(de(n));let i=Be(n),o=yield Ss(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gh).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&sc(n),c}),a=yield ut._fromIdTokenResponse(i,"signIn",o);return yield i._updateCurrentUser(a.user),a})}function zs(n,e,t){return K(n.app)?Promise.reject(de(n)):Hs(O(n),tc.credential(e,t)).catch(i=>h(this,null,function*(){throw i.code==="auth/password-does-not-meet-requirements"&&sc(n),i}))}function Qn(n,e,t,i){return O(n).onIdTokenChanged(e,t,i)}function Gs(n,e,t){return O(n).beforeAuthStateChanged(e,t)}function Xn(n,e,t,i){return O(n).onAuthStateChanged(e,t,i)}function qs(n){return O(n).signOut()}var Gn="__sak";var qn=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Gn,"1"),this.storage.removeItem(Gn),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Ih=1e3,Eh=10,wh=(()=>{class n extends qn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ja(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let i of Object.keys(this.listeners)){let s=this.storage.getItem(i),r=this.localCache[i];s!==r&&t(i,r,s)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}let s=t.key;i?this.detachListener():this.stopPolling();let r=()=>{let a=this.storage.getItem(s);!i&&this.localCache[s]===a||this.notifyListeners(s,a)},o=this.storage.getItem(s);eh()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(r,Eh):r()}notifyListeners(t,i){this.localCache[t]=i;let s=this.listeners[t];if(s)for(let r of Array.from(s))r(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:s}),!0)})},Ih)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,i){return h(this,null,function*(){yield ke(n.prototype,this,"_set").call(this,t,i),this.localCache[t]=JSON.stringify(i)})}_get(t){return h(this,null,function*(){let i=yield ke(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(i),i})}_remove(t){return h(this,null,function*(){yield ke(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),rc=wh;var Th=(()=>{class n extends qn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})(),Ks=Th;function Ch(n){return Promise.all(n.map(e=>h(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Sh=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let i=this.receivers.find(r=>r.isListeningto(t));if(i)return i;let s=new n(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}handleEvent(t){return h(this,null,function*(){let i=t,{eventId:s,eventType:r,data:o}=i.data,a=this.handlersMap[r];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:s,eventType:r});let c=Array.from(a).map(u=>h(this,null,function*(){return u(i.origin,o)})),l=yield Ch(c);i.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function oc(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}var Rs=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){return h(this,null,function*(){let s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{let l=oc("",20);s.port1.start();let u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(d){let f=d;if(f.data.eventId===l)switch(f.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(f.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Z(){return window}function bh(n){Z().location.href=n}function ac(){return typeof Z().WorkerGlobalScope<"u"&&typeof Z().importScripts=="function"}function Ah(){return h(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Rh(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Nh(){return ac()?self:null}var cc="firebaseLocalStorageDb",kh=1,Kn="firebaseLocalStorage",lc="fbase_key",Ve=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Zn(n,e){return n.transaction([Kn],e?"readwrite":"readonly").objectStore(Kn)}function Ph(){let n=indexedDB.deleteDatabase(cc);return new Ve(n).toPromise()}function Ns(){let n=indexedDB.open(cc,kh);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(Kn,{keyPath:lc})}catch(s){t(s)}}),n.addEventListener("success",()=>h(this,null,function*(){let i=n.result;i.objectStoreNames.contains(Kn)?e(i):(i.close(),yield Ph(),e(yield Ns()))}))})}function Aa(n,e,t){return h(this,null,function*(){let i=Zn(n,!0).put({[lc]:e,value:t});return new Ve(i).toPromise()})}function Oh(n,e){return h(this,null,function*(){let t=Zn(n,!1).get(e),i=yield new Ve(t).toPromise();return i===void 0?null:i.value})}function Ra(n,e){let t=Zn(n,!0).delete(e);return new Ve(t).toPromise()}var Dh=800,Lh=3,Mh=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return h(this,null,function*(){return this.db?this.db:(this.db=yield Ns(),this.db)})}_withRetries(t){return h(this,null,function*(){let i=0;for(;;)try{let s=yield this._openDb();return yield t(s)}catch(s){if(i++>Lh)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return h(this,null,function*(){return ac()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return h(this,null,function*(){this.receiver=Sh._getInstance(Nh()),this.receiver._subscribe("keyChanged",(t,i)=>h(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(t,i)=>h(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return h(this,null,function*(){var t,i;if(this.activeServiceWorker=yield Ah(),!this.activeServiceWorker)return;this.sender=new Rs(this.activeServiceWorker);let s=yield this.sender._send("ping",{},800);s&&!((t=s[0])===null||t===void 0)&&t.fulfilled&&!((i=s[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return h(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Rh()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return h(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Ns();return yield Aa(t,Gn,"1"),yield Ra(t,Gn),!0}catch{}return!1})}_withPendingWrite(t){return h(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,i){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(s=>Aa(s,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)}))})}_get(t){return h(this,null,function*(){let i=yield this._withRetries(s=>Oh(s,t));return this.localCache[t]=i,i})}_remove(t){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(i=>Ra(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return h(this,null,function*(){let t=yield this._withRetries(r=>{let o=Zn(r,!1).getAll();return new Ve(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let i=[],s=new Set;if(t.length!==0)for(let{fbase_key:r,value:o}of t)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(o)&&(this.notifyListeners(r,o),i.push(r));for(let r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),i.push(r));return i})}notifyListeners(t,i){this.localCache[t]=i;let s=this.listeners[t];if(s)for(let r of Array.from(s))r(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>h(this,null,function*(){return this._poll()}),Dh)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),uc=Mh;var iv=Za("rcb"),sv=new We(3e4,6e4);function xh(n,e){return e?ue(e):(g(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var jt=class extends $t{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ps(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ps(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ps(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Fh(n){return ic(n.auth,new jt(n),n.bypassAuthState)}function Uh(n){let{auth:e,user:t}=n;return g(t,e,"internal-error"),yh(t,new jt(n),n.bypassAuthState)}function Wh(n){return h(this,null,function*(){let{auth:e,user:t}=n;return g(t,e,"internal-error"),vh(t,new jt(n),n.bypassAuthState)})}var ks=class{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>h(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(e){return h(this,null,function*(){let{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Fh;case"linkViaPopup":case"linkViaRedirect":return Wh;case"reauthViaPopup":case"reauthViaRedirect":return Uh;default:ee(this.auth,"internal-error")}}resolve(e){ye(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ye(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var rv=new We(2e3,1e4);var Vh="pendingRedirect",Fn=new Map,Ps=class n extends ks{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){return h(this,null,function*(){let e=Fn.get(this.auth._key());if(!e){try{let i=(yield Bh(this.resolver,this.auth))?yield ke(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Fn.set(this.auth._key(),e)}return this.bypassAuthState||Fn.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return h(this,null,function*(){if(e.type==="signInViaRedirect")return ke(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,ke(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return h(this,null,function*(){})}cleanUp(){}};function Bh(n,e){return h(this,null,function*(){let t=jh(e),i=Hh(n);if(!(yield i._isAvailable()))return!1;let s=(yield i._get(t))==="true";return yield i._remove(t),s})}function $h(n,e){Fn.set(n._key(),e)}function Hh(n){return ue(n._redirectPersistence)}function jh(n){return xn(Vh,n.config.apiKey,n.name)}function zh(n,e,t=!1){return h(this,null,function*(){if(K(n.app))return Promise.reject(de(n));let i=Be(n),s=xh(i,e),o=yield new Ps(i,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o})}var Gh=10*60*1e3,Os=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!qh(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!dc(e)){let s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ue(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Gh&&this.cachedEventUids.clear(),this.cachedEventUids.has(Na(e))}saveEventToCache(e){this.cachedEventUids.add(Na(e)),this.lastProcessedEventTime=Date.now()}};function Na(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function dc({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function qh(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dc(n);default:return!1}}function Kh(t){return h(this,arguments,function*(n,e={}){return Ee(n,"GET","/v1/projects",e)})}var Yh=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jh=/^https?/;function Qh(n){return h(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield Kh(n);for(let t of e)try{if(Xh(t))return}catch{}ee(n,"unauthorized-domain")})}function Xh(n){let e=ms(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!Jh.test(t))return!1;if(Yh.test(n))return i===n;let s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}var Zh=new We(3e4,6e4);function ka(){let n=Z().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function ef(n){return new Promise((e,t)=>{var i,s,r;function o(){ka(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ka(),t(Ue(n,"network-request-failed"))},timeout:Zh.get()})}if(!((s=(i=Z().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((r=Z().gapi)===null||r===void 0)&&r.load)o();else{let a=Za("iframefcb");return Z()[a]=()=>{gapi.load?o():t(Ue(n,"network-request-failed"))},Xa(`${rh()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Un=null,e})}var Un=null;function tf(n){return Un=Un||ef(n),Un}var nf=new We(5e3,15e3),sf="__/auth/iframe",rf="emulator/auth/iframe",of={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},af=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cf(n){let e=n.config;g(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?xs(e,rf):`https://${n.config.authDomain}/${sf}`,i={apiKey:e.apiKey,appName:n.name,v:ge},s=af.get(n.config.apiHost);s&&(i.eid=s);let r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${De(i).slice(1)}`}function lf(n){return h(this,null,function*(){let e=yield tf(n),t=Z().gapi;return g(t,n,"internal-error"),e.open({where:document.body,url:cf(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:of,dontclear:!0},i=>new Promise((s,r)=>h(this,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=Ue(n,"network-request-failed"),a=Z().setTimeout(()=>{r(o)},nf.get());function c(){Z().clearTimeout(a),s(i)}i.ping(c).then(c,()=>{r(o)})})))})}var uf={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},df=500,hf=600,ff="_blank",pf="http://localhost",Yn=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function _f(n,e,t,i=df,s=hf){let r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",c=Object.assign(Object.assign({},uf),{width:i.toString(),height:s.toString(),top:r,left:o}),l=F().toLowerCase();t&&(a=za(l)?ff:t),Ha(l)&&(e=e||pf,c.scrollbars="yes");let u=Object.entries(c).reduce((f,[_,m])=>`${f}${_}=${m},`,"");if(Zd(l)&&a!=="_self")return mf(e||"",a),new Yn(null);let d=window.open(e||"",a,u);g(d,n,"popup-blocked");try{d.focus()}catch{}return new Yn(d)}function mf(n,e){let t=document.createElement("a");t.href=n,t.target=e;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}var gf="__/auth/handler",vf="emulator/auth/handler",yf=encodeURIComponent("fac");function Pa(n,e,t,i,s,r){return h(this,null,function*(){g(n.config.authDomain,n,"auth-domain-config-required"),g(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:ge,eventId:s};if(e instanceof zn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",kt(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[u,d]of Object.entries(r||{}))o[u]=d}if(e instanceof bs){let u=e.getScopes().filter(d=>d!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let u of Object.keys(a))a[u]===void 0&&delete a[u];let c=yield n._getAppCheckToken(),l=c?`#${yf}=${encodeURIComponent(c)}`:"";return`${If(n)}?${De(a).slice(1)}${l}`})}function If({config:n}){return n.emulator?xs(n,vf):`https://${n.authDomain}/${gf}`}var _s="webStorageSupport",Ds=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ks,this._completeRedirectFn=zh,this._overrideRedirectResult=$h}_openPopup(e,t,i,s){return h(this,null,function*(){var r;ye((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");let o=yield Pa(e,t,i,ms(),s);return _f(e,o,oc())})}_openRedirect(e,t,i,s){return h(this,null,function*(){yield this._originValidation(e);let r=yield Pa(e,t,i,ms(),s);return bh(r),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(ye(r,"If manager is not set, promise should be"),r)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){return h(this,null,function*(){let t=yield lf(e),i=new Os(e);return t.register("authEvent",s=>(g(s?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_s,{type:_s},s=>{var r;let o=(r=s?.[0])===null||r===void 0?void 0:r[_s];o!==void 0&&t(!!o),ee(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Qh(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ja()||ja()||Vs()}},hc=Ds;var Oa="@firebase/auth",Da="1.7.9";var Ls=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return h(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Ef(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function wf(n){me(new $("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;g(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qa(n)},l=new Ts(i,s,r,c);return ch(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),me(new $("auth-internal",e=>{let t=Be(e.getProvider("auth").getImmediate());return(i=>new Ls(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),D(Oa,Da,Ef(n)),D(Oa,Da,"esm2017")}var Tf=5*60,Cf=Ji("authIdTokenMaxAge")||Tf,La=null,Sf=n=>e=>h(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>Cf)return;let s=t?.token;La!==s&&(La=s,yield fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});function Ys(n=rt()){let e=xt(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Bs(n,{popupRedirectResolver:hc,persistence:[uc,rc,Ks]}),i=Ji("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let r=new URL(i,location.origin);if(location.origin===r.origin){let o=Sf(r.toString());Gs(t,o,()=>o(t.currentUser)),Qn(t,a=>o(a))}}let s=Ki("auth");return s&&$s(t,`http://${s}`),t}function bf(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}ih({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{let r=Ue("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",bf().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});wf("Browser");function pc(n){return new bt(function(e){var t=Xn(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var _c="auth",Gt=class{constructor(e){return e}},qt=class{constructor(){return Ft(_c)}};var Js=new Qe("angularfire2.auth-instances");function pp(n,e){let t=On(_c,n,e);return t&&new Gt(t)}function _p(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Gt(i)}}var mp={provide:qt,deps:[[new B,Js]]},gp={provide:Gt,useFactory:pp,deps:[[new B,Js],ce]};function Jv(n,...e){return D("angularfire",xe.full,"auth"),Xe([gp,mp,{provide:Js,useFactory:_p(n),multi:!0,deps:[fe,Ze,ct,Fe,[new B,at],...e]}])}var Qv=R(pc,!0);var Xv=R(js,!0);var Zv=R(Ys,!0);var ey=R(zs,!0);var ty=R(qs,!0);var mc="@firebase/database",gc="1.0.8";var eo="";function vp(n){eo=n}var sr=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:et(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var rr=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return q(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Yc=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new sr(e)}}catch{}return new rr},He=Yc("localStorage"),or=Yc("sessionStorage");var ft=new pe("@firebase/database"),yp=function(){let n=1;return function(){return n++}}(),Jc=function(n){let e=sa(n),t=new Cn;t.update(e);let i=t.digest();return Sn.encodeByteArray(i)},_n=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=_n.apply(null,i):typeof i=="object"?e+=P(i):e+=i,e+=" "}return e},je=null,vc=!0,Ip=function(n,e){p(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(ft.logLevel=S.VERBOSE,je=ft.log.bind(ft),e&&or.set("logging_enabled",!0)):typeof n=="function"?je=n:(je=null,or.remove("logging_enabled"))},M=function(...n){if(vc===!0&&(vc=!1,je===null&&or.get("logging_enabled")===!0&&Ip(!0)),je){let e=_n.apply(null,n);je(e)}},mn=function(n){return function(...e){M(n,...e)}},ar=function(...n){let e="FIREBASE INTERNAL ERROR: "+_n(...n);ft.error(e)},he=function(...n){let e=`FIREBASE FATAL ERROR: ${_n(...n)}`;throw ft.error(e),new Error(e)},W=function(...n){let e="FIREBASE WARNING: "+_n(...n);ft.warn(e)},Ep=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&W("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},to=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},wp=function(n){if(Q()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ge="[MIN_NAME]",Se="[MAX_NAME]",Ye=function(n,e){if(n===e)return 0;if(n===Ge||e===Se)return-1;if(e===Ge||n===Se)return 1;{let t=yc(n),i=yc(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Tp=function(n,e){return n===e?0:n<e?-1:1},Kt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+P(e))},no=function(n){if(typeof n!="object"||n===null)return P(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=P(e[i]),t+=":",t+=no(n[e[i]]);return t+="}",t},Qc=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function x(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Xc=function(n){p(!to(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,s,r,o,a,c;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));let l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(s?1:0),l.reverse();let u=l.join(""),d="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},Cp=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Sp=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function bp(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var Ap=new RegExp("^-?(0*)\\d{1,10}$"),Rp=-2147483648,Np=2147483647,yc=function(n){if(Ap.test(n)){let e=Number(n);if(e>=Rp&&e<=Np)return e}return null},Tt=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw W("Exception was thrown by user callback.",t),e},Math.floor(0))}},kp=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var cr=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){W(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var lr=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(M("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',W(e)}},en=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),ti="5",Zc="v",el="s",tl="r",nl="f",il=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,sl="ls",rl="p",ur="ac",ol="websocket",al="long_polling";var ni=class{constructor(e,t,i,s,r=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=He.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&He.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Pp(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function cl(n,e,t){p(typeof e=="string","typeof type must == string"),p(typeof t=="object","typeof params must == object");let i;if(e===ol)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===al)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Pp(n)&&(t.ns=n.namespace);let s=[];return x(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var dr=class{constructor(){this.counters_={}}incrementCounter(e,t=1){q(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return zo(this.counters_)}};var Qs={},Xs={};function io(n){let e=n.toString();return Qs[e]||(Qs[e]=new dr),Qs[e]}function Op(n,e){let t=n.toString();return Xs[t]||(Xs[t]=e()),Xs[t]}var hr=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Tt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Ic="start",Dp="close",Lp="pLPCommand",Mp="pRTLPCB",ll="id",ul="pw",dl="ser",xp="cb",Fp="seg",Up="ts",Wp="d",Vp="dframe",hl=1870,fl=30,Bp=hl-fl,$p=25e3,Hp=3e4,fr=class n{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=mn(e),this.stats_=io(t),this.urlFn=c=>(this.appCheckToken&&(c[ur]=this.appCheckToken),cl(t,al,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new hr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Hp)),wp(()=>{if(this.isClosed_)return;this.scriptTagHolder=new pr((...r)=>{let[o,a,c,l,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ic)this.id=a,this.password=c;else if(o===Dp)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Ic]="t",i[dl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[xp]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Zc]=ti,this.transportSessionId&&(i[el]=this.transportSessionId),this.lastSessionId&&(i[sl]=this.lastSessionId),this.applicationId&&(i[rl]=this.applicationId),this.appCheckToken&&(i[ur]=this.appCheckToken),typeof location<"u"&&location.hostname&&il.test(location.hostname)&&(i[tl]=nl);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Q()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Cp()&&!Sp()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=qi(t),s=Qc(i,Bp);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Q())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Vp]="t",i[ll]=e,i[ul]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},pr=class n{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Q())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=yp(),window[Lp+this.uniqueCallbackIdentifier]=e,window[Mp+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){M("frame writing exception"),a.stack&&M(a.stack),M(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||M("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[ll]=this.myID,e[ul]=this.myPW,e[dl]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+fl+i.length<=hl;){let o=this.pendingSegs.shift();i=i+"&"+Fp+s+"="+o.seg+"&"+Up+s+"="+o.ts+"&"+Wp+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor($p)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){Q()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{M("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var jp=16384,zp=45e3,ii=null;typeof MozWebSocket<"u"?ii=MozWebSocket:typeof WebSocket<"u"&&(ii=WebSocket);var Yt=(()=>{class n{constructor(t,i,s,r,o,a,c){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=mn(this.connId),this.stats_=io(i),this.connURL=n.connectionURL_(i,a,c,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){let a={};return a[Zc]=ti,!Q()&&typeof location<"u"&&location.hostname&&il.test(location.hostname)&&(a[tl]=nl),i&&(a[el]=i),s&&(a[sl]=s),r&&(a[ur]=r),o&&(a[rl]=o),cl(t,ol,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,He.set("previous_websocket_failure",!0);try{let s;if(Q()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${ti}/${eo}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new ii(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&ii!==null&&!n.forceDisallow_}static previouslyFailed(){return He.isInMemoryStorage||He.get("previous_websocket_failure")===!0}markConnectionHealthy(){He.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=et(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(p(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let i=P(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=Qc(i,jp);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(zp))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Gp=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[fr,Yt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=Yt&&Yt.isAvailable(),s=i&&!Yt.previouslyFailed();if(t.webSocketOnly&&(i||W("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Yt];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),qp=6e4,Kp=5e3,Yp=10*1024,Jp=100*1024,Zs="t",Ec="d",Qp="s",wc="r",Xp="e",Tc="o",Cc="a",Sc="n",bc="p",Zp="h",_r=class{constructor(e,t,i,s,r,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=mn("c:"+this.id+":"),this.transportManager_=new Gp(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Zt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Jp?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Yp?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Zs in e){let t=e[Zs];t===Cc?this.upgradeIfSecondaryHealthy_():t===wc?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Tc&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Kt("t",e),i=Kt("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:bc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Cc,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Sc,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Kt("t",e),i=Kt("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Kt(Zs,e);if(Ec in e){let i=e[Ec];if(t===Zp){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Sc){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Qp?this.onConnectionShutdown_(i):t===wc?this.onReset_(i):t===Xp?ar("Server Error: "+i):t===Tc?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ar("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ti!==i&&W("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Zt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(qp))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Kp))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:bc,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(He.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var si=class{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var ri=class{constructor(e){this.allowedEvents_=e,this.listeners_={},p(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){p(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var oi=class n extends ri{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Nt()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return p(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Ac=32,Rc=768,T=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function w(){return new T("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function be(n){return n.pieces_.length-n.pieceNum_}function b(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new T(n.pieces_,e)}function so(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function e_(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function rn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function pl(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new T(e,0)}function N(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof T)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new T(t,0)}function I(n){return n.pieceNum_>=n.pieces_.length}function U(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return U(b(n),b(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function t_(n,e){let t=rn(n,0),i=rn(e,0);for(let s=0;s<t.length&&s<i.length;s++){let r=Ye(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function ro(n,e){if(be(n)!==be(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function H(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(be(n)>be(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var mr=class{constructor(e,t){this.errorPrefix_=t,this.parts_=rn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ot(this.parts_[i]);_l(this)}};function n_(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ot(e),_l(n)}function i_(n){let e=n.parts_.pop();n.byteLength_-=Ot(e),n.parts_.length>0&&(n.byteLength_-=1)}function _l(n){if(n.byteLength_>Rc)throw new Error(n.errorPrefix_+"has a key path longer than "+Rc+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ac)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ac+") or object contains a cycle "+$e(n))}function $e(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var gr=class n extends ri{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return p(e==="visible","Unknown event type: "+e),[this.visible_]}};var Jt=1e3,s_=60*5*1e3,Nc=30*1e3,r_=1.3,o_=3e4,a_="server_kill",kc=3,oo=(()=>{class n extends si{constructor(t,i,s,r,o,a,c,l){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=mn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Jt,this.maxReconnectDelay_=s_,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!Q())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");gr.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&oi.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){let r=++this.requestNumber_,o={r,a:t,b:i};this.log_(P(o)),p(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let i=new re,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),p(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),p(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){let i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,u=c.s;n.warnOnListenWarnings_(l,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",c),u!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(u,l))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&q(t,"w")){let s=Oe(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();W(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||na(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Nc)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=ta(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,s=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),p(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+P(t));let i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):ar("Unrecognized action received from server: "+P(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){p(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Jt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Jt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>o_&&(this.reconnectDelay_=Jt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*r_)}this.onConnectStatus_(!1)}establishConnection_(){return h(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,s())},u=function(f){p(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(f)};this.realtime_={close:l,sendRequest:u};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[f,_]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?M("getToken() completed but was canceled"):(M("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=_&&_.token,c=new _r(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,s,m=>{W(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(a_)},o))}catch(f){this.log_("Failed to get token: "+f),a||(this.repoInfo_.nodeAdmin&&W(f),l())}}})}interrupt(t){M("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){M("Resuming connection for reason: "+t),delete this.interruptReasons_[t],kt(this.interruptReasons_)&&(this.reconnectDelay_=Jt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;i?s=i.map(o=>no(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){let s=new T(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){M("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=kc&&(this.reconnectDelay_=Nc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){M("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=kc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";Q()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+eo.replace(/\./g,"-")]=1,Nt()?t["framework.cordova"]=1:An()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=oi.getInstance().currentlyOnline();return kt(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),E=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var pt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new E(Ge,e),s=new E(Ge,t);return this.compare(i,s)!==0}minPost(){return E.MIN}};var ei,ai=class extends pt{static get __EMPTY_NODE(){return ei}static set __EMPTY_NODE(e){ei=e}compare(e,t){return Ye(e.name,t.name)}isDefinedOn(e){throw Pe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return E.MIN}maxPost(){return new E(Se,ei)}makePost(e,t){return p(typeof e=="string","KeyIndex indexValue must always be a string."),new E(e,ei)}toString(){return".key"}},ze=new ai;var ht=class{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Y=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??j.EMPTY_NODE,this.right=o??j.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return j.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(t,s.key)===0){if(s.right.isEmpty())return j.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),vr=class{copy(e,t,i,s,r){return this}insert(e,t,i){return new Y(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},j=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Y.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Y.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ht(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ht(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ht(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ht(this.root_,null,this.comparator_,!0,e)}};j.EMPTY_NODE=new vr;function c_(n,e){return Ye(n.name,e.name)}function ao(n,e){return Ye(n,e)}var yr;function l_(n){yr=n}var ml=function(n){return typeof n=="number"?"number:"+Xc(n):"string:"+n},gl=function(n){if(n.isLeafNode()){let e=n.val();p(typeof e=="string"||typeof e=="number"||typeof e=="object"&&q(e,".sv"),"Priority must be a string or number.")}else p(n===yr||n.isEmpty(),"priority of unexpected type.");p(n===yr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Pc,_t=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,p(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),gl(this.priorityNode_)}static set __childrenNodeConstructor(t){Pc=t}static get __childrenNodeConstructor(){return Pc}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return I(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let s=y(t);return s===null?i:i.isEmpty()&&s!==".priority"?this:(p(s!==".priority"||be(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(b(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ml(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Xc(this.value_):t+=this.value_,this.lazyHash_=Jc(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(p(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return p(r>=0,"Unknown leaf type: "+i),p(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),vl,yl;function u_(n){vl=n}function d_(n){yl=n}var Ir=class extends pt{compare(e,t){let i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Ye(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return E.MIN}maxPost(){return new E(Se,new _t("[PRIORITY-POST]",yl))}makePost(e,t){let i=vl(e);return new E(t,new _t("[PRIORITY-POST]",i))}toString(){return".priority"}},A=new Ir;var h_=Math.log(2),Er=class{constructor(e){let t=r=>parseInt(Math.log(r)/h_,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},ci=function(n,e,t,i){n.sort(e);let s=function(c,l){let u=l-c,d,f;if(u===0)return null;if(u===1)return d=n[c],f=t?t(d):d,new Y(f,d.node,Y.BLACK,null,null);{let _=parseInt(u/2,10)+c,m=s(c,_),C=s(_+1,l);return d=n[_],f=t?t(d):d,new Y(f,d.node,Y.BLACK,m,C)}},r=function(c){let l=null,u=null,d=n.length,f=function(m,C){let k=d-m,se=d;d-=m;let Re=s(k+1,se),Ne=n[k],Tn=t?t(Ne):Ne;_(new Y(Tn,Ne.node,C,null,Re))},_=function(m){l?(l.left=m,l=m):(u=m,l=m)};for(let m=0;m<c.count;++m){let C=c.nextBitIsOne(),k=Math.pow(2,c.count-(m+1));C?f(k,Y.BLACK):(f(k,Y.BLACK),f(k,Y.RED))}return u},o=new Er(n.length),a=r(o);return new j(i||e,a)};var er,dt={},mt=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return p(dt&&A,"ChildrenNode.ts has not been loaded"),er=er||new n({".priority":dt},{".priority":A}),er}get(e){let t=Oe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof j?t:null}hasIndex(e){return q(this.indexSet_,e.toString())}addIndex(e,t){p(e!==ze,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=t.getIterator(E.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=ci(i,e.getCompare()):a=dt;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let u=Object.assign({},this.indexes_);return u[c]=a,new n(u,l)}addToIndexes(e,t){let i=Pt(this.indexes_,(s,r)=>{let o=Oe(this.indexSet_,r);if(p(o,"Missing index implementation for "+r),s===dt)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(E.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),ci(a,o.getCompare())}else return dt;else{let a=t.get(e.name),c=s;return a&&(c=c.remove(new E(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=Pt(this.indexes_,s=>{if(s===dt)return s;{let r=t.get(e.name);return r?s.remove(new E(e.name,r)):s}});return new n(i,this.indexSet_)}};var Qt,v=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&gl(this.priorityNode_),this.children_.isEmpty()&&p(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Qt||(Qt=new n(new j(ao),null,mt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Qt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?Qt:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(b(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(p(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let s=new E(t,i),r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?Qt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){let s=y(t);if(s===null)return i;{p(y(t)!==".priority"||be(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(b(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(A,(a,c)=>{i[a]=c.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ml(this.getPriority().val())+":"),this.forEachChild(A,(i,s)=>{let r=s.hash();r!==""&&(t+=":"+i+":"+r)}),this.lazyHash_=t===""?"":Jc(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new E(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new E(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new E(i,this.children_.get(i)):null}forEachChild(t,i){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===gn?-1:0}withIndex(t){if(t===ze||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===ze||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(A),r=i.getIterator(A),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===ze?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),wr=class extends v{constructor(){super(new j(ao),v.EMPTY_NODE,mt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return v.EMPTY_NODE}isEmpty(){return!1}},gn=new wr;Object.defineProperties(E,{MIN:{value:new E(Ge,v.EMPTY_NODE)},MAX:{value:new E(Se,gn)}});ai.__EMPTY_NODE=v.EMPTY_NODE;_t.__childrenNodeConstructor=v;l_(gn);d_(gn);var f_=!0;function L(n,e=null){if(n===null)return v.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),p(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new _t(t,L(e))}if(!(n instanceof Array)&&f_){let t=[],i=!1;if(x(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=L(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new E(o,c)))}}),t.length===0)return v.EMPTY_NODE;let r=ci(t,c_,o=>o.name,ao);if(i){let o=ci(t,A.getCompare());return new v(r,L(e),new mt({".priority":o},{".priority":A}))}else return new v(r,L(e),mt.Default)}else{let t=v.EMPTY_NODE;return x(n,(i,s)=>{if(q(n,i)&&i.substring(0,1)!=="."){let r=L(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(L(e))}}u_(L);var on=class extends pt{constructor(e){super(),this.indexPath_=e,p(!I(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Ye(e.name,t.name):r}makePost(e,t){let i=L(e),s=v.EMPTY_NODE.updateChild(this.indexPath_,i);return new E(t,s)}maxPost(){let e=v.EMPTY_NODE.updateChild(this.indexPath_,gn);return new E(Se,e)}toString(){return rn(this.indexPath_,0).join("/")}};var Tr=class extends pt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Ye(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(e,t){let i=L(e);return new E(t,i)}toString(){return".value"}},Il=new Tr;function El(n){return{type:"value",snapshotNode:n}}function gt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function an(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function cn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function p_(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var ln=class{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){p(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(an(t,a)):p(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(gt(t,i)):o.trackChildChange(cn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(A,(s,r)=>{t.hasChild(s)||i.trackChildChange(an(s,r))}),t.isLeafNode()||t.forEachChild(A,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(cn(s,r,o))}else i.trackChildChange(gt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?v.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var li=class n{constructor(e){this.indexedFilter_=new ln(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new E(t,i))||(i=v.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=v.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(v.EMPTY_NODE);let r=this;return t.forEachChild(A,(o,a)=>{r.matches(new E(o,a))||(s=s.updateImmediateChild(o,v.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Cr=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new li(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new E(t,i))||(i=v.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=v.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=v.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(v.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,v.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){let d=this.index_.getCompare();o=(f,_)=>d(_,f)}else o=this.index_.getCompare();let a=e;p(a.numChildren()===this.limit_,"");let c=new E(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){let d=a.getImmediateChild(t),f=s.getChildAfterChild(this.index_,l,this.reverse_);for(;f!=null&&(f.name===t||a.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);let _=f==null?1:o(f,c);if(u&&!i.isEmpty()&&_>=0)return r?.trackChildChange(cn(t,i,d)),a.updateImmediateChild(t,i);{r?.trackChildChange(an(t,d));let C=a.updateImmediateChild(t,v.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r?.trackChildChange(gt(f.name,f.node)),C.updateImmediateChild(f.name,f.node)):C}}else return i.isEmpty()?e:u&&o(l,c)>=0?(r!=null&&(r.trackChildChange(an(l.name,l.node)),r.trackChildChange(gt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,v.EMPTY_NODE)):e}};var Sr=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=A}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return p(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return p(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ge}hasEnd(){return this.endSet_}getIndexEndValue(){return p(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return p(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Se}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return p(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===A}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function __(n){return n.loadsAllData()?new ln(n.getIndex()):n.hasLimit()?new Cr(n):new li(n)}function m_(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function g_(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function v_(n,e){let t=n.copy();return t.index_=e,t}function Oc(n){let e={};if(n.isDefault())return e;let t;if(n.index_===A?t="$priority":n.index_===Il?t="$value":n.index_===ze?t="$key":(p(n.index_ instanceof on,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=P(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=P(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+P(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=P(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+P(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Dc(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==A&&(e.i=n.index_.toString()),e}var br=class n extends si{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=mn("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(p(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=Oc(e._queryParams);this.restRequest_(r+".json",c,(l,u)=>{let d=u;if(l===404&&(d=null,l=null),l===null&&this.onDataUpdate_(r,d,!1,i),Oe(this.listens_,o)===a){let f;l?l===401?f="permission_denied":f="rest_error:"+l:f="ok",s(f,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=Oc(e._queryParams),i=e._path.toString(),s=new re;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+De(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=et(a.responseText)}catch{W("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&W("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Ar=class{constructor(){this.rootNode_=v.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function ui(){return{value:null,children:new Map}}function wl(n,e,t){if(I(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,ui());let s=n.children.get(i);e=b(e),wl(s,e,t)}}function Rr(n,e,t){n.value!==null?t(e,n.value):y_(n,(i,s)=>{let r=new T(e.toString()+"/"+i);Rr(s,r,t)})}function y_(n,e){n.children.forEach((t,i)=>{e(i,t)})}var Nr=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&x(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}};var Lc=10*1e3,I_=30*1e3,E_=5*60*1e3,kr=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Nr(e);let i=Lc+(I_-Lc)*Math.random();Zt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;x(e,(s,r)=>{r>0&&q(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),Zt(this.reportStats_.bind(this),Math.floor(Math.random()*2*E_))}};var te=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(te||{});function co(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function lo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function uo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Pr=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=te.ACK_USER_WRITE,this.source=co()}operationForChild(e){if(I(this.path)){if(this.affectedTree.value!=null)return p(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new T(e));return new n(w(),t,this.revert)}}else return p(y(this.path)===e,"operationForChild called for unrelated child."),new n(b(this.path),this.affectedTree,this.revert)}};var di=class n{constructor(e,t){this.source=e,this.path=t,this.type=te.LISTEN_COMPLETE}operationForChild(e){return I(this.path)?new n(this.source,w()):new n(this.source,b(this.path))}};var vt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=te.OVERWRITE}operationForChild(e){return I(this.path)?new n(this.source,w(),this.snap.getImmediateChild(e)):new n(this.source,b(this.path),this.snap)}};var un=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=te.MERGE}operationForChild(e){if(I(this.path)){let t=this.children.subtree(new T(e));return t.isEmpty()?null:t.value?new vt(this.source,w(),t.value):new n(this.source,w(),t)}else return p(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,b(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ne=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(I(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Or=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function w_(n,e,t,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(p_(o.childName,o.snapshotNode))}),Xt(n,s,"child_removed",e,i,t),Xt(n,s,"child_added",e,i,t),Xt(n,s,"child_moved",r,i,t),Xt(n,s,"child_changed",e,i,t),Xt(n,s,"value",e,i,t),s}function Xt(n,e,t,i,s,r){let o=i.filter(a=>a.type===t);o.sort((a,c)=>C_(n,a,c)),o.forEach(a=>{let c=T_(n,a,r);s.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function T_(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function C_(n,e,t){if(e.childName==null||t.childName==null)throw Pe("Should only compare child_ events.");let i=new E(e.childName,e.snapshotNode),s=new E(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Ai(n,e){return{eventCache:n,serverCache:e}}function tn(n,e,t,i){return Ai(new ne(e,t,i),n.serverCache)}function Tl(n,e,t,i){return Ai(n.eventCache,new ne(e,t,i))}function hi(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function qe(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var tr,S_=()=>(tr||(tr=new j(Tp)),tr),V=class n{constructor(e,t=S_()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return x(e,(i,s)=>{t=t.set(new T(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:w(),value:this.value};if(I(e))return null;{let i=y(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(b(e),t);return r!=null?{path:N(new T(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(I(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(b(e)):new n(null)}}set(e,t){if(I(e))return new n(t,this.children);{let i=y(e),r=(this.children.get(i)||new n(null)).set(b(e),t),o=this.children.insert(i,r);return new n(this.value,o)}}remove(e){if(I(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let s=i.remove(b(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(I(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(b(e)):null}}setTree(e,t){if(I(e))return t;{let i=y(e),r=(this.children.get(i)||new n(null)).setTree(b(e),t),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(e){return this.fold_(w(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(N(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,w(),t)}findOnPath_(e,t,i){let s=this.value?i(t,this.value):!1;if(s)return s;if(I(e))return null;{let r=y(e),o=this.children.get(r);return o?o.findOnPath_(b(e),N(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,w(),t)}foreachOnPath_(e,t,i){if(I(e))return this;{this.value&&i(t,this.value);let s=y(e),r=this.children.get(s);return r?r.foreachOnPath_(b(e),N(t,s),i):new n(null)}}foreach(e){this.foreach_(w(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(N(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var J=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new V(null))}};function nn(n,e,t){if(I(e))return new J(new V(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=U(s,e);return r=r.updateChild(o,t),new J(n.writeTree_.set(s,r))}else{let s=new V(t),r=n.writeTree_.setTree(e,s);return new J(r)}}}function Dr(n,e,t){let i=n;return x(t,(s,r)=>{i=nn(i,N(e,s),r)}),i}function Mc(n,e){if(I(e))return J.empty();{let t=n.writeTree_.setTree(e,new V(null));return new J(t)}}function Lr(n,e){return Je(n,e)!=null}function Je(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(U(t.path,e)):null}function xc(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(A,(i,s)=>{e.push(new E(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new E(i,s.value))}),e}function Te(n,e){if(I(e))return n;{let t=Je(n,e);return t!=null?new J(new V(t)):new J(n.writeTree_.subtree(e))}}function Mr(n){return n.writeTree_.isEmpty()}function yt(n,e){return Cl(w(),n.writeTree_,e)}function Cl(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(p(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=Cl(N(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(N(n,".priority"),i)),t}}function Ri(n,e){return Rl(e,n)}function b_(n,e,t,i,s){p(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=nn(n.visibleWrites,e,t)),n.lastWriteId=i}function A_(n,e,t,i){p(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Dr(n.visibleWrites,e,t),n.lastWriteId=i}function R_(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function N_(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);p(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&k_(a,i.path)?s=!1:H(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return P_(n),!0;if(i.snap)n.visibleWrites=Mc(n.visibleWrites,i.path);else{let a=i.children;x(a,c=>{n.visibleWrites=Mc(n.visibleWrites,N(i.path,c))})}return!0}else return!1}function k_(n,e){if(n.snap)return H(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&H(N(n.path,t),e))return!0;return!1}function P_(n){n.visibleWrites=Sl(n.allWrites,O_,w()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function O_(n){return n.visible}function Sl(n,e,t){let i=J.empty();for(let s=0;s<n.length;++s){let r=n[s];if(e(r)){let o=r.path,a;if(r.snap)H(t,o)?(a=U(t,o),i=nn(i,a,r.snap)):H(o,t)&&(a=U(o,t),i=nn(i,w(),r.snap.getChild(a)));else if(r.children){if(H(t,o))a=U(t,o),i=Dr(i,a,r.children);else if(H(o,t))if(a=U(o,t),I(a))i=Dr(i,w(),r.children);else{let c=Oe(r.children,y(a));if(c){let l=c.getChild(b(a));i=nn(i,w(),l)}}}else throw Pe("WriteRecord should have .snap or .children")}}return i}function bl(n,e,t,i,s){if(!i&&!s){let r=Je(n.visibleWrites,e);if(r!=null)return r;{let o=Te(n.visibleWrites,e);if(Mr(o))return t;if(t==null&&!Lr(o,w()))return null;{let a=t||v.EMPTY_NODE;return yt(o,a)}}}else{let r=Te(n.visibleWrites,e);if(!s&&Mr(r))return t;if(!s&&t==null&&!Lr(r,w()))return null;{let o=function(l){return(l.visible||s)&&(!i||!~i.indexOf(l.writeId))&&(H(l.path,e)||H(e,l.path))},a=Sl(n.allWrites,o,e),c=t||v.EMPTY_NODE;return yt(a,c)}}}function D_(n,e,t){let i=v.EMPTY_NODE,s=Je(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(A,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){let r=Te(n.visibleWrites,e);return t.forEachChild(A,(o,a)=>{let c=yt(Te(r,new T(o)),a);i=i.updateImmediateChild(o,c)}),xc(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=Te(n.visibleWrites,e);return xc(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function L_(n,e,t,i,s){p(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=N(e,t);if(Lr(n.visibleWrites,r))return null;{let o=Te(n.visibleWrites,r);return Mr(o)?s.getChild(t):yt(o,s.getChild(t))}}function M_(n,e,t,i){let s=N(e,t),r=Je(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){let o=Te(n.visibleWrites,s);return yt(o,i.getNode().getImmediateChild(t))}else return null}function x_(n,e){return Je(n.visibleWrites,e)}function F_(n,e,t,i,s,r,o){let a,c=Te(n.visibleWrites,e),l=Je(c,w());if(l!=null)a=l;else if(t!=null)a=yt(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],d=o.getCompare(),f=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),_=f.getNext();for(;_&&u.length<s;)d(_,i)!==0&&u.push(_),_=f.getNext();return u}else return[]}function U_(){return{visibleWrites:J.empty(),allWrites:[],lastWriteId:-1}}function fi(n,e,t,i){return bl(n.writeTree,n.treePath,e,t,i)}function ho(n,e){return D_(n.writeTree,n.treePath,e)}function Fc(n,e,t,i){return L_(n.writeTree,n.treePath,e,t,i)}function pi(n,e){return x_(n.writeTree,N(n.treePath,e))}function W_(n,e,t,i,s,r){return F_(n.writeTree,n.treePath,e,t,i,s,r)}function fo(n,e,t){return M_(n.writeTree,n.treePath,e,t)}function Al(n,e){return Rl(N(n.treePath,e),n.writeTree)}function Rl(n,e){return{treePath:n,writeTree:e}}var xr=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;p(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),p(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,cn(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,an(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,gt(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,cn(i,e.snapshotNode,s.oldSnap));else throw Pe("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Fr=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},Nl=new Fr,dn=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new ne(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fo(this.writes_,e,i)}}getChildAfterChild(e,t,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:qe(this.viewCache_),r=W_(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}};function V_(n){return{filter:n}}function B_(n,e){p(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),p(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function $_(n,e,t,i,s){let r=new xr,o,a;if(t.type===te.OVERWRITE){let l=t;l.source.fromUser?o=Ur(n,e,l.path,l.snap,i,s,r):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!I(l.path),o=_i(n,e,l.path,l.snap,i,s,a,r))}else if(t.type===te.MERGE){let l=t;l.source.fromUser?o=j_(n,e,l.path,l.children,i,s,r):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=Wr(n,e,l.path,l.children,i,s,a,r))}else if(t.type===te.ACK_USER_WRITE){let l=t;l.revert?o=q_(n,e,l.path,i,s,r):o=z_(n,e,l.path,l.affectedTree,i,s,r)}else if(t.type===te.LISTEN_COMPLETE)o=G_(n,e,t.path,i,r);else throw Pe("Unknown operation type: "+t.type);let c=r.getChanges();return H_(e,o,c),{viewCache:o,changes:c}}function H_(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=hi(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(El(hi(e)))}}function kl(n,e,t,i,s,r){let o=e.eventCache;if(pi(i,t)!=null)return e;{let a,c;if(I(t))if(p(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=qe(e),u=l instanceof v?l:v.EMPTY_NODE,d=ho(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{let l=fi(i,qe(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{let l=y(t);if(l===".priority"){p(be(t)===1,"Can't have a priority with additional path components");let u=o.getNode();c=e.serverCache.getNode();let d=Fc(i,t,u,c);d!=null?a=n.filter.updatePriority(u,d):a=o.getNode()}else{let u=b(t),d;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let f=Fc(i,t,o.getNode(),c);f!=null?d=o.getNode().getImmediateChild(l).updateChild(u,f):d=o.getNode().getImmediateChild(l)}else d=fo(i,l,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),l,d,u,s,r):a=o.getNode()}}return tn(e,a,o.isFullyInitialized()||I(t),n.filter.filtersNodes())}}function _i(n,e,t,i,s,r,o,a){let c=e.serverCache,l,u=o?n.filter:n.filter.getIndexedFilter();if(I(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){let _=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),_,null)}else{let _=y(t);if(!c.isCompleteForPath(t)&&be(t)>1)return e;let m=b(t),k=c.getNode().getImmediateChild(_).updateChild(m,i);_===".priority"?l=u.updatePriority(c.getNode(),k):l=u.updateChild(c.getNode(),_,k,m,Nl,null)}let d=Tl(e,l,c.isFullyInitialized()||I(t),u.filtersNodes()),f=new dn(s,d,r);return kl(n,d,t,s,f,a)}function Ur(n,e,t,i,s,r,o){let a=e.eventCache,c,l,u=new dn(s,e,r);if(I(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=tn(e,l,!0,n.filter.filtersNodes());else{let d=y(t);if(d===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=tn(e,l,a.isFullyInitialized(),a.isFiltered());else{let f=b(t),_=a.getNode().getImmediateChild(d),m;if(I(f))m=i;else{let C=u.getCompleteChild(d);C!=null?so(f)===".priority"&&C.getChild(pl(f)).isEmpty()?m=C:m=C.updateChild(f,i):m=v.EMPTY_NODE}if(_.equals(m))c=e;else{let C=n.filter.updateChild(a.getNode(),d,m,f,u,o);c=tn(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Uc(n,e){return n.eventCache.isCompleteForChild(e)}function j_(n,e,t,i,s,r,o){let a=e;return i.foreach((c,l)=>{let u=N(t,c);Uc(e,y(u))&&(a=Ur(n,a,u,l,s,r,o))}),i.foreach((c,l)=>{let u=N(t,c);Uc(e,y(u))||(a=Ur(n,a,u,l,s,r,o))}),a}function Wc(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function Wr(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;I(t)?l=i:l=new V(null).setTree(t,i);let u=e.serverCache.getNode();return l.children.inorderTraversal((d,f)=>{if(u.hasChild(d)){let _=e.serverCache.getNode().getImmediateChild(d),m=Wc(n,_,f);c=_i(n,c,new T(d),m,s,r,o,a)}}),l.children.inorderTraversal((d,f)=>{let _=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!u.hasChild(d)&&!_){let m=e.serverCache.getNode().getImmediateChild(d),C=Wc(n,m,f);c=_i(n,c,new T(d),C,s,r,o,a)}}),c}function z_(n,e,t,i,s,r,o){if(pi(s,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(I(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return _i(n,e,t,c.getNode().getChild(t),s,r,a,o);if(I(t)){let l=new V(null);return c.getNode().forEachChild(ze,(u,d)=>{l=l.set(new T(u),d)}),Wr(n,e,t,l,s,r,a,o)}else return e}else{let l=new V(null);return i.foreach((u,d)=>{let f=N(t,u);c.isCompleteForPath(f)&&(l=l.set(u,c.getNode().getChild(f)))}),Wr(n,e,t,l,s,r,a,o)}}function G_(n,e,t,i,s){let r=e.serverCache,o=Tl(e,r.getNode(),r.isFullyInitialized()||I(t),r.isFiltered());return kl(n,o,t,i,Nl,s)}function q_(n,e,t,i,s,r){let o;if(pi(i,t)!=null)return e;{let a=new dn(i,e,s),c=e.eventCache.getNode(),l;if(I(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=fi(i,qe(e));else{let d=e.serverCache.getNode();p(d instanceof v,"serverChildren would be complete if leaf node"),u=ho(i,d)}u=u,l=n.filter.updateFullNode(c,u,r)}else{let u=y(t),d=fo(i,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=c.getImmediateChild(u)),d!=null?l=n.filter.updateChild(c,u,d,b(t),a,r):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,v.EMPTY_NODE,b(t),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=fi(i,qe(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||pi(i,w())!=null,tn(e,l,o,n.filter.filtersNodes())}}var Vr=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new ln(i.getIndex()),r=__(i);this.processor_=V_(r);let o=t.serverCache,a=t.eventCache,c=s.updateFullNode(v.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(v.EMPTY_NODE,a.getNode(),null),u=new ne(c,o.isFullyInitialized(),s.filtersNodes()),d=new ne(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Ai(d,u),this.eventGenerator_=new Or(this.query_)}get query(){return this.query_}};function K_(n){return n.viewCache_.serverCache.getNode()}function Y_(n){return hi(n.viewCache_)}function J_(n,e){let t=qe(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!I(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function Vc(n){return n.eventRegistrations_.length===0}function Q_(n,e){n.eventRegistrations_.push(e)}function Bc(n,e,t){let i=[];if(t){p(e==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function $c(n,e,t,i){e.type===te.MERGE&&e.source.queryId!==null&&(p(qe(n.viewCache_),"We should always have a full cache before handling merges"),p(hi(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=$_(n.processor_,s,e,t,i);return B_(n.processor_,r.viewCache),p(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Pl(n,r.changes,r.viewCache.eventCache.getNode(),null)}function X_(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(A,(r,o)=>{i.push(gt(r,o))}),t.isFullyInitialized()&&i.push(El(t.getNode())),Pl(n,i,t.getNode(),e)}function Pl(n,e,t,i){let s=i?[i]:n.eventRegistrations_;return w_(n.eventGenerator_,e,t,s)}var mi,gi=class{constructor(){this.views=new Map}};function Z_(n){p(!mi,"__referenceConstructor has already been defined"),mi=n}function em(){return p(mi,"Reference.ts has not been loaded"),mi}function tm(n){return n.views.size===0}function po(n,e,t,i){let s=e.source.queryId;if(s!==null){let r=n.views.get(s);return p(r!=null,"SyncTree gave us an op for an invalid query."),$c(r,e,t,i)}else{let r=[];for(let o of n.views.values())r=r.concat($c(o,e,t,i));return r}}function Ol(n,e,t,i,s){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=fi(t,s?i:null),c=!1;a?c=!0:i instanceof v?(a=ho(t,i),c=!1):(a=v.EMPTY_NODE,c=!1);let l=Ai(new ne(a,c,!1),new ne(i,s,!1));return new Vr(e,l)}return o}function nm(n,e,t,i,s,r){let o=Ol(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Q_(o,t),X_(o,t)}function im(n,e,t,i){let s=e._queryIdentifier,r=[],o=[],a=Ae(n);if(s==="default")for(let[c,l]of n.views.entries())o=o.concat(Bc(l,t,i)),Vc(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||r.push(l.query));else{let c=n.views.get(s);c&&(o=o.concat(Bc(c,t,i)),Vc(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!Ae(n)&&r.push(new(em())(e._repo,e._path)),{removed:r,events:o}}function Dl(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ce(n,e){let t=null;for(let i of n.views.values())t=t||J_(i,e);return t}function Ll(n,e){if(e._queryParams.loadsAllData())return Ni(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Ml(n,e){return Ll(n,e)!=null}function Ae(n){return Ni(n)!=null}function Ni(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var vi;function sm(n){p(!vi,"__referenceConstructor has already been defined"),vi=n}function rm(){return p(vi,"Reference.ts has not been loaded"),vi}var om=1,yi=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new V(null),this.pendingWriteTree_=U_(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function xl(n,e,t,i,s){return b_(n.pendingWriteTree_,e,t,i,s),s?Ct(n,new vt(co(),e,t)):[]}function am(n,e,t,i){A_(n.pendingWriteTree_,e,t,i);let s=V.fromObject(t);return Ct(n,new un(co(),e,s))}function we(n,e,t=!1){let i=R_(n.pendingWriteTree_,e);if(N_(n.pendingWriteTree_,e)){let r=new V(null);return i.snap!=null?r=r.set(w(),!0):x(i.children,o=>{r=r.set(new T(o),!0)}),Ct(n,new Pr(i.path,r,t))}else return[]}function vn(n,e,t){return Ct(n,new vt(lo(),e,t))}function cm(n,e,t){let i=V.fromObject(t);return Ct(n,new un(lo(),e,i))}function lm(n,e){return Ct(n,new di(lo(),e))}function um(n,e,t){let i=mo(n,t);if(i){let s=go(i),r=s.path,o=s.queryId,a=U(r,e),c=new di(uo(o),a);return vo(n,r,c)}else return[]}function Ii(n,e,t,i,s=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||Ml(o,e))){let c=im(o,e,t,i);tm(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let l=c.removed;if(a=c.events,!s){let u=l.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(r,(f,_)=>Ae(_));if(u&&!d){let f=n.syncPointTree_.subtree(r);if(!f.isEmpty()){let _=fm(f);for(let m=0;m<_.length;++m){let C=_[m],k=C.query,se=Vl(n,C);n.listenProvider_.startListening(sn(k),hn(n,k),se.hashFn,se.onComplete)}}}!d&&l.length>0&&!i&&(u?n.listenProvider_.stopListening(sn(e),null):l.forEach(f=>{let _=n.queryToTagMap.get(ki(f));n.listenProvider_.stopListening(sn(f),_)}))}pm(n,l)}return a}function Fl(n,e,t,i){let s=mo(n,i);if(s!=null){let r=go(s),o=r.path,a=r.queryId,c=U(o,e),l=new vt(uo(a),c,t);return vo(n,o,l)}else return[]}function dm(n,e,t,i){let s=mo(n,i);if(s){let r=go(s),o=r.path,a=r.queryId,c=U(o,e),l=V.fromObject(t),u=new un(uo(a),c,l);return vo(n,o,u)}else return[]}function Br(n,e,t,i=!1){let s=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(f,_)=>{let m=U(f,s);r=r||Ce(_,m),o=o||Ae(_)});let a=n.syncPointTree_.get(s);a?(o=o||Ae(a),r=r||Ce(a,w())):(a=new gi,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=v.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,m)=>{let C=Ce(m,w());C&&(r=r.updateImmediateChild(_,C))}));let l=Ml(a,e);if(!l&&!e._queryParams.loadsAllData()){let f=ki(e);p(!n.queryToTagMap.has(f),"View does not exist, but we have a tag");let _=_m();n.queryToTagMap.set(f,_),n.tagToQueryMap.set(_,f)}let u=Ri(n.pendingWriteTree_,s),d=nm(a,e,t,u,r,c);if(!l&&!o&&!i){let f=Ll(a,e);d=d.concat(mm(n,e,f))}return d}function _o(n,e,t){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=U(o,e),l=Ce(a,c);if(l)return l});return bl(s,e,r,t,!0)}function hm(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{let d=U(l,t);i=i||Ce(u,d)});let s=n.syncPointTree_.get(t);s?i=i||Ce(s,w()):(s=new gi,n.syncPointTree_=n.syncPointTree_.set(t,s));let r=i!=null,o=r?new ne(i,!0,!1):null,a=Ri(n.pendingWriteTree_,e._path),c=Ol(s,e,a,r?o.getNode():v.EMPTY_NODE,r);return Y_(c)}function Ct(n,e){return Ul(e,n.syncPointTree_,null,Ri(n.pendingWriteTree_,w()))}function Ul(n,e,t,i){if(I(n.path))return Wl(n,e,t,i);{let s=e.get(w());t==null&&s!=null&&(t=Ce(s,w()));let r=[],o=y(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let l=t?t.getImmediateChild(o):null,u=Al(i,o);r=r.concat(Ul(a,c,l,u))}return s&&(r=r.concat(po(s,n,i,t))),r}}function Wl(n,e,t,i){let s=e.get(w());t==null&&s!=null&&(t=Ce(s,w()));let r=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,l=Al(i,o),u=n.operationForChild(o);u&&(r=r.concat(Wl(u,a,c,l)))}),s&&(r=r.concat(po(s,n,i,t))),r}function Vl(n,e){let t=e.query,i=hn(n,t);return{hashFn:()=>(K_(e)||v.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?um(n,t._path,i):lm(n,t._path);{let r=bp(s,t);return Ii(n,t,null,r)}}}}function hn(n,e){let t=ki(e);return n.queryToTagMap.get(t)}function ki(n){return n._path.toString()+"$"+n._queryIdentifier}function mo(n,e){return n.tagToQueryMap.get(e)}function go(n){let e=n.indexOf("$");return p(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new T(n.substr(0,e))}}function vo(n,e,t){let i=n.syncPointTree_.get(e);p(i,"Missing sync point for query tag that we're tracking");let s=Ri(n.pendingWriteTree_,e);return po(i,t,s,null)}function fm(n){return n.fold((e,t,i)=>{if(t&&Ae(t))return[Ni(t)];{let s=[];return t&&(s=Dl(t)),x(i,(r,o)=>{s=s.concat(o)}),s}})}function sn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(rm())(n._repo,n._path):n}function pm(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let s=ki(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function _m(){return om++}function mm(n,e,t){let i=e._path,s=hn(n,e),r=Vl(n,t),o=n.listenProvider_.startListening(sn(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)p(!Ae(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((l,u,d)=>{if(!I(l)&&u&&Ae(u))return[Ni(u).query];{let f=[];return u&&(f=f.concat(Dl(u).map(_=>_.query))),x(d,(_,m)=>{f=f.concat(m)}),f}});for(let l=0;l<c.length;++l){let u=c[l];n.listenProvider_.stopListening(sn(u),hn(n,u))}}return o}var $r=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Hr=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=N(this.path_,e);return new n(this.syncTree_,t)}node(){return _o(this.syncTree_,this.path_)}},gm=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Hc=function(n,e,t){if(!n||typeof n!="object")return n;if(p(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return vm(n[".sv"],e,t);if(typeof n[".sv"]=="object")return ym(n[".sv"],e);p(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},vm=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:p(!1,"Unexpected server value: "+n)}},ym=function(n,e,t){n.hasOwnProperty("increment")||p(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&p(!1,"Unexpected increment value: "+i);let s=e.node();if(p(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Bl=function(n,e,t,i){return yo(e,new Hr(t,n),i)},$l=function(n,e,t){return yo(n,new $r(e),t)};function yo(n,e,t){let i=n.getPriority().val(),s=Hc(i,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=Hc(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new _t(a,L(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new _t(s))),o.forEachChild(A,(a,c)=>{let l=yo(c,e.getImmediateChild(a),t);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}var fn=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Io(n,e){let t=e instanceof T?e:new T(e),i=n,s=y(t);for(;s!==null;){let r=Oe(i.node.children,s)||{children:{},childCount:0};i=new fn(s,i,r),t=b(t),s=y(t)}return i}function St(n){return n.node.value}function Hl(n,e){n.node.value=e,jr(n)}function jl(n){return n.node.childCount>0}function Im(n){return St(n)===void 0&&!jl(n)}function Pi(n,e){x(n.node.children,(t,i)=>{e(new fn(t,n,i))})}function zl(n,e,t,i){t&&!i&&e(n),Pi(n,s=>{zl(s,e,!0,i)}),t&&i&&e(n)}function Em(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function yn(n){return new T(n.parent===null?n.name:yn(n.parent)+"/"+n.name)}function jr(n){n.parent!==null&&wm(n.parent,n.name,n)}function wm(n,e,t){let i=Im(t),s=q(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,jr(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,jr(n))}var Tm=/[\[\].#$\/\u0000-\u001F\u007F]/,Cm=/[\[\].#$\u0000-\u001F\u007F]/,nr=10*1024*1024,Oi=function(n){return typeof n=="string"&&n.length!==0&&!Tm.test(n)},Gl=function(n){return typeof n=="string"&&n.length!==0&&!Cm.test(n)},Sm=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Gl(n)},zr=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!to(n)||n&&typeof n=="object"&&q(n,".sv")},In=function(n,e,t,i){i&&e===void 0||Di(st(n,"value"),e,t)},Di=function(n,e,t){let i=t instanceof T?new mr(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+$e(i));if(typeof e=="function")throw new Error(n+"contains a function "+$e(i)+" with contents = "+e.toString());if(to(e))throw new Error(n+"contains "+e.toString()+" "+$e(i));if(typeof e=="string"&&e.length>nr/3&&Ot(e)>nr)throw new Error(n+"contains a string greater than "+nr+" utf8 bytes "+$e(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(x(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Oi(o)))throw new Error(n+" contains an invalid key ("+o+") "+$e(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);n_(i,o),Di(n,a,i),i_(i)}),s&&r)throw new Error(n+' contains ".value" child '+$e(i)+" in addition to actual children.")}},bm=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let r=rn(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Oi(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(t_);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&H(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},Am=function(n,e,t,i){if(i&&e===void 0)return;let s=st(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];x(e,(o,a)=>{let c=new T(o);if(Di(s,a,N(t,c)),so(c)===".priority"&&!zr(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),bm(s,r)};var Eo=function(n,e,t,i){if(!(i&&t===void 0)&&!Oi(t))throw new Error(st(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},wo=function(n,e,t,i){if(!(i&&t===void 0)&&!Gl(t))throw new Error(st(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Rm=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),wo(n,e,t,i)},To=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Nm=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Oi(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Sm(t))throw new Error(st(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Gr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Li(n,e){let t=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();t!==null&&!ro(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function ql(n,e,t){Li(n,t),Kl(n,i=>ro(i,e))}function z(n,e,t){Li(n,t),Kl(n,i=>H(i,e)||H(e,i))}function Kl(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;e(r)?(km(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function km(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();je&&M("event: "+t.toString()),Tt(i)}}}var Pm="repo_interrupt",Om=25,qr=class{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ui(),this.transactionQueueTree_=new fn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Dm(n,e,t){if(n.stats_=io(n.repoInfo_),n.forceRestClient_||kp())n.server_=new br(n.repoInfo_,(i,s,r,o)=>{jc(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>zc(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new oo(n.repoInfo_,e,(i,s,r,o)=>{jc(n,i,s,r,o)},i=>{zc(n,i)},i=>{Lm(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Op(n.repoInfo_,()=>new kr(n.stats_,n.server_)),n.infoData_=new Ar,n.infoSyncTree_=new yi({startListening:(i,s,r,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=vn(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Co(n,"connected",!1),n.serverSyncTree_=new yi({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,c)=>{let l=o(a,c);z(n.eventQueue_,i._path,l)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function Yl(n){let t=n.infoData_.getNode(new T(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Mi(n){return gm({timestamp:Yl(n)})}function jc(n,e,t,i,s){n.dataUpdateCount++;let r=new T(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){let c=Pt(t,l=>L(l));o=dm(n.serverSyncTree_,r,c,s)}else{let c=L(t);o=Fl(n.serverSyncTree_,r,c,s)}else if(i){let c=Pt(t,l=>L(l));o=cm(n.serverSyncTree_,r,c)}else{let c=L(t);o=vn(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=It(n,r)),z(n.eventQueue_,a,o)}function zc(n,e){Co(n,"connected",e),e===!1&&Um(n)}function Lm(n,e){x(e,(t,i)=>{Co(n,t,i)})}function Co(n,e,t){let i=new T("/.info/"+e),s=L(t);n.infoData_.updateSnapshot(i,s);let r=vn(n.infoSyncTree_,i,s);z(n.eventQueue_,i,r)}function So(n){return n.nextWriteId_++}function Mm(n,e,t){let i=hm(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{let r=L(s).withIndex(e._queryParams.getIndex());Br(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=vn(n.serverSyncTree_,e._path,r);else{let a=hn(n.serverSyncTree_,e);o=Fl(n.serverSyncTree_,e._path,r,a)}return z(n.eventQueue_,e._path,o),Ii(n.serverSyncTree_,e,t,null,!0),r},s=>(En(n,"get for query "+P(e)+" failed: "+s),Promise.reject(new Error(s))))}function xm(n,e,t,i,s){En(n,"set",{path:e.toString(),value:t,priority:i});let r=Mi(n),o=L(t,i),a=_o(n.serverSyncTree_,e),c=$l(o,a,r),l=So(n),u=xl(n.serverSyncTree_,e,c,l,!0);Li(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(f,_)=>{let m=f==="ok";m||W("set at "+e+" failed: "+f);let C=we(n.serverSyncTree_,l,!m);z(n.eventQueue_,e,C),Kr(n,s,f,_)});let d=Ao(n,e);It(n,d),z(n.eventQueue_,d,[])}function Fm(n,e,t,i){En(n,"update",{path:e.toString(),value:t});let s=!0,r=Mi(n),o={};if(x(t,(a,c)=>{s=!1,o[a]=Bl(N(e,a),L(c),n.serverSyncTree_,r)}),s)M("update() called with empty data.  Don't do anything."),Kr(n,i,"ok",void 0);else{let a=So(n),c=am(n.serverSyncTree_,e,o,a);Li(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{let d=l==="ok";d||W("update at "+e+" failed: "+l);let f=we(n.serverSyncTree_,a,!d),_=f.length>0?It(n,e):e;z(n.eventQueue_,_,f),Kr(n,i,l,u)}),x(t,l=>{let u=Ao(n,N(e,l));It(n,u)}),z(n.eventQueue_,e,[])}}function Um(n){En(n,"onDisconnectEvents");let e=Mi(n),t=ui();Rr(n.onDisconnect_,w(),(s,r)=>{let o=Bl(s,r,n.serverSyncTree_,e);wl(t,s,o)});let i=[];Rr(t,w(),(s,r)=>{i=i.concat(vn(n.serverSyncTree_,s,r));let o=Ao(n,s);It(n,o)}),n.onDisconnect_=ui(),z(n.eventQueue_,w(),i)}function Wm(n,e,t){let i;y(e._path)===".info"?i=Br(n.infoSyncTree_,e,t):i=Br(n.serverSyncTree_,e,t),ql(n.eventQueue_,e._path,i)}function Gc(n,e,t){let i;y(e._path)===".info"?i=Ii(n.infoSyncTree_,e,t):i=Ii(n.serverSyncTree_,e,t),ql(n.eventQueue_,e._path,i)}function Vm(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Pm)}function En(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),M(t,...e)}function Kr(n,e,t,i){e&&Tt(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Jl(n,e,t){return _o(n.serverSyncTree_,e,t)||v.EMPTY_NODE}function bo(n,e=n.transactionQueueTree_){if(e||xi(n,e),St(e)){let t=Xl(n,e);p(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&Bm(n,yn(e),t)}else jl(e)&&Pi(e,t=>{bo(n,t)})}function Bm(n,e,t){let i=t.map(l=>l.currentWriteId),s=Jl(n,e,i),r=s,o=s.hash();for(let l=0;l<t.length;l++){let u=t[l];p(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let d=U(e,u.path);r=r.updateChild(d,u.currentOutputSnapshotRaw)}let a=r.val(!0),c=e;n.server_.put(c.toString(),a,l=>{En(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){let d=[];for(let f=0;f<t.length;f++)t[f].status=2,u=u.concat(we(n.serverSyncTree_,t[f].currentWriteId)),t[f].onComplete&&d.push(()=>t[f].onComplete(null,!0,t[f].currentOutputSnapshotResolved)),t[f].unwatcher();xi(n,Io(n.transactionQueueTree_,e)),bo(n,n.transactionQueueTree_),z(n.eventQueue_,e,u);for(let f=0;f<d.length;f++)Tt(d[f])}else{if(l==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{W("transaction at "+c.toString()+" failed: "+l);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=l}It(n,e)}},o)}function It(n,e){let t=Ql(n,e),i=yn(t),s=Xl(n,t);return $m(n,s,i),i}function $m(n,e,t){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=U(t,c.path),u=!1,d;if(p(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,d=c.abortReason,s=s.concat(we(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=Om)u=!0,d="maxretry",s=s.concat(we(n.serverSyncTree_,c.currentWriteId,!0));else{let f=Jl(n,c.path,o);c.currentInputSnapshot=f;let _=e[a].update(f.val());if(_!==void 0){Di("transaction failed: Data returned ",_,c.path);let m=L(_);typeof _=="object"&&_!=null&&q(_,".priority")||(m=m.updatePriority(f.getPriority()));let k=c.currentWriteId,se=Mi(n),Re=$l(m,f,se);c.currentOutputSnapshotRaw=m,c.currentOutputSnapshotResolved=Re,c.currentWriteId=So(n),o.splice(o.indexOf(k),1),s=s.concat(xl(n.serverSyncTree_,c.path,Re,c.currentWriteId,c.applyLocally)),s=s.concat(we(n.serverSyncTree_,k,!0))}else u=!0,d="nodata",s=s.concat(we(n.serverSyncTree_,c.currentWriteId,!0))}z(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(d),!1,null))))}xi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Tt(i[a]);bo(n,n.transactionQueueTree_)}function Ql(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&St(i)===void 0;)i=Io(i,t),e=b(e),t=y(e);return i}function Xl(n,e){let t=[];return Zl(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Zl(n,e,t){let i=St(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Pi(e,s=>{Zl(n,s,t)})}function xi(n,e){let t=St(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,Hl(e,t.length>0?t:void 0)}Pi(e,i=>{xi(n,i)})}function Ao(n,e){let t=yn(Ql(n,e)),i=Io(n.transactionQueueTree_,e);return Em(i,s=>{ir(n,s)}),ir(n,i),zl(i,s=>{ir(n,s)}),t}function ir(n,e){let t=St(e);if(t){let i=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(p(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(p(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(we(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Hl(e,void 0):t.length=r+1,z(n.eventQueue_,yn(e),s);for(let o=0;o<i.length;o++)Tt(i[o])}}function Hm(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function jm(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):W(`Invalid query segment '${t}' in query '${n}'`)}return e}var qc=function(n,e){let t=zm(n),i=t.namespace;t.domain==="firebase.com"&&he(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&he("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ep();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ni(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new T(t.pathString)}},zm=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(u,d)),u<d&&(s=Hm(n.substring(u,d)));let f=jm(n.substring(Math.min(n.length,d)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let _=e.slice(0,l);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),t=e.substring(m+1),r=i}"ns"in f&&(r=f.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var Kc="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Gm=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Kc.charAt(t%64),t=Math.floor(t/64);p(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Kc.charAt(e[s]);return p(o.length===20,"nextPushId: Length should be 20."),o}}();var Ei=class{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}},wi=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ti=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return p(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Et=class n{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return I(this._path)?null:so(this._path)}get ref(){return new ie(this._repo,this._path)}get _queryIdentifier(){let e=Dc(this._queryParams),t=no(e);return t==="{}"?"default":t}get _queryObject(){return Dc(this._queryParams)}isEqual(e){if(e=O(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=ro(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+e_(this._path)}};function qm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ro(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===ze){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Ge)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Se)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===A){if(e!=null&&!zr(e)||t!=null&&!zr(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(p(n.getIndex()instanceof on||n.getIndex()===Il,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function eu(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var ie=class n extends Et{constructor(e,t){super(e,t,new Sr,!1)}get parent(){let e=pl(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},pn=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new T(e),i=Ke(this.ref,e);return new n(this._node.getChild(t),i,A)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new n(s,Ke(this.ref,i),A)))}hasChild(e){let t=new T(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function tu(n,e){return n=O(n),n._checkNotDeleted("ref"),e!==void 0?Ke(n._root,e):n._root}function Ke(n,e){return n=O(n),y(n._path)===null?Rm("child","path",e,!1):wo("child","path",e,!1),new ie(n._repo,N(n._path,e))}function nu(n,e){n=O(n),To("push",n._path),In("push",e,n._path,!0);let t=Yl(n._repo),i=Gm(t),s=Ke(n,i),r=Ke(n,i),o;return e!=null?o=Fi(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function iu(n){return To("remove",n._path),Fi(n,null)}function Fi(n,e){n=O(n),To("set",n._path),In("set",e,n._path,!1);let t=new re;return xm(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function su(n,e){Am("update",e,n._path,!1);let t=new re;return Fm(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function ru(n){n=O(n);let e=new Ti(()=>{}),t=new Ci(e);return Mm(n._repo,n,t).then(i=>new pn(i,new ie(n._repo,n._path),n._queryParams.getIndex()))}var Ci=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Ei("value",this,new pn(e.snapshotNode,new ie(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wi(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Yr=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wi(this,e,t):null}createEvent(e,t){p(e.childName!=null,"Child events should have a childName.");let i=Ke(new ie(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Ei(e.type,this,new pn(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Km(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let c=t,l=(u,d)=>{Gc(n._repo,n,a),c(u,d)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new Ti(t,r||void 0),a=e==="value"?new Ci(o):new Yr(e,o);return Wm(n._repo,n,a),()=>Gc(n._repo,n,a)}function ou(n,e,t,i){return Km(n,"value",e,t,i)}var wt=class{},Si=class extends wt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){In("endAt",this._value,e._path,!0);let t=g_(e._queryParams,this._value,this._key);if(eu(t),Ro(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Et(e._repo,e._path,t,e._orderByCalled)}};function au(n,e){return Eo("endAt","key",e,!0),new Si(n,e)}var bi=class extends wt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){In("startAt",this._value,e._path,!0);let t=m_(e._queryParams,this._value,this._key);if(eu(t),Ro(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Et(e._repo,e._path,t,e._orderByCalled)}};function cu(n=null,e){return Eo("startAt","key",e,!0),new bi(n,e)}var Jr=class extends wt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){qm(e,"orderByChild");let t=new T(this._path);if(I(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new on(t),s=v_(e._queryParams,i);return Ro(s),new Et(e._repo,e._path,s,!0)}};function lu(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return wo("orderByChild","path",n,!1),new Jr(n)}var Qr=class extends wt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(In("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Si(this._value,this._key)._apply(new bi(this._value,this._key)._apply(e))}};function uu(n,e){return Eo("equalTo","key",e,!0),new Qr(n,e)}function du(n,...e){let t=O(n);for(let i of e)t=i._apply(t);return t}Z_(ie);sm(ie);var Ym="FIREBASE_DATABASE_EMULATOR_HOST",Xr={},Jm=!1;function Qm(n,e,t,i){n.repoInfo_=new ni(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Xm(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||he("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),M("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=qc(r,s),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[Ym]),l?(c=!0,r=`http://${l}?ns=${a.namespace}`,o=qc(r,s),a=o.repoInfo):c=!o.repoInfo.secure;let u=s&&c?new en(en.OWNER):new lr(n.name,n.options,e);Nm("Invalid Firebase Database URL",o),I(o.path)||he("Database URL must point to the root of a Firebase Database (not including a child path).");let d=eg(a,n,u,new cr(n.name,t));return new Zr(d,n)}function Zm(n,e){let t=Xr[e];(!t||t[n.key]!==n)&&he(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Vm(n),delete t[n.key]}function eg(n,e,t,i){let s=Xr[e.name];s||(s={},Xr[e.name]=s);let r=s[n.toURLString()];return r&&he("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new qr(n,Jm,t,i),s[n.toURLString()]=r,r}var Zr=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Dm(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ie(this._repo,w())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Zm(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&he("Cannot call "+e+" on a deleted database.")}};function hu(n=rt(),e){let t=xt(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let i=qo("database");i&&fu(t,...i)}return t}function fu(n,e,t,i={}){n=O(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&he("Cannot call useEmulator() after instance has already been initialized.");let s=n._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&he('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new en(en.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:Ko(i.mockUserToken,n.app.options.projectId);r=new en(o)}Qm(s,e,t,r)}function tg(n){vp(ge),me(new $("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Xm(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),D(mc,gc,n),D(mc,gc,"esm2017")}oo.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};oo.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};tg();var wn=class{constructor(e){return e}},pu="database",No=class{constructor(){return Ft(pu)}};var ko=new Qe("angularfire2.database-instances");function ng(n,e){let t=On(pu,n,e);return t&&new wn(t)}function ig(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new wn(i)}}var sg={provide:No,deps:[[new B,ko]]},rg={provide:wn,useFactory:ng,deps:[[new B,ko],ce]};function Hy(n,...e){return D("angularfire",xe.full,"rtdb"),Xe([rg,sg,{provide:ko,useFactory:ig(n),multi:!0,deps:[fe,Ze,ct,Fe,[new B,qt],[new B,at],...e]}])}var jy=R(au,!0);var zy=R(uu,!0);var Gy=R(ru,!0),qy=R(hu,!0);var Ky=R(ou,!0),Yy=R(lu,!0);var Jy=R(nu,!0),Qy=R(du,!0),Xy=R(tu,!0);var Zy=R(iu,!0);var eI=R(Fi,!0);var tI=R(cu,!0),nI=R(su,!0);export{qo as a,Ko as b,F as c,og as d,G as e,O as f,$ as g,S as h,pe as i,me as j,xt as k,ge as l,rt as m,D as n,xe as o,On as p,Ft as q,at as r,ct as s,R as t,ce as u,Fe as v,Kg as w,Yg as x,Gt as y,qt as z,Jv as A,Qv as B,Xv as C,Zv as D,ey as E,ty as F,wn as G,Hy as H,jy as I,zy as J,Gy as K,qy as L,Ky as M,Yy as N,Jy as O,Qy as P,Xy as Q,Zy as R,eI as S,tI as T,nI as U};
