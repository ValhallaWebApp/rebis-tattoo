import{k as y,n as l,o as R,q as c,r as h,s as I,t as p,u as o,v as O,w as j,y as x}from"./chunk-GHRCGBKI.js";import{a as d,b as u,e as g,h as w,ja as m,oa as f}from"./chunk-GNSFZVKV.js";var k=class b{constructor(e){this.db=e}path="reviews";addReview(e){let t=I(o(this.db,this.path));return j(t,u(d({},e),{id:t.key}))}deleteReview(e){return O(o(this.db,`${this.path}/${e}`))}updateReview(e,t){return x(o(this.db,`${this.path}/${e}`),t)}getAllReviews(){return new w(e=>{let t=o(this.db,this.path);c(t,s=>{let r=s.val(),i=r?Object.keys(r).map(n=>d({id:n},r[n])):[];e.next(i)})})}getRecentReviews(e=5){return new w(t=>{let s=o(this.db,this.path);c(s,r=>{let i=r.val(),n=[];i&&(n=Object.entries(i).map(([a,v])=>d({id:a},v)).sort((a,v)=>new Date(v.date).getTime()-new Date(a.date).getTime()).slice(0,e)),t.next(n)})})}getReviewById(e){return R(o(this.db,`${this.path}/${e}`)).then(t=>t.exists()?d({id:e},t.val()):null)}getReviewsByUser(e){return new w(t=>{let s=p(o(this.db,this.path),h("userId"),l(e));c(s,r=>{let i=r.val(),n=i?Object.entries(i).map(([a,v])=>d({id:a},v)):[];t.next(n)})})}getReviewsByBookingId(e){return new w(t=>{let s=p(o(this.db,this.path),h("bookingId"),l(e));c(s,r=>{let i=r.val(),n=i?Object.entries(i).map(([a,v])=>d({id:a},v)):[];t.next(n)})})}getReviewsByArtist(e){return new w(t=>{let s=o(this.db,this.path);c(s,r=>{let i=r.val(),n=i?Object.entries(i).map(([a,v])=>d({id:a},v)).filter(a=>a.artistId===e&&a.status==="approved"):[];t.next(n)})})}checkIfAlreadyReviewed(e,t){return g(this,null,function*(){let s=yield R(o(this.db,this.path));return s.exists()?Object.values(s.val()).some(i=>i.bookingId===e&&i.userId===t):!1})}static \u0275fac=function(t){return new(t||b)(f(y))};static \u0275prov=m({token:b,factory:b.\u0275fac,providedIn:"root"})};export{k as a};
