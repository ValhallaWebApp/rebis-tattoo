import{a as w,c as A,d as j,e as I,f as O,i as U}from"./chunk-DYFTLCHL.js";import{G as x,J as m,K as M,M as l,N as b,O as C,P as f,Q as i,R as k,S as B,U as R}from"./chunk-RWUD3VOV.js";import{Ta as y}from"./chunk-LU6XTP25.js";import{C as S,a as u,b as h,e as o,h as n,ja as c,oa as p,pa as g,x as v}from"./chunk-JF75SBGN.js";var D=class a{constructor(t,e){this.db=t;this.snackbar=e}path="sessions";getAll(){let t=i(this.db,this.path);return new n(e=>l(t,r=>{let s=r.exists()?Object.values(r.val()):[];e.next(s)},{onlyOnce:!0}))}showMessage(t,e=!1){this.snackbar.open(t,"Chiudi",{duration:3e3,panelClass:e?["mat-warn"]:["mat-primary"]})}create(t){return o(this,null,function*(){try{let e=C(i(this.db,this.path)),r=new Date().toISOString();yield B(e,h(u({},t),{id:e.key,createdAt:r,updatedAt:r,status:t.status??"planned"})),this.showMessage("Seduta creata con successo")}catch(e){throw console.error("Errore creazione seduta:",e),this.showMessage("Errore durante la creazione della seduta",!0),e}})}update(t,e){return o(this,null,function*(){try{yield R(i(this.db,`${this.path}/${t}`),h(u({},e),{updatedAt:new Date().toISOString()})),this.showMessage("Seduta aggiornata con successo")}catch(r){throw console.error("Errore aggiornamento seduta:",r),this.showMessage("Errore durante l'aggiornamento della seduta",!0),r}})}delete(t){return o(this,null,function*(){try{yield k(i(this.db,`${this.path}/${t}`)),this.showMessage("Seduta eliminata con successo")}catch(e){throw console.error("Errore eliminazione seduta:",e),this.showMessage("Errore durante l'eliminazione della seduta",!0),e}})}getSessionsByArtist(t){let e=f(i(this.db,this.path),b("idArtist"),m(t));return new n(r=>l(e,s=>{let d=s.val()?Object.values(s.val()):[];r.next(d)}))}getSessionsByProject(t){let e=f(i(this.db,this.path),b("projectId"),m(t));return new n(r=>l(e,s=>{let d=s.val()?Object.values(s.val()):[];r.next(d)}))}getSessionById(t){return o(this,null,function*(){let e=yield M(i(this.db,`${this.path}/${t}`));return e.exists()?e.val():null})}static \u0275fac=function(e){return new(e||a)(p(x),p(y))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};var E=class a{firestore=g(w);auth=g(U);constructor(){}getCurrentUserId(){return this.auth.userSig()?.uid||null}getCurrentUserRole(){return this.auth.userSig()?.role||"guest"}getClients(){let t=this.getCurrentUserId();if(this.getCurrentUserRole()==="admin"){let r=I(this.firestore,"users");return A(r,{idField:"id"})}else if(t){let r=O(this.firestore,"users",t);return j(r,{idField:"id"}).pipe(S(s=>[s]))}else return v([])}static \u0275fac=function(e){return new(e||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{D as a,E as b};
